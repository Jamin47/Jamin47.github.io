(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-4b39"],{"+Hz3":function(e,t,i){i("SCUe"),e.exports=i("zpmP").Number.parseInt},"/uOT":function(e,t,i){e.exports={default:i("+Hz3"),__esModule:!0}},"1LbF":function(e,t,i){},"4Bx6":function(e,t,i){var n=i("pM+9").parseInt,a=i("jt9C").trim,o=i("yKOp"),l=/^[-+]?0[xX]/;e.exports=8!==n(o+"08")||22!==n(o+"0x16")?function(e,t){var i=a(String(e),3);return n(i,t>>>0||(l.test(i)?16:10))}:n},"7wwX":function(e,t,i){"use strict";var n=i("1LbF");i.n(n).a},EXUM:function(e,t,i){"use strict";i.r(t);var n=i("/uOT"),a=i.n(n),o=i("omC7"),l=i.n(o),r=i("PxUn"),s=i.n(r),c={props:{tableData:{type:Object,default:function(){return{}}},company:{type:Array,default:function(){return{}}},icons:{type:Array,default:function(){return[]}},typeTitle:{type:String,default:""}},data:function(){return{labelId:null,regionId:null,maps:"baidu",changeName:"新增",resetMenu:[],formshow:!0,infoWindow:null,search:"",num:0,map:null,point:null,zoom:null,lat:39.909652,lng:116.404177,circle:null,Bounds:null,Polygon:null,radius:1200,points:[],ruleForm:{companyId:null,typeId:null,labelName:null,region:null,icon:8,address:null,longitude:null,latitude:null,radiusRange:null,viewAngle:null,regionName:null,entryType:null,discription:null,regionType:null,startPoint:[]},rules:{companyId:[{required:!0,message:"请输选择所属公司",trigger:"change"}],typeId:[{required:!0,message:"请选择标注分类",trigger:"change"}],labelName:[{required:!0,message:"请输入标注名称",trigger:"blur"}],icon:[{required:!0,message:"请选择标注图标",trigger:"change"}],regionName:[{required:!0,message:"请输入区域名称",trigger:"blur"}],entryType:[{required:!0,message:"请选择进出类型",trigger:"blur"}]}}},computed:{sonViewLeft:function(){return this.$parent.viewLeft}},created:function(){},mounted:function(){this.initImg(),this.initInput()},methods:{viewFn:function(){this.$parent.viewLeft=!this.$parent.viewLeft},initImg:function(){var e=this;this.map=new s.a.Map("map"),this.point=new s.a.Point(116.404177,39.909652),this.map.centerAndZoom(this.point,14),this.map.enableScrollWheelZoom(!0);var t={offset:new s.a.Size(20,30),anchor:BMAP_ANCHOR_TOP_LEFT},i=new s.a.ScaleControl(t);this.map.addControl(i);var n=new s.a.ZoomControl({offset:new s.a.Size(10,60),anchor:BMAP_ANCHOR_TOP_RIGHT});this.map.addControl(n),this.map.addEventListener("click",function(t){if("标注名称"===e.typeTitle&&"详情"!==e.changeName&&e.onClickMap(t),"圆形"===e.typeTitle||"矩形"===e.typeTitle||"多边形"===e.typeTitle&&"详情"!==e.changeName)switch(e.onClickMap(t),e.point=t.latlng,e.typeTitle){case"圆形":e.map.clearOverlays(),e.newCircle();break;case"矩形":break;case"多边形":e.map.clearOverlays(),e.changePolygon(t.latlng)}}),this.map.addEventListener("rightclick",function(t){"多边形"===e.typeTitle&&"详情"!==e.changeName&&e.points.length>2&&(e.points.pop(),e.map.clearOverlays(),e.Polygon=new s.a.Polygon(e.points,{strokeColor:"#409EFF",strokeWeight:3,fillColor:"#4897ce",fillOpacity:.6,strokeOpacity:1,enableClicking:!1}),e.map.addOverlay(e.Polygon))})},addVehicle:function(){var e=this;this.changeName="新增",this.ruleForm=this.$options.data().ruleForm,this.formshow||(this.formshow=!0),this.$nextTick(function(){e.$refs.ruleForm.resetFields()}),-1===this.$parent.resetMenus[0].value&&(this.resetMenu=JSON.parse(l()(this.$parent.resetMenus)).splice(-1,1))},edit:function(e){this.ruleForm=this.$options.data().ruleForm,this.labelId=e.labelId,this.changeName="编辑",-1===this.$parent.resetMenus[0].value&&(this.resetMenu=JSON.parse(l()(this.$parent.resetMenus)).splice(-1,1)),this.ruleForm=e,this.formshow=!0,this.point=new s.a.Point(e.latitude,e.longitude),this.map.centerAndZoom(this.point,14),this.map.addOverlay(this.newMarker(this.point)),this.map.panBy(400,400)},details:function(e){this.changeName="详情",this.formshow=!1,this.ruleForm.icon=e.icon,this.point=new s.a.Point(e.latitude,e.longitude),this.map.centerAndZoom(this.point,14),this.map.addOverlay(this.newMarker(this.point));var t=' \n      <div> <span>所在区域</span>  <span style="padding-left: 20px">'+(e.region?e.region:"")+'</span> </div>\n      <div> <span>详细地址</span>  <span style="padding-left: 20px">'+(e.address?e.address:"")+'</span> </div>\n      <div> <span>半径范围</span>  <span style="padding-left: 20px">'+(e.radiusRange?e.radiusRange+"米":"")+"</span> </div>\n      ",i={width:300,height:155,title:e.labelName?e.labelName:"",enableCloseOnClick:!1};this.infoWindow=new s.a.InfoWindow(t,i),this.map.openInfoWindow(this.infoWindow,this.point),this.map.panBy(400,400)},newMarker:function(e){var t=this.icons[this.ruleForm.icon].icon,i=null,n=this;i=this.ruleForm.icon<=5?new s.a.Icon(t,new s.a.Size(16,26)):new s.a.Icon(t,new s.a.Size(21,26));var a=new s.a.Marker(e,{icon:i});return"详情"===this.changeName&&a.addEventListener("click",function(){n.map.openInfoWindow(n.infoWindow,n.point)}),a},iconFn:function(e){this.map.clearOverlays(),this.map.addOverlay(this.newMarker(this.point))},mapAnalysis:function(e){var t=this;this.point=e,this.map.clearOverlays(),(new s.a.Geocoder).getLocation(e,function(i){var n=i.addressComponents;t.ruleForm.longitude=e.lat,t.ruleForm.latitude=e.lng,t.ruleForm.region=n.province+n.city+n.district+n.street+n.streetNumber}),this.map.addOverlay(this.newMarker(e))},addRegion:function(){this.addVehicle(),"圆形"===this.typeTitle&&(this.newCircle(),this.map.panBy(400,400)),"矩形"===this.typeTitle&&(this.newBounds(),this.map.panBy(400,400)),"多边形"===this.typeTitle&&(this.newPolygon(),this.map.panBy(400,400))},newCircle:function(){this.map.centerAndZoom(this.point,14);var e=this;e.circle=new s.a.Circle(this.point,this.radius,{strokeColor:"#409EFF",strokeWeight:3,fillColor:"#4897ce",fillOpacity:.6,strokeOpacity:1}),e.map.addOverlay(e.circle),e.circle.enableEditing(),e.ruleForm.radiusRange=e.radius,e.circle.addEventListener("lineupdate",function(t){e.ruleForm.radiusRange=a()(e.circle.getRadius()),e.radius=e.ruleForm.radiusRange})},newBounds:function(){this.map.centerAndZoom(this.point,14);this.Bounds=new s.a.Bounds(new s.a.Point(12955930.961233212,4829858.339400753),new s.a.Point(12956514.599711172,4825049.158342364),{strokeColor:"#409EFF",strokeWeight:3,fillColor:"#4897ce",fillOpacity:.6,strokeOpacity:1}),this.map.addOverlay(this.Bounds)},newPolygon:function(){this.map.centerAndZoom(this.point,14),this.points=[]},changePolygon:function(e){this.points.push(e);this.Polygon=new s.a.Polygon(this.points,{strokeColor:"#409EFF",strokeWeight:3,fillColor:"#4897ce",fillOpacity:.6,strokeOpacity:1,enableClicking:!1}),this.Polygon.enableEditing(),this.map.addOverlay(this.Polygon)},detailsRegion:function(e){switch(this.changeName="详情",e.regionType){case 1:this.detailsCircle(e);break;case 2:this.typeTitle="矩形";break;case 3:this.detailsPolygon(e)}},detailsCircle:function(e){this.point=new s.a.Point(e.longitude,e.latitude),this.radius=e.radiusRange,this.viewAngle=e.viewAngle,this.map.centerAndZoom(this.point,this.viewAngle),this.formshow=!1,this.newCircle(),this.circle.disableEditing(),this.map.panBy(400,400)},detailsPolygon:function(e){this.changeName,this.formshow=!1;for(var t=e.latitude.split(","),i=e.longitude.split(","),n=0;n<t.length;n++)this.points[n]=new s.a.Point(i[n],t[n]);this.point=JSON.parse(e.discription),this.viewAngle=e.viewAngle,this.Polygon=new s.a.Polygon(this.points,{strokeColor:"#409EFF",strokeWeight:3,fillColor:"#4897ce",fillOpacity:.6,strokeOpacity:1,enableClicking:!1}),this.Polygon.disableEditing(),this.map.centerAndZoom(this.point,this.viewAngle),this.map.addOverlay(this.Polygon),this.map.panBy(550,300)},editRegion:function(e){switch(-1===this.$parent.resetMenus[0].value&&(this.resetMenu=JSON.parse(l()(this.$parent.resetMenus)).splice(-1,1)),e.regionType){case 1:this.editCircle(e);break;case 2:this.typeTitle="矩形";break;case 3:this.editPolygon(e)}},editCircle:function(e){this.regionId=e.regionId,this.changeName="编辑",this.formshow=!0,this.ruleForm=e,this.point=new s.a.Point(e.longitude,e.latitude),this.radius=e.radiusRange,this.viewAngle=e.viewAngle,this.map.centerAndZoom(this.point,this.viewAngle),this.newCircle(),this.map.panBy(400,400)},editPolygon:function(e){this.changeName="编辑";var t=e.companyId,i=e.entryType,n=e.radiusRange,a=e.regionId,o=e.regionName,l=e.typeId;this.ruleForm={companyId:t,entryType:i,radiusRange:n,regionId:a,regionName:o,typeId:l},this.regionId=a,this.formshow=!0;for(var r=e.latitude.split(","),c=e.longitude.split(","),p=0;p<r.length;p++)this.points[p]=new s.a.Point(c[p],r[p]);this.point=JSON.parse(e.discription),this.viewAngle=e.viewAngle,this.Polygon=new s.a.Polygon(this.points,{strokeColor:"#409EFF",strokeWeight:3,fillColor:"#4897ce",fillOpacity:.6,strokeOpacity:1,enableClicking:!1}),this.Polygon.enableEditing(),this.map.centerAndZoom(this.point,this.viewAngle),this.map.addOverlay(this.Polygon),this.map.panBy(550,300)},onClickMap:function(e){this.formshow||(this.formshow=!0),"标注名称"===this.typeTitle&&this.mapAnalysis(e.latlng)},formClose:function(){this.map.clearOverlays(),this.formshow=!1},close:function(){this.map.clearOverlays(),this.$parent.show=!1,this.$parent.viewLeft=!1,"圆形"!==this.typeTitle&&"矩形"!==this.typeTitle&&"多边形"!==this.typeTitle||(this.viewAngle=14,this.radius=1200)},getIds:function(e){return window.document.getElementById(e)},initInput:function(){var e,t=this;this.ac=new s.a.Autocomplete({input:"suggestId",location:t.map}),this.ac.addEventListener("onhighlight",function(e){var i="",n=e.fromitem.value,a="";e.fromitem.index>-1&&(a=n.province+n.city+n.district+n.street+n.business),i="FromItem<br />index = "+e.fromitem.index+"<br />value = "+a,a="",e.toitem.index>-1&&(a=(n=e.toitem.value).province+n.city+n.district+n.street+n.business),i+="<br />ToItem<br />index = "+e.toitem.index+"<br />value = "+a,t.getIds("searchResultPanel").innerHTML=i}),t.ac.addEventListener("onconfirm",function(i){var n=i.item.value;e=n.province+n.city+n.district+n.street+n.business,t.getIds("searchResultPanel").innerHTML="onconfirm<br />index = "+i.item.index+"<br />myValue = "+e,t.setPlace(e)})},setPlace:function(e){var t=this;var i=new s.a.LocalSearch(t.map,{onSearchComplete:function(){var e=i.getResults().getPoi(0).point;t.map.centerAndZoom(e,14),"标注名称"===t.typeTitle&&t.mapAnalysis(e)}});i.search(e)},typeIdFn:function(e){this.ruleForm.typeId=e[e.length-1]},submitForm:function(e){"标注名称"===this.typeTitle?this.labelSubmit(e):"圆形"!==this.typeTitle&&"矩形 "!==this.typeTitle&&"多边形"!==this.typeTitle||this.regionSubmit(e)},labelSubmit:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;"新增"===t.changeName?t.$http.post("/label/create",t.ruleForm).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.$message({message:e.message,type:"success"}),t.close(),t.$parent.$refs.table.emitRequestTableData())}):"编辑"===t.changeName&&t.$http.post("/label/update/"+t.labelId,t.ruleForm).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.$message({message:e.message,type:"success"}),t.close(),t.$parent.$refs.table.emitRequestTableData())})})},regionSubmit:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;switch(t.typeTitle){case"圆形":t.ruleForm.regionType=1;break;case"矩形":t.ruleForm.regionType=2;break;case"多边形":t.ruleForm.regionType=3}if("新增"===t.changeName){if("圆形"===t.typeTitle&&(t.ruleForm.latitude=t.circle.getCenter().lat,t.ruleForm.longitude=t.circle.getCenter().lng,t.ruleForm.viewAngle=t.map.getZoom()),"多边形"===t.typeTitle){var i=t.Polygon.getPath();t.ruleForm.latitude=i.map(function(e){return e.lat}).join(","),t.ruleForm.longitude=i.map(function(e){return e.lng}).join(","),t.ruleForm.discription=l()(t.map.getCenter()),t.ruleForm.viewAngle=t.map.getZoom()}t.$http.post("/region/create",t.ruleForm).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.$message({message:e.message,type:"success"}),t.close(),t.$parent.$refs.table.emitRequestTableData())})}else if("编辑"===t.changeName){if("圆形"===t.typeTitle&&(t.ruleForm.latitude=t.circle.getCenter().lat,t.ruleForm.longitude=t.circle.getCenter().lng,t.ruleForm.viewAngle=t.map.getZoom()),"多边形"===t.typeTitle){var n=t.Polygon.getPath();t.ruleForm.latitude=n.map(function(e){return e.lat}).join(","),t.ruleForm.longitude=n.map(function(e){return e.lng}).join(","),t.ruleForm.discription=l()(t.map.getCenter()),t.ruleForm.viewAngle=t.map.getZoom()}t.$http.post("/region/update/"+t.regionId,t.ruleForm).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.$message({message:e.message,type:"success"}),t.close(),t.$parent.$refs.table.emitRequestTableData())})}})}}},p=(i("GEYe"),i("7wwX"),i("ZrdR")),u=Object(p.a)(c,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{attrs:{id:"map"}}),e._v(" "),i("div",{staticClass:"left-control control-view",on:{click:e.viewFn}},[e.sonViewLeft?i("i",{staticClass:"el-icon-arrow-left"}):i("i",{staticClass:"el-icon-arrow-right"})]),e._v(" "),i("el-button",{staticClass:"close",attrs:{plain:"",size:"medium"},on:{click:e.close}},[e._v("关闭")]),e._v(" "),i("el-input",{staticClass:"search",attrs:{id:"suggestId",placeholder:"全国搜索"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),i("div",{staticStyle:{border:"1px solid #C0C0C0",width:"150px",height:"auto",display:"none"},attrs:{id:"searchResultPanel"}}),e._v(" "),i("el-select",{staticClass:"maps",attrs:{placeholder:"请选择"},model:{value:e.maps,callback:function(t){e.maps=t},expression:"maps"}},[i("el-option",{attrs:{label:"百度地图",value:"baidu"}}),e._v(" "),i("el-option",{attrs:{label:"高德地图",value:"gaode"}}),e._v(" "),i("el-option",{attrs:{label:"谷歌地图",value:"google"}})],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.formshow,expression:"formshow"}],staticClass:"form"},[i("div",{staticClass:"form_title"},[i("span",[e._v(e._s(e.typeTitle))]),e._v(" "),i("i",{staticClass:"el-icon-close",on:{click:e.formClose}})]),e._v(" "),i("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",staticStyle:{"padding-top":"20px"},attrs:{model:e.ruleForm,rules:e.rules,"label-width":"90px"}},["行政区域"!==e.typeTitle?i("el-form-item",{attrs:{label:"所属公司",prop:"companyId"}},[i("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择活动区域"},model:{value:e.ruleForm.companyId,callback:function(t){e.$set(e.ruleForm,"companyId",t)},expression:"ruleForm.companyId"}},e._l(e.company,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1):e._e(),e._v(" "),i("el-form-item",{attrs:{label:"上级分类",prop:"typeId"}},[i("el-cascader",{attrs:{placeholder:"请选择上级分类",options:e.resetMenu,props:{checkStrictly:!0},clearable:""},on:{change:e.typeIdFn},model:{value:e.ruleForm.typeId,callback:function(t){e.$set(e.ruleForm,"typeId",t)},expression:"ruleForm.typeId"}})],1),e._v(" "),"圆形"===e.typeTitle||"矩形"===e.typeTitle||"多边形"===e.typeTitle?i("el-form-item",{attrs:{label:"区域名称",prop:"regionName"}},[i("el-input",{staticStyle:{width:"193px"},model:{value:e.ruleForm.regionName,callback:function(t){e.$set(e.ruleForm,"regionName",t)},expression:"ruleForm.regionName"}})],1):e._e(),e._v(" "),"标注名称"!==e.typeTitle?i("el-form-item",{attrs:{label:"进出类型",prop:"entryType"}},[i("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择进出类型"},model:{value:e.ruleForm.entryType,callback:function(t){e.$set(e.ruleForm,"entryType",t)},expression:"ruleForm.entryType"}},[i("el-option",{attrs:{label:"禁入",value:1}}),e._v(" "),i("el-option",{attrs:{label:"禁出",value:2}})],1)],1):e._e(),e._v(" "),"标注名称"===e.typeTitle?i("el-form-item",{attrs:{label:"标注图片",prop:"icon"}},[i("el-radio-group",{on:{change:e.iconFn},model:{value:e.ruleForm.icon,callback:function(t){e.$set(e.ruleForm,"icon",t)},expression:"ruleForm.icon"}},e._l(e.icons,function(e){return i("el-radio",{key:e.index,attrs:{label:e.index}},[i("span",{staticClass:"img_box"},[i("img",{attrs:{src:e.icon,alt:"",srcset:""}})])])}))],1):e._e(),e._v(" "),"标注名称"===e.typeTitle?i("el-form-item",{attrs:{label:"标注名称",prop:"labelName"}},[i("el-input",{staticStyle:{width:"193px"},model:{value:e.ruleForm.labelName,callback:function(t){e.$set(e.ruleForm,"labelName",t)},expression:"ruleForm.labelName"}})],1):e._e(),e._v(" "),"标注名称"===e.typeTitle?i("el-form-item",{attrs:{label:"所在区域"}},[i("el-input",{staticStyle:{width:"193px"},model:{value:e.ruleForm.region,callback:function(t){e.$set(e.ruleForm,"region",t)},expression:"ruleForm.region"}})],1):e._e(),e._v(" "),"标注名称"===e.typeTitle?i("el-form-item",{attrs:{label:"详细地址"}},[i("el-input",{staticStyle:{width:"193px"},model:{value:e.ruleForm.address,callback:function(t){e.$set(e.ruleForm,"address",t)},expression:"ruleForm.address"}})],1):e._e(),e._v(" "),"标注名称"===e.typeTitle||"圆形"===e.typeTitle||"矩形"===e.typeTitle||"多边形"===e.typeTitle?i("el-form-item",{attrs:{label:"半径范围"}},[i("el-input",{staticStyle:{width:"193px"},model:{value:e.ruleForm.radiusRange,callback:function(t){e.$set(e.ruleForm,"radiusRange",t)},expression:"ruleForm.radiusRange"}},[i("template",{slot:"append"},[e._v("米")])],2)],1):e._e(),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.submitForm("ruleForm")}}},[e._v("确定")]),e._v(" "),i("el-button",{on:{click:e.formClose}},[e._v("取消")])],1)],1)],1)],1)},[],!1,null,"c06b2fd6",null);u.options.__file="bd-map.vue";t.default=u.exports},GEYe:function(e,t,i){"use strict";var n=i("fQs2");i.n(n).a},SCUe:function(e,t,i){var n=i("fCtq"),a=i("4Bx6");n(n.S+n.F*(Number.parseInt!=a),"Number",{parseInt:a})},fQs2:function(e,t,i){},jt9C:function(e,t,i){var n=i("fCtq"),a=i("EA3W"),o=i("mf7F"),l=i("yKOp"),r="["+l+"]",s=RegExp("^"+r+r+"*"),c=RegExp(r+r+"*$"),p=function(e,t,i){var a={},r=o(function(){return!!l[e]()||"​"!="​"[e]()}),s=a[e]=r?t(u):l[e];i&&(a[i]=s),n(n.P+n.F*r,"String",a)},u=p.trim=function(e,t){return e=String(a(e)),1&t&&(e=e.replace(s,"")),2&t&&(e=e.replace(c,"")),e};e.exports=p},yKOp:function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"}}]);