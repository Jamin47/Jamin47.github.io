(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0ad5"],{"63co":function(e,t,a){"use strict";var i=a("yikN");a.n(i).a},ZLLL:function(e,t,a){"use strict";a.r(t);var i=a("AlM9"),n=a("BHIJ"),s={components:{TableView:i.a,drawer:n.a},data:function(){return{title:"",fieldMap:{},vehicleIds:[],drawerDisplay:!1,drawerData:{},alias:{pageSize:"pageSize",pageNum:"pageNum"},tableOptions:{data:[],total:0,columns:[{type:"slot",name:"number",title:"序号"},{title:"车牌号码",key:"licenseNum",sort:"custom",type:"text"},{title:"车牌颜色",key:"licenseColor",type:"tag",tags:[]},{title:"运输证号",key:"transportNum",type:"text"},{title:"经营范围",key:"busScope",type:"text"},{title:"生效日期",key:"effectAt",type:"text"},{title:"失效日期",key:"timeoutAt",type:"text"},{title:"提前提醒天数",key:"advanceNum",type:"text"},{title:"操作",type:"operate",key:"operate",fixed:"right",width:"250",buttons:[{icon:"iconfont Jamin_vehicle_ico_xq",type:"text",size:"mini",funcName:"detail"},{icon:"iconfont Jamin_vehicle_icon_bj",type:"text",size:"mini",funcName:"edit"}]}],buttonControls:[{text:"添加运输证",type:"primary",size:"small",round:!1,icon:"el-icon-plus",funcName:"increase"},{text:"导出记录",type:"null",size:"small",round:!1,icon:"el-icon-download",funcName:"export"}],searchControls:[{type:"input",key:"licenseNum",placeholder:"车牌号码",width:"200px",size:"small"},{type:"input",key:"transportNum",placeholder:"运输证号",width:"200px",size:"small"}],footerButtons:[{text:"删除",type:"danger",size:"small",icon:"el-icon-delete",round:!1,funcName:"delete"}],paginationLayout:"total, sizes, prev, pager, next, jumper",loading:!1}}},computed:{},created:function(){},mounted:function(){var e=this;this.$http.get("/dict/list/codes",{dicCodes:"licenseColor"}).then(function(t){t.code===e.$config.API_STATUS.OK&&t.data.licenseColor.forEach(function(t,a){e.tableOptions.columns[2].tags[a]={value:t.itemName,text:t.itemValue}})})},methods:{getTableData:function(e){var t=this;this.tableOptions.loading=!0;var a={licenseNum:e.licenseNum,transportNum:e.transportNum};this.$http.post("/transport/list?pageNum="+e.pageNum+"&pageSize="+e.pageSize,a).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.tableOptions.loading=!1,t.tableOptions.data=e.data.list,e.data.total&&(t.tableOptions.total=e.data.total))})},newVehicle:function(){var e=this;this.$http.get("/vehicle/list/transport/all").then(function(t){e.vehicleIds=[],t.code===e.$config.API_STATUS.OK&&(t.data.forEach(function(t,a){e.$set(e.vehicleIds,a,{value:t.vehicleId,name:t.licenseNum})}),e.drawerDisplay=!0,e.increaseData())})},oldVehicle:function(e){var t=this;this.$http.get("/vehicle/list/transport/all/"+e.id).then(function(a){t.vehicleIds=[],a.code===t.$config.API_STATUS.OK&&(a.data.forEach(function(e,a){t.$set(t.vehicleIds,a,{value:e.vehicleId,name:e.licenseNum})}),t.drawerDisplay=!0,"编辑"===t.title?t.editData(e):t.detailData(e))})},tableResponseFn:function(e,t,a){this[t.funcName].call(function(){},e,t,a)},increase:function(){this.newVehicle()},increaseData:function(){this.drawerData={isShow:!0,title:"添加运输证",titleWidth:"120",data:{},defaultData:"",submitAction:"/transport/create",btnAlign:"center",formList:[{title:"绑定车辆",type:"select",key:"vehicleId",offsetWidth:"320",options:{type:"default",list:this.vehicleIds},rules:[{required:!0,message:"请绑定车辆",trigger:"change"}]},{title:"运输证号",type:"input",key:"transportNum",offsetWidth:"320",rules:[{required:!0,message:"请输入运输证号",trigger:"blur"}]},{title:"经营范围",type:"input",key:"busScope",offsetWidth:"320",rules:[{required:!0,message:"请输入使用性质",trigger:"blur"}]},{title:"生效时间",type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"effectAt",rules:[{required:!0,message:"请选择生效时间",trigger:"change"}]},{title:"失效时间",type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"timeoutAt",handlerCallback:{target:"changeFunction",funcName:"endTime"},rules:[{required:!0,message:"请选择到期时间",trigger:"change"}]},{title:"提前提醒天数",type:"input",key:"advanceNum",offsetWidth:"320",rules:[{required:!0,message:"请输入提前提醒天数",trigger:"blur"}]},{title:"备注说明",type:"input",offsetWidth:"320",key:"remark"}],formButton:[{name:"确定",type:"confirm",class:"primary"},{name:"取消",type:"cancel",class:""}],message:{type:"success",message:"添加成功！"}}},export:function(e){var t=this;this.$confirm("确认导出记录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1,beforeClose:function(e,a,i){t.fieldMap={},t.tableOptions.columns.forEach(function(e){t.$refs.table.columnCheckList.forEach(function(a){e.key===a&&"operate"!==e.key&&(t.fieldMap[a]=e.title)})});var n=t.$refs.table._data.searchParams,s=n.licenseNum,l=n.transportNum;if("confirm"===e){var o={fieldMap:t.fieldMap,licenseNum:s,transportNum:l};t.$http.download("/transport/export?isToken=true",o).then(function(e){}),i()}else i()}}).catch(function(){})},delete:function(e){var t=this;this.$confirm("是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a=[];e.forEach(function(e,t){a[t]=e.id}),t.$http.deleteApi("/transport/delete",{ids:a.join(",")}).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.$refs.table.emitRequestTableData(),t.$message({message:e.message,type:"success"}))})}).catch(function(){t.$message({type:"info",message:"已取消"})})},edit:function(e){this.title="编辑",this.oldVehicle(e)},editData:function(e){this.drawerData={staticData:e,isShow:!0,title:"编辑运输证",titleWidth:"120",data:{},defaultData:"",submitAction:"/transport/update/"+e.id,btnAlign:"center",formList:[{title:"绑定车辆",type:"select",key:"vehicleId",offsetWidth:"320",options:{type:"default",list:this.vehicleIds},rules:[{required:!0,message:"请绑定车辆",trigger:"change"}]},{title:"运输证号",type:"input",key:"transportNum",offsetWidth:"320",rules:[{required:!0,message:"请输入运输证号",trigger:"blur"}]},{title:"经营范围",type:"input",key:"busScope",offsetWidth:"320",rules:[{required:!0,message:"请输入使用性质",trigger:"blur"}]},{title:"生效时间",type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"effectAt",rules:[{required:!0,message:"请选择生效时间",trigger:"change"}]},{title:"失效时间",type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"timeoutAt",handlerCallback:{target:"changeFunction",funcName:"endTime"},rules:[{required:!0,message:"请选择到期时间",trigger:"change"}]},{title:"提前提醒天数",type:"input",key:"advanceNum",offsetWidth:"320",rules:[{required:!0,message:"请输入提前提醒天数",trigger:"blur"}]},{title:"备注说明",type:"input",offsetWidth:"320",key:"remark"}],formButton:[{name:"确定",type:"confirm",class:"primary"},{name:"取消",type:"cancel",class:""}],message:{type:"success",message:"编辑成功！"}}},detail:function(e){this.title="详情",this.oldVehicle(e)},detailData:function(e){this.drawerData={staticData:e,isShow:!0,title:"运输证详情",titleWidth:"120",data:{},defaultData:"",submitAction:"/transport/update/"+e.id,btnAlign:"center",formList:[{title:"绑定车辆",type:"textSelect",key:"vehicleId",offsetWidth:"320",list:this.vehicleIds},{title:"运输证号",type:"text",key:"transportNum",offsetWidth:"320"},{title:"经营范围",type:"text",key:"busScope",offsetWidth:"320"},{title:"生效时间",type:"text",offsetWidth:"320",key:"effectAt"},{title:"失效时间",type:"text",offsetWidth:"320",key:"timeoutAt"},{title:"提前提醒天数",type:"text",key:"advanceNum",offsetWidth:"320"},{title:"备注说明",type:"text",offsetWidth:"320",key:"remark"}]}},diaClose:function(){this.$refs.table.emitRequestTableData(),this.drawerDisplay=!1},endTime:function(e){this.$refs.drawer.formData.effectAt?new Date(e).getTime()<=new Date(this.$refs.drawer.formData.effectAt).getTime()&&(this.$message.error("结束时间不得小于开始时间"),this.$refs.drawer.formData.timeoutAt=null):(this.$message.error("请先选择开始时间"),this.$refs.drawer.formData.timeoutAt=null)},drawerCallback:function(e,t,a,i){this[e.handlerCallback.funcName].call(function(){},t,a,i)}}},l=(a("63co"),a("ZrdR")),o=Object(l.a)(s,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"transportCertificate"},[a("table-view",{ref:"table",attrs:{stripe:"",center:"","id-key":"id","is-search":!0,data:e.tableOptions.data,total:e.tableOptions.total,columns:e.tableOptions.columns,"search-controls":e.tableOptions.searchControls,"footer-buttons":e.tableOptions.footerButtons,"button-controls":e.tableOptions.buttonControls,"pagination-layout":e.tableOptions.paginationLayout,loading:e.tableOptions.loading,checked:"","column-view":"","is-shadow":"",alias:e.alias},on:{requestTableData:e.getTableData,handleCallback:e.tableResponseFn}},[a("el-table-column",{attrs:{slot:"number",label:"序号",type:"index",align:"center"},slot:"number"})],1),e._v(" "),e.drawerDisplay?a("drawer",{ref:"drawer",attrs:{"drawer-data":e.drawerData},on:{diaClose:e.diaClose,handlerCallback:e.drawerCallback}}):e._e()],1)},[],!1,null,"6c099fbe",null);o.options.__file="transportCertificate.vue";t.default=o.exports},yikN:function(e,t,a){}}]);