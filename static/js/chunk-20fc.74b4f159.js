(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-20fc"],{ACaK:function(t,e,i){},Mj9z:function(t,e,i){"use strict";var a=i("ACaK");i.n(a).a},j1td:function(t,e,i){"use strict";i.r(e);var a=i("cLjf"),n=i.n(a),s=i("hDQ3"),o=i.n(s),l=i("AlM9"),r=i("BHIJ"),c={name:"CompanyManagement",components:{TableView:l.a,drawer:r.a},data:function(){return{industry:[],fieldMap:{},companyList:[],display:!1,drawerDisplay:!1,drawerData:{},alias:{pageSize:"pageSize",pageNum:"pageNum"},tableOptions:{data:[],total:0,columns:[{type:"slot",name:"number",title:"序号"},{title:"公司全称",key:"name",minWidth:"220",sort:"custom",type:"text"},{title:"公司简称",key:"abbrName",minWidth:"120",type:"text"},{title:"主账号",key:"account",minWidth:"120",type:"text"},{title:"所属行业",key:"industry",type:"tagText",minWidth:"130",tags:[]},{title:"上级公司",key:"parentName",minWidth:"200",type:"text"},{title:"车辆总数",key:"vehiclesTotal",minWidth:"120",type:"text"},{title:"状态",key:"status",minWidth:"120",type:"tagText",tags:[{value:1,text:"正常"},{value:0,text:"禁用",option:{type:"warning"}},{value:2,text:"已过期",option:{type:"danger"}}]},{title:"创建时间",key:"createTime",minWidth:"160",type:"text"},{title:"操作",key:"operate",type:"operate",fixed:"right",minWidth:"150",buttons:[{type:"text",size:"mini",icon:"iconfont Jamin_vehicle_ico_xq",funcName:"details"},{type:"text",size:"mini",icon:"iconfont Jamin_vehicle_icon_bj",funcName:"edit"},{type:"text",size:"mini",icon:"iconfont Jamin_vehicle_icon_gxh",funcName:"individualization"}]}],buttonControls:[{text:"添加企业",type:"primary",size:"small",round:!1,funcName:"increase"},{text:"导出记录",type:"null",size:"small",round:!1,funcName:"export"}],searchControls:[{type:"input",key:"name",placeholder:"请输入公司名称",width:"200px"},{type:"select",key:"industry",placeholder:"请选择所属行业",width:"200px",clearable:!0,options:[]},{type:"select",key:"status",placeholder:"请选择状态",width:"200px",clearable:!0,options:[{name:"正常",value:1},{name:"禁用",value:0},{name:"已过期",value:2}]}],footerButtons:[{text:"启用",type:"",size:"small",icon:"el-icon-delete",round:!1,funcName:"enable"},{text:"禁用",type:"danger",size:"small",icon:"el-icon-circle-close",round:!1,funcName:"disable"},{text:"删除",type:"danger",size:"small",icon:"el-icon-delete",round:!1,funcName:"delete"}],paginationLayout:"total, sizes, prev, pager, next, jumper",loading:!1}}},computed:{},created:function(){},mounted:function(){this.industryList()},methods:{industryList:function(){var t=this;this.$http.get("/dict/list/codes",{dicCodes:"industry"}).then(function(e){e.code===t.$config.API_STATUS.OK&&e.data.industry.forEach(function(e,i){t.industry[i]={value:e.itemName,name:e.itemValue},t.tableOptions.columns[4].tags[i]={value:e.itemName,text:e.itemValue},t.tableOptions.searchControls[1].options[i]={value:e.itemName,name:e.itemValue}})})},getTableData:function(t){var e=this;this.tableOptions.loading=!0,this.$http.post("/company/list?pageNum="+t.pageNum+"&pageSize="+t.pageSize,t).then(function(t){t.code===e.$config.API_STATUS.OK&&(e.tableOptions.loading=!1,e.tableOptions.data=t.data.list,t.data.total&&(e.tableOptions.total=t.data.total))}),this.$http.post("/company/list").then(function(t){t.code===e.$config.API_STATUS.OK&&(t.data.list.forEach(function(t,i){e.companyList[i]={name:t.name,value:t.companyId}}),e.companyList.unshift({name:"无",value:0}))})},tableResponseFn:function(t,e,i){this[e.funcName].call(function(){},t,e,i)},increase:function(){this.drawerDisplay=!0,this.drawerData={isShow:!0,title:"添加公司",titleWidth:"120",btnAlign:"center",submitAction:"/company/create",formList:[{title:"公司全称",type:"input",key:"name",offsetWidth:"320",rules:[{required:!0,message:"请输入公司全称",trigger:"blur"}]},{title:"公司简称",type:"input",key:"abbrName",offsetWidth:"320",rules:[{required:!0,message:"请输入公司简称",trigger:"blur"}]},{title:"上级公司",type:"select",key:"parentId",filterable:!0,offsetWidth:"320",options:{type:"default",list:this.companyList},rules:[{required:!0,message:"请选择上级公司",trigger:"change"}]},{title:"主账号",type:"input",key:"account",offsetWidth:"320",placeholder:"字母、数字、下划线或中文组成",rules:[{required:!0,message:"请输入主账号",trigger:"blur"}]},{title:"登录密码",type:"input",offsetWidth:"320",key:"password",placeholder:"字母或数字、下划线组成,6到20位",rules:[{required:!0,message:"请输入登录密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}]},{title:"用户姓名",type:"input",key:"username",offsetWidth:"320",rules:[{required:!0,message:"请输入用户姓名",trigger:"blur"}]},{title:"到期时间",type:"dateSelect",valueFormat:"yyyy-MM-dd",key:"timeoutAt",offsetWidth:"320",placeholder:"不填写则默认账号永久有效"},{title:"所属行业",type:"select",key:"industry",offsetWidth:"320",filterable:!0,options:{type:"default",list:this.industry}},{title:"联系人",type:"input",offsetWidth:"320",key:"contactPerson"},{title:"联系电话",type:"input",offsetWidth:"320",key:"contactPhone"},{title:"联系地址",type:"input",offsetWidth:"320",key:"contactAddr"}],formButton:[{name:"确定",type:"confirm",class:"primary"},{name:"取消",type:"cancel",class:""}],message:{type:"success",message:"添加企业成功！"}}},export:function(){var t=this;this.$confirm("确认导出记录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1,beforeClose:function(e,i,a){t.fieldMap={},t.tableOptions.columns.forEach(function(e){t.$refs.table.columnCheckList.forEach(function(i){e.key===i&&"operate"!==e.key&&(t.fieldMap[i]=e.title)})});var n=t.$refs.table._data.searchParams,s=n.industry,o=n.name,l=n.status;if("confirm"===e){var r={fieldMap:t.fieldMap,industry:s,name:o,status:l};t.$http.download("/company/export?isToken=true",r).then(function(t){}),a()}else a()}}).catch(function(){})},details:function(t){var e=this;return o()(n.a.mark(function i(){return n.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,e.$http.get("/company/"+t.companyId).then(function(t){if(t.code===e.$config.API_STATUS.OK)return t.data});case 2:t=i.sent,e.drawerDisplay=!0,e.drawerData={staticData:t,isShow:!0,title:"公司详情",titleWidth:"120",btnAlign:"center",formList:[{title:"公司全称",type:"text",key:"name",offsetWidth:"320",rules:[{required:!0,message:"请输入公司全称",trigger:"blur"}]},{title:"公司简称",type:"text",offsetWidth:"320",key:"abbrName"},{title:"上级公司",type:"textSelect",offsetWidth:"320",key:"parentId",list:e.companyList},{title:"所属行业",type:"textSelect",key:"industry",offsetWidth:"320",filterable:!0,list:e.industry},{title:"联系人",type:"text",offsetWidth:"320",key:"contactPerson"},{title:"联系电话",type:"text",offsetWidth:"320",key:"contactPhone"},{title:"联系地址",type:"text",offsetWidth:"320",key:"contactAddr"}]};case 5:case"end":return i.stop()}},i,e)}))()},edit:function(t){var e=this;this.$http.get("/company/"+t.companyId).then(function(i){i.code===e.$config.API_STATUS.OK&&(t=i.data,e.drawerDisplay=!0,e.drawerData={staticData:t,isShow:!0,title:"编辑公司",titleWidth:"120",btnAlign:"center",submitAction:"/company/update/"+t.companyId,formList:[{title:"公司全称",type:"input",offsetWidth:"320",key:"name",rules:[{required:!0,message:"请输入公司全称",trigger:"blur"}]},{title:"公司简称",type:"input",offsetWidth:"320",key:"abbrName",rules:[{required:!0,message:"请输入公司简称",trigger:"blur"}]},{title:"上级公司",type:"select",key:"parentId",filterable:!0,offsetWidth:"320",options:{type:"default",list:e.companyList},rules:[{required:!0,message:"请选择上级公司",trigger:"change"}]},{title:"所属行业",type:"select",key:"industry",offsetWidth:"320",filterable:!0,options:{type:"default",list:e.industry}},{title:"联系人",type:"input",offsetWidth:"320",key:"contactPerson"},{title:"联系电话",type:"input",offsetWidth:"320",key:"contactPhone"},{title:"联系地址",type:"input",offsetWidth:"320",key:"contactAddr"}],formButton:[{name:"确定",type:"confirm",class:"primary"},{name:"取消",type:"cancel",class:""}],message:{type:"success",message:"编辑成功！"}})})},individualization:function(t){var e=this;this.$http.get("/company/"+t.companyId).then(function(i){i.code===e.$config.API_STATUS.OK&&(t=i.data,e.drawerDisplay=!0,e.individualizationData(t))})},individualizationData:function(t){var e=this,i=t.sysTitle,a=t.loginDomain,n=t.sysCorn;this.drawerData={staticData:{sysTitle:i,loginDomain:a,sysCorn:n},isShow:!0,title:"个性化设置",titleWidth:"120",btnAlign:"center",submitAction:"/company/personalization/"+t.companyId,formList:[{title:"系统标题",type:"input",offsetWidth:"320",key:"sysTitle",rules:[{required:!0,message:"请输入系统标题",trigger:"blur"}]},{title:"登录域名",type:"input",offsetWidth:"320",key:"loginDomain",rules:[{required:!0,message:"请输入登录域名",trigger:"blur"}]},{title:"系统图片",type:"imgUpload",offsetWidth:"320",action:this.$config.API_CONFIG.API_ROOT+"/file/upload/sysCorn",key:"sysCorn",accept:"image/jpeg,image/png",headers:{Authorization:this.$store.getters.userData.tokenHead+this.$store.getters.userData.token},showFileList:!1,beforeUpload:function(t){},onProgress:function(t){},onSuccess:function(t){t.code===e.$config.API_STATUS.OK&&e.$set(e.$refs.drawer.formData,"sysCorn",t.data.url)}}],formButton:[{name:"确定",type:"confirm",class:"primary"},{name:"取消",type:"cancel",class:""}],message:{type:"success",message:"编辑成功！"}}},submitForm:function(t){this.$refs[t].validate(function(t){if(!t)return!1;alert("submit!")})},diaClose:function(){var t=this;this.$refs.table.emitRequestTableData(),this.drawerDisplay=!1,this.isTable=!1,this.$nextTick(function(){t.isTable=!0})},drawerCallback:function(t,e,i,a){this[t.handlerCallback.funcName].call(function(){},e,i,a)},enable:function(t){var e=this,i=[];t.forEach(function(t,e){i[e]=t.companyId}),this.$http.deleteApi("/company/status",{ids:i.join(","),status:1}).then(function(t){t.code===e.$config.API_STATUS.OK&&(e.$refs.table.emitRequestTableData(),e.$message({message:t.message,type:"success"}))})},disable:function(t){var e=this,i=[];t.forEach(function(t,e){i[e]=t.companyId}),this.$http.deleteApi("/company/status",{ids:i.join(","),status:0}).then(function(t){t.code===e.$config.API_STATUS.OK&&(e.$refs.table.emitRequestTableData(),e.$message({message:t.message,type:"success"}))})},delete:function(t){var e=this;this.$confirm("是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var i=[];t.forEach(function(t,e){i[e]=t.companyId}),e.$http.deleteApi("/company/delete",{ids:i.join(",")}).then(function(t){t.code===e.$config.API_STATUS.OK&&(e.$refs.table.emitRequestTableData(),e.$message({message:t.message,type:"success"}))})}).catch(function(){e.$message({type:"info",message:"已取消"})})}}},u=(i("Mj9z"),i("ZrdR")),d=Object(u.a)(c,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"page-wrap"},[i("table-view",{ref:"table",attrs:{center:"","id-key":"id","is-search":!0,data:t.tableOptions.data,total:t.tableOptions.total,columns:t.tableOptions.columns,"search-controls":t.tableOptions.searchControls,"footer-buttons":t.tableOptions.footerButtons,"button-controls":t.tableOptions.buttonControls,"pagination-layout":t.tableOptions.paginationLayout,loading:t.tableOptions.loading,checked:"","column-view":"","is-shadow":"",alias:t.alias},on:{requestTableData:t.getTableData,handleCallback:t.tableResponseFn}},[i("el-table-column",{attrs:{slot:"number",label:"序号",type:"index",align:"center"},slot:"number"})],1),t._v(" "),t.drawerDisplay?i("drawer",{ref:"drawer",attrs:{size:"small","drawer-data":t.drawerData},on:{diaClose:t.diaClose,handlerCallback:t.drawerCallback}}):t._e()],1)},[],!1,null,"44866188",null);d.options.__file="companyManagement.vue";e.default=d.exports}}]);