(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-f5c8"],{"9uQH":function(e,t,a){e.exports=a.p+"static/img/vehicle_pic_yx.5215034.png"},II04:function(e,t,a){e.exports=a.p+"static/img/vehicle_pic_dbx.433ef3d.png"},Oa2j:function(e,t,a){"use strict";var i=a("vBxh");a.n(i).a},iNRi:function(e,t,a){"use strict";a.r(t);var i=a("omC7"),n=a.n(i),s=a("bS4n"),o=a.n(s),l=a("ABCu"),r=a("kDn8"),c=a("AlM9"),d=a("EXUM"),p=a("9uQH"),u=a.n(p),m=a("mh7c"),f=a.n(m),h=a("II04"),y=a.n(h),g=a("8t5x"),b={name:"VehicleAdminister",components:{treeView:l.a,dialogDesign:r.a,TableView:c.a,bdMap:d.default},data:function(){return{icons:[{icon:u.a,name:"圆形",id:1},{icon:f.a,name:"矩形",id:2},{icon:y.a,name:"多边形",id:3}],visible:!1,widthNum:0,show:!1,viewLeft:!1,company:[],dialogDisplay:!1,alias:{pageSize:"pageSize",pageNum:"pageNum"},typeTitle:null,fieldMap:{},activeMenu:{typeId:null,name:""},typeId:null,isTree:!0,filterText:"",resTreeData:null,resetData:{parentId:"parentId",value:"typeId",label:"typeName",children:"opEfTypeNodes"},resetMenus:[],treeData:{extendData:{},checkOriginName:"",treeQuery:{type:"get",action:"/ef/type/treeList/1",list:null},defaultProps:{children:"opEfTypeNodes",label:"typeName",isLeaf:"lezy",disabled:"disabled"},emptyText:"暂无数据",nodeKey:"typeId",currentNodeKey:1,defaultExpandAll:!0,expandClickNode:!1,indent:16,screenFn:{bindFn:function(e,t){return!e||-1!==t.typeName.indexOf(e)}},draggable:{isDraggable:!1,allowDrap:function(e,t,a){return!0},allowDrop:function(e,t,a){return e.data.type===t.data.type?"inner"!==a:(1!==e.data.type||0!==t.data.type)&&(0!==e.data.type||1!==t.data.type)}}},params:{},tableOptions:{data:[],total:0,columns:[{type:"slot",name:"number",title:"序号"},{title:"区域形状",type:"slot",name:"regionType"},{title:"区域名称",type:"text",minWidth:"130",key:"regionName"},{title:"所属分类",key:"typeName",minWidth:"130",type:"text"},{title:"所属公司",key:"companyName",minWidth:"150",type:"text"},{title:"类型",key:"entryType",minWidth:"130",type:"tagText",tags:[{text:"禁入",value:1},{text:"禁出",value:2,option:{type:"danger"}}]},{title:"创建时间",key:"createTime",minWidth:"220",type:"text"},{title:"操作",key:"operate",type:"operate",fixed:"right",width:"250",buttons:[{size:"mini",type:"text",icon:"iconfont Jamin_vehicle_ico_xq",funcName:"details"},{size:"mini",type:"text",icon:"iconfont Jamin_vehicle_icon_bj",funcName:"edit"}],mode:"default",dropdownType:"primary"}],buttonControls:[{text:"添加区域",size:"mini",round:!1,icon:"el-icon-plus",funcName:"addVehicle"},{text:"导出记录",size:"mini",type:"null",round:!1,icon:"el-icon-download",funcName:"exportRecord"}],searchControls:[{type:"input",key:"regionName",placeholder:"区域名称",width:"200px",size:"small"},{type:"select",key:"regionType",placeholder:"区域形状",width:"200px",size:"small",filterable:!0,clearable:!0,options:[{name:"圆形",value:1},{name:"矩形",value:2},{name:"多边形",value:3}]},{type:"select",key:"companyId",placeholder:"所属公司",width:"200px",size:"small",filterable:!0,clearable:!0,options:[{name:"无",value:0}]},{type:"select",key:"entryType",placeholder:"类型",width:"200px",size:"small",filterable:!0,clearable:!0,options:[{name:"禁入",value:1},{name:"禁出",value:2}]}],searchMode:"immediate",footerButtons:[{text:"移动",type:"",size:"mini",icon:"el-icon-remove-outline",round:!1,funcName:"move"},{text:"删除",type:"danger",size:"mini",icon:"el-icon-delete",round:!1,funcName:"delete"}],paginationLayout:"total, sizes, prev, pager, next, jumper",loading:!1}}},computed:o()({},Object(g.b)(["elNorms"])),watch:{filterText:function(e){this.$refs.tree.$refs.sonTree.filter(e)}},created:function(){},mounted:function(){},methods:{addVehicle:function(){this.visible=!this.visible},iconMap:function(e){var t=this;switch(e){case 1:this.typeTitle="圆形";break;case 2:this.typeTitle="矩形";break;case 3:this.typeTitle="多边形"}setTimeout(function(){t.show=!0,t.$refs.bdmap.addRegion()},100)},diaClose:function(e){var t=this;this.treeData.currentNodeKey=this.activeMenu.typeId,e&&(this.isTree=!1,this.$nextTick(function(){t.isTree=!0})),this.dialogDisplay=!1},details:function(e){var t=this;this.$http.get("/region/"+e.regionId).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.show=!0,t.$refs.bdmap.detailsRegion(e.data))})},edit:function(e){var t=this;this.$http.get("/region/"+e.regionId).then(function(e){if(e.code===t.$config.API_STATUS.OK){switch(e.data.regionType){case 1:t.typeTitle="圆形";break;case 2:t.typeTitle="矩形";break;case 3:t.typeTitle="多边形"}setTimeout(function(){t.show=!0,t.$refs.bdmap.editRegion(e.data)},100)}})},dialogCallback:function(e,t,a){this[e.handlerCallback.funcName].call(function(){},e,t,a)},addMenu:function(e){"click"===e.type&&(e={}),this.dialogData={staticData:{parentId:e.typeId},isClickClose:!1,isDialogDisplay:!0,title:"添加分类",data:{},defaultData:{fenceType:1},mainWidth:"500",titleWidth:"100",submitAction:"/ef/type/create",btnAlign:"center",formList:[{title:"上级分类",type:"cascader",labelWidth:"100",offsetWidth:"320",key:"parentId",props:{checkStrictly:!0,emitPath:!1},options:{type:"default",list:this.resetMenus},handlerCallback:{target:"changeFunction",funcName:"cascaderChange"},rules:[{required:!0,message:"请选择上级分类",trigger:"change"}]},{title:"分类名称",type:"input",offsetWidth:"320",key:"typeName",rules:[{required:!0,message:"请输入分类名称",trigger:"blur"}]}],message:{message:"分类添加成功！",type:"success"},formButton:[{name:"提交",type:"confirm",class:"primary",round:!1},{name:"取消",type:"cancel",class:"",round:!1}]},this.dialogDisplay=!0},editMenu:function(e){-1===this.resetMenus[0].value&&(this.resetMenu=JSON.parse(n()(this.resetMenus)).splice(-1,1)),delete e.list,this.dialogData={isClickClose:!1,staticData:e,isDialogDisplay:!0,title:"编辑分类",data:{},defaultData:{fenceType:1},mainWidth:"500",titleWidth:"100",submitAction:"/ef/type/update/"+e.typeId,btnAlign:"center",formList:[{title:"上级分类",type:"cascader",labelWidth:"100",offsetWidth:"320",key:"parentId",props:{checkStrictly:!0,emitPath:!1},options:{type:"default",list:this.resetMenu},handlerCallback:{target:"changeFunction",funcName:"cascaderChange"},rules:[{required:!0,message:"请选择上级分类",trigger:"change"}]},{title:"分类名称",type:"input",offsetWidth:"320",key:"typeName",rules:[{required:!0,message:"请输入分类名称",trigger:"blur"}]}],message:{message:"分类编辑成功！",type:"success"},formButton:[{name:"提交",type:"confirm",class:"primary",round:!1},{name:"取消",type:"cancel",class:"",round:!1}]},this.dialogDisplay=!0},handleCommand:function(e){this[e.funcName].call(function(){},e.data,e.node,e.funcName)},removeTree:function(e){var t=this;this.$confirm("此操作将永久删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$http.get("/ef/type/delete/"+e.typeId).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.$message({type:"success",message:"删除成功!"}),t.isTree=!1,t.$nextTick(function(){t.isTree=!0}))})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},getTreeData:function(e){var t=JSON.parse(n()(e));t.unshift({typeName:"无",typeId:-1,parentId:0}),this.resTreeData=e,this.resetDataFn(t,!1),this.$refs.table.emitRequestTableData()},nodeClick:function(e,t){e.children&&e.children.length||(this.activeMenu={typeId:e.typeId,name:e.typeName},this.parentId=e.parentId),this.typeId=e.typeId,this.$refs.table.emitRequestTableData()},getTableData:function(e){var t=this;this.tableOptions.loading=!0;var a={typeId:this.typeId,region:e.region,driverName:e.driverName,companyId:e.companyId};this.$http.post("/region/list?pageNum="+e.pageNum+"&pageSize="+e.pageSize,a).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.tableOptions.loading=!1,t.tableOptions.data=e.data.list,e.data.total&&(t.tableOptions.total=e.data.total))}),this.$http.post("/company/list").then(function(e){e.code===t.$config.API_STATUS.OK&&(t.tableOptions.searchControls[2].options=[],e.data.list.forEach(function(e,a){t.tableOptions.searchControls[2].options[a]={name:e.name,value:e.companyId},t.company[a]={label:e.name,value:e.companyId}}))})},tableResponseFn:function(e,t,a){this[t.funcName].call(function(){},e,t,a)},move:function(e){var t=[];e.forEach(function(e,a){t[a]=e.regionId}),-1===this.resetMenus[0].value&&(this.resetMenu=JSON.parse(n()(this.resetMenus)).splice(-1,1)),this.dialogData={isClickClose:!1,staticData:"",isDialogDisplay:!0,title:"调整分类",data:{},defaultData:{ids:t.join(",")},methods:"deleteApi",mainWidth:"500",titleWidth:"100",submitAction:"/region/update",btnAlign:"center",formList:[{title:"上级分类",type:"cascader",labelWidth:"100",offsetWidth:"320",key:"typeId",props:{checkStrictly:!0,emitPath:!1},options:{type:"default",list:this.resetMenu},handlerCallback:{target:"changeFunction",funcName:"cascaderChange"},rules:[{required:!0,message:"请选择分类",trigger:"change"}]}],message:{message:"调整成功！",type:"success"},formButton:[{name:"提交",type:"confirm",class:"primary",round:!1},{name:"取消",type:"cancel",class:"",round:!1}]},this.dialogDisplay=!0},delete:function(e){var t=this;this.$confirm("是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a=[];e.forEach(function(e,t){a[t]=e.regionId}),t.$http.deleteApi("/region/delete",{ids:a.join(",")}).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.$refs.table.emitRequestTableData(),t.$message({message:e.message,type:"success"}))})}).catch(function(){t.$message({type:"info",message:"已取消"})})},resetDataFn:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.resetData){var i=[];if(e.forEach(function(e){var a=t.initJSON(t.resetData,e);i.push(a)}),!0===a)return i;this.resetMenus=i}},initJSON:function(e,t){var a={};for(var i in e)if("children"===i&&t[e[i]]&&t[e[i]].length>0){var n=this.resetDataFn(t[e[i]],!0);a[i]=n}else"children"!==i&&(a[i]=t[e[i]]);return a},disabledData:function(e){this.resetMenus.forEach(function(t){0===e&&t.children&&t.children.length>0&&(t.disabled=!0),t.children&&t.children.length>0&&t.children.forEach(function(t){1===e&&(t.disabled=!1)})})},nodeDragEnd:function(e,t,a){var i=this;this.$http.post("/sys/menu/sort",{motorcadeId:e.data.motorcadeId,targetId:t.data.motorcadeId,moveType:a}).then(function(e){e.code,i.$config.API_STATUS,i.isTree=!1,i.$nextTick(function(){i.isTree=!0})}).catch(function(e){i.isTree=!1,i.$nextTick(function(){i.isTree=!0})})},cascaderChange:function(e,t,a){null===t&&(t=0),this.$refs._dialog.dialogData.defaultData.parentId=-1===t?0:t,this.$refs._dialog.dialogData.defaultData.fenceType=1,"0"===t&&(this.$refs._dialog.dialogData.defaultData={type:0})},exportRecord:function(){var e=this;this.$confirm("确认导出记录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1,beforeClose:function(t,a,i){if(e.fieldMap={},e.tableOptions.columns.forEach(function(t){e.$refs.table.columnCheckList.forEach(function(a){t.key===a&&"operate"!==t.key&&(e.fieldMap[a]=t.title)})}),"confirm"===t){var n=e.$refs.table._data.searchParams,s=n.regionName,o=n.regionType,l=n.companyId,r=n.entryType,c={fieldMap:e.fieldMap,regionName:s,regionType:o,companyId:l,entryType:r};e.$http.download("/region/export?isToken=true",c).then(function(e){}),i()}else i()}}).catch(function(){})}}},v=(a("Oa2j"),a("ZrdR")),T=Object(v.a)(b,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"table"},[a("div",{staticClass:"page-body"},[a("el-collapse-transition",[a("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"visible"},[a("div",{staticClass:"arrow"}),e._v(" "),e._l(e.icons,function(t){return a("div",{key:t.id,staticClass:"icons",on:{click:function(a){e.iconMap(t.id)}}},[a("img",{attrs:{src:t.icon,alt:""}}),e._v(" "),a("span",{staticStyle:{"font-size":"14px"}},[e._v(e._s(t.name))])])})],2)]),e._v(" "),a("div",{staticClass:"con-left"},[a("div",{staticClass:"input-query"},[a("el-input",{staticStyle:{width:"170px","margin-right":"4px"},attrs:{size:e.elNorms.size,placeholder:"搜索分类名称","prefix-icon":"el-icon-search"},model:{value:e.filterText,callback:function(t){e.filterText="string"==typeof t?t.trim():t},expression:"filterText"}}),e._v(" "),a("el-button",{attrs:{size:e.elNorms.size,circle:e.elNorms.circle,round:e.elNorms.round},on:{click:e.addMenu}},[e._v("新增分类")])],1),e._v(" "),a("div",{staticClass:"body-tree init-tree"},[e.isTree?a("tree-view",{ref:"tree",attrs:{"tree-data":e.treeData},on:{treeDataFn:e.getTreeData,"node-click":e.nodeClick,"node-drag-end":e.nodeDragEnd},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"left-title text-ellipsis",style:t.data.data.typeId===e.activeMenu.typeId?"color: var(--main-primary);":""},[a("i",{staticClass:"iconfont Jamin_vehicle_icon_xiaowenjian"}),e._v("\n              "+e._s(t.data.data.typeName)+"\n            ")]),e._v(" "),a("span",{staticClass:"right-edit"},[a("span",[a("el-dropdown",{on:{command:e.handleCommand}},[a("span",{staticClass:"el-dropdown-link"},[a("i",{staticClass:"el-icon-more"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:{data:t.data.data,node:t.data.node,funcName:"addMenu"}}},[e._v("添加子分类")]),e._v(" "),a("el-dropdown-item",{attrs:{command:{data:t.data.data,node:t.data.node,funcName:"editMenu"}}},[e._v("编辑分类")]),e._v(" "),a("el-dropdown-item",{attrs:{command:{data:t.data.data,node:t.data.node,funcName:"removeTree"}}},[e._v("删除分类")])],1)],1)],1)])]}}])}):e._e()],1)]),e._v(" "),a("div",{staticClass:"con-right"},[a("transition",{attrs:{name:"opacity"}},[a("div",{staticClass:"opacity_table"},[a("table-view",{ref:"table",attrs:{stripe:"",center:"","id-key":"id","is-search":!0,data:e.tableOptions.data,total:e.tableOptions.total,columns:e.tableOptions.columns,"search-controls":e.tableOptions.searchControls,"footer-buttons":e.tableOptions.footerButtons,"button-controls":e.tableOptions.buttonControls,"pagination-layout":e.tableOptions.paginationLayout,loading:e.tableOptions.loading,checked:"","column-view":"","is-border":"",alias:e.alias},on:{requestTableData:e.getTableData,handleCallback:e.tableResponseFn}},[a("el-table-column",{attrs:{slot:"number",label:"序号",type:"index",align:"center"},slot:"number"}),e._v(" "),a("el-table-column",{attrs:{slot:"regionType",label:"图标",align:"center",width:"130"},slot:"regionType",scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.regionType?a("img",{attrs:{src:e.icons[t.row.regionType-1].icon,alt:""}}):e._e()]}}])})],1)],1)])],1),e._v(" "),a("transition",{attrs:{name:"el-zoom-in-bottom"}},[a("bd-map",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],ref:"bdmap",staticClass:"mapShow  left-control control-view",class:{leftActive:e.viewLeft},attrs:{"reset-menus":e.resetMenus,company:e.company,icons:e.icons,"view-left":e.viewLeft,"type-title":e.typeTitle}})],1)],1),e._v(" "),e.dialogDisplay?a("dialog-design",{ref:"_dialog",attrs:{size:"mini",color:"warning","dialog-data":e.dialogData},on:{diaClose:e.diaClose,handlerCallback:e.dialogCallback}}):e._e()],1)},[],!1,null,"5a6328a5",null);T.options.__file="region.vue";t.default=T.exports},mh7c:function(e,t,a){e.exports=a.p+"static/img/vehicle_pic_zfx.dd5e340.png"},vBxh:function(e,t,a){}}]);