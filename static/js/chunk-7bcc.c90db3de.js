(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-7bcc"],{EdgN:function(t,e,a){"use strict";var i=a("NaBp");a.n(i).a},NaBp:function(t,e,a){},Wiqz:function(t,e,a){"use strict";a.r(e);var i=a("BHIJ"),n={components:{TableView:a("AlM9").a,drawer:i.a},data:function(){return{vehicleIds:[],drawerDisplay:!1,drawerData:{},alias:{pageSize:"pageSize",pageNum:"pageNum"},tableOptions:{data:[],total:0,columns:[{type:"slot",name:"number",title:"序号"},{title:"车牌号码",key:"licenseNum",sort:"custom",minWidth:"180",type:"text"},{title:"所属公司",key:"companyName",type:"text",minWidth:"180"},{title:"本次年检时间",key:"annualAt",minWidth:"180",type:"text"},{title:"年检到期时间",key:"timeoutAt",minWidth:"180",type:"text"},{title:"年检费用(¥)",key:"price",minWidth:"180",type:"text"},{title:"办理人",key:"handler",minWidth:"180",type:"text"},{title:"操作",type:"operate",key:"operate",fixed:"right",width:"160",buttons:[{icon:"iconfont Jamin_vehicle_ico_xq",type:"text",size:"mini",funcName:"detail"},{icon:"iconfont Jamin_vehicle_icon_bj",type:"text",size:"mini",funcName:"edit"}]}],buttonControls:[{text:"添加年检",type:"primary",size:"small",round:!1,icon:"el-icon-plus",funcName:"increase"},{text:"导出记录",type:"null",size:"small",round:!1,icon:"el-icon-download",funcName:"export"}],searchControls:[{type:"input",key:"licenseNum",placeholder:"车牌号码",width:"200px",size:"small"},{type:"input",key:"companyName",placeholder:"所属公司",width:"200px",size:"small"}],footerButtons:[{text:"删除",type:"danger",size:"small",icon:"el-icon-delete",round:!1,funcName:"delete"}],paginationLayout:"total, sizes, prev, pager, next, jumper",loading:!1}}},computed:{},created:function(){},mounted:function(){},methods:{endTime:function(t){this.$refs.drawer.formData.annualAt?new Date(t).getTime()<=new Date(this.$refs.drawer.formData.annualAt).getTime()&&(this.$message.error("结束时间不得小于开始时间"),this.$refs.drawer.formData.timeoutAt=null):(this.$message.error("请先选择开始时间"),this.$refs.drawer.formData.timeoutAt=null)},getTableData:function(t){var e=this;this.tableOptions.loading=!0;var a={licenseNum:t.licenseNum,companyName:t.companyName};this.$http.post("/annual/list?pageNum="+t.pageNum+"&pageSize="+t.pageSize,a).then(function(t){t.code===e.$config.API_STATUS.OK&&(e.tableOptions.loading=!1,e.tableOptions.data=t.data.list,e.tableOptions.total=t.data.total)}),this.$http.post("/vehicle/list").then(function(t){t.code===e.$config.API_STATUS.OK&&t.data.list.forEach(function(t,a){e.vehicleIds[a]={value:t.vehicleId,name:t.licenseNum}})})},tableResponseFn:function(t,e,a){this[e.funcName].call(function(){},t,e,a)},edit:function(t){var e=this;this.$http.get("/annual/"+t.annualId).then(function(a){a.code===e.$config.API_STATUS.OK&&(t=a.data)}),this.drawerDisplay=!0,this.drawerData={staticData:t,isShow:!0,title:"编辑年检信息",titleWidth:"120",data:{},defaultData:"",submitAction:"/annual/update/"+t.annualId,btnAlign:"center",formList:[{title:"年检车辆",type:"select",key:"vehicleId",offsetWidth:"320",filterable:!0,options:{type:"default",list:this.vehicleIds},rules:[{required:!0,message:"请绑定车辆",trigger:"change"}]},{title:"本次年检时间",type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"annualAt",rules:[{required:!0,message:"请选择本次年检时间",trigger:"change"}]},{title:"年检到期时间",type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"timeoutAt",handlerCallback:{target:"changeFunction",funcName:"endTime"},rules:[{required:!0,message:"请选择年检到期时间",trigger:"change"}]},{title:"年检费用",type:"input",key:"price",offsetWidth:"320"},{title:"缴纳人",type:"input",offsetWidth:"320",key:"payer"},{title:"办理人",type:"input",offsetWidth:"320",key:"handler"},{title:"办理人电话",type:"input",offsetWidth:"320",key:"phone"},{title:"备注说明",type:"input",offsetWidth:"320",key:"remark"},{title:"附件图片",type:"imgUpload",offsetWidth:"320",action:this.$config.API_CONFIG.API_ROOT+"/file/upload/attachedPhoto",key:"attachedPhoto",accept:"image/jpeg,image/png",headers:{Authorization:this.$store.getters.userData.tokenHead+this.$store.getters.userData.token},showFileList:!1,beforeUpload:function(t){},onProgress:function(t){},onSuccess:function(t){t.code===e.$config.API_STATUS.OK&&e.$set(e.$refs.drawer.formData,"attachedPhoto",t.data.url)}}],formButton:[{name:"确定",type:"confirm",class:"primary"},{name:"取消",type:"cancel",class:""}],message:{type:"success",message:"编辑成功！"}}},detail:function(t){var e=this;this.$http.get("/annual/"+t.annualId).then(function(a){a.code===e.$config.API_STATUS.OK&&(t=a.data)}),this.drawerDisplay=!0,this.drawerData={staticData:t,isShow:!0,title:"年检详情",titleWidth:"120",btnAlign:"center",formList:[{title:"年检车辆",type:"textSelect",key:"vehicleId",offsetWidth:"320",list:this.vehicleIds},{title:"本次年检时间",type:"text",offsetWidth:"320",key:"annualAt"},{title:"年检到期时间",type:"text",offsetWidth:"320",key:"timeoutAt"},{title:"年检费用",type:"text",key:"price",offsetWidth:"320"},{title:"缴纳人",type:"text",offsetWidth:"320",key:"payer"},{title:"办理人",type:"text",offsetWidth:"320",key:"handler"},{title:"办理人电话",type:"text",offsetWidth:"320",key:"phone"},{title:"备注说明",type:"text",offsetWidth:"320",key:"remark"},{title:"附件图片",type:"imgUpload",offsetWidth:"320",action:this.$config.API_CONFIG.API_ROOT+"/file/upload/attachedPhoto",key:"attachedPhoto",disabled:!0,accept:"image/jpeg,image/png",headers:{Authorization:this.$store.getters.userData.tokenHead+this.$store.getters.userData.token},showFileList:!1,beforeUpload:function(t){},onProgress:function(t){},onSuccess:function(t){t.code===e.$config.API_STATUS.OK&&e.$set(e.$refs.drawer.formData,"attachedPhoto",t.data.url)}}]}},increase:function(){var t=this;this.drawerDisplay=!0,this.drawerData={isShow:!0,title:"添加年检信息",titleWidth:"120",data:{},defaultData:"",submitAction:"/annual/create",btnAlign:"center",formList:[{title:"年检车辆",type:"select",key:"vehicleId",offsetWidth:"320",filterable:!0,options:{type:"default",list:this.vehicleIds},rules:[{required:!0,message:"请绑定车辆",trigger:"change"}]},{title:"本次年检时间",type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"annualAt",rules:[{required:!0,message:"请选择本次年检时间",trigger:"change"}]},{title:"年检到期时间",type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"timeoutAt",handlerCallback:{target:"changeFunction",funcName:"endTime"},rules:[{required:!0,message:"请选择年检到期时间",trigger:"change"}]},{title:"年检费用",type:"input",key:"price",offsetWidth:"320"},{title:"缴纳人",type:"input",offsetWidth:"320",key:"payer"},{title:"办理人",type:"input",offsetWidth:"320",key:"handler"},{title:"办理人电话",type:"input",offsetWidth:"320",key:"phone"},{title:"备注说明",type:"input",offsetWidth:"320",key:"remark"},{title:"附件图片",type:"imgUpload",offsetWidth:"320",action:this.$config.API_CONFIG.API_ROOT+"/file/upload/attachedPhoto",key:"attachedPhoto",accept:"image/jpeg,image/png",headers:{Authorization:this.$store.getters.userData.tokenHead+this.$store.getters.userData.token},showFileList:!1,beforeUpload:function(t){},onProgress:function(t){},onSuccess:function(e){e.code===t.$config.API_STATUS.OK&&t.$set(t.$refs.drawer.formData,"attachedPhoto",e.data.url)}}],formButton:[{name:"确定",type:"confirm",class:"primary"},{name:"取消",type:"cancel",class:""}],message:{type:"success",message:"添加成功！"}}},export:function(){var t=this;this.$confirm("确认导出记录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1,beforeClose:function(e,a,i){t.fieldMap={},t.tableOptions.columns.forEach(function(e){t.$refs.table.columnCheckList.forEach(function(a){e.key===a&&"operate"!==e.key&&(t.fieldMap[a]=e.title)})});var n=t.$refs.table._data.searchParams,o=n.licenseNum,s=n.companyName;if("confirm"===e){var l={fieldMap:t.fieldMap,licenseNum:o,companyName:s};t.$http.download("/annual/export?isToken=true",l).then(function(t){}),i()}else i()}}).catch(function(){})},delete:function(t){var e=this;this.$confirm("是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a=[];t.forEach(function(t,e){a[e]=t.annualId}),e.$http.deleteApi("/annual/delete",{ids:a.join(",")}).then(function(t){t.code===e.$config.API_STATUS.OK&&(e.$refs.table.emitRequestTableData(),e.$message({message:t.message,type:"success"}))})}).catch(function(){e.$message({type:"info",message:"已取消"})})},diaClose:function(){this.$refs.table.emitRequestTableData(),this.drawerDisplay=!1},drawerCallback:function(t,e,a,i){this[t.handlerCallback.funcName].call(function(){},e,a,i)}}},o=(a("EdgN"),a("ZrdR")),s=Object(o.a)(n,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"main"},[a("table-view",{ref:"table",attrs:{stripe:"",center:"","id-key":"id","is-search":!0,data:t.tableOptions.data,total:t.tableOptions.total,columns:t.tableOptions.columns,"search-controls":t.tableOptions.searchControls,"footer-buttons":t.tableOptions.footerButtons,"button-controls":t.tableOptions.buttonControls,"pagination-layout":t.tableOptions.paginationLayout,loading:t.tableOptions.loading,"view-table-key":"record",checked:"","column-view":"",alias:t.alias},on:{requestTableData:t.getTableData,handleCallback:t.tableResponseFn}},[a("el-table-column",{attrs:{slot:"number",label:"序号",type:"index",align:"center"},slot:"number"})],1),t._v(" "),t.drawerDisplay?a("drawer",{ref:"drawer",attrs:{size:"small","drawer-data":t.drawerData},on:{diaClose:t.diaClose,handlerCallback:t.drawerCallback}}):t._e()],1)},[],!1,null,"445ea738",null);s.options.__file="record.vue";e.default=s.exports}}]);