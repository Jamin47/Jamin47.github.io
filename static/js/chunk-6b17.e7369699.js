(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6b17","Cy+k"],{"Cy+k":function(e,t,a){"use strict";a.r(t);var i=a("bS4n"),n=a.n(i),s=a("8t5x");t.default={data:function(){return{permissionList:{deviceList:"/device/list",deviceDetail:"/device/get/**",deviceCreate:"/device/create",deviceUpdate:"/device/update/**",deviceExport:"/device/export",deviceDelete:"/device/delete",vehicleFastCreate:"/vehicle/fastCreate",upgradeList:"/upgrade/list",upgradeListTask:"/upgrade/list/task",upgradeListRecord:"/upgrade/list/record",upgradeUpdate:"/upgrade/update/**",upgradeCreate:"/upgrade/create",upgradeDelete:"/upgrade/delete",upgradePush:"/upgrade/push",resetUpgradePush:"/upgrade/push/**",upgradeTaskPush:"/upgrade/task/push",upgradeTaskFailPush:"/upgrade/task/fail/push",deviceSettings:"/device/settings",deviceControlSetPassword:"/device/control/set/password",deviceControl:"/device/control",deviceControlDiskFormat:"/device/control/disk/format",deviceControlVehicle:"/device/control/vehicle",deviceTerminalText:"/device/terminal/text",deviceTerminalEvents:"/device/terminal/events",deviceTerminalQuestion:"/device/terminal/question",deviceTerminalNews:"/device/terminal/news",deviceTerminalCamera:"/device/terminal/camera",deviceTerminalSoundRecord:"/device/terminal/soundRecord",deviceTerminalVoiceMonitor:"/device/terminal/voiceMonitor",deviceOrderOffline:"/device/order/offline",deviceOrderOfflineExport:"/device/order/offline/export",deviceOrderDelete:"/device/order/delete",deviceOrderHistory:"/device/order/history",deviceOrderHistoryExport:"/device/order/history/export",simList:"/sim/list",simCreate:"/sim/create",simUpdate:"/sim/update/**",simDelete:"/sim/delete",simExport:"/sim/export"}}},computed:n()({},Object(s.b)(["permsData"]),{isAdministrator:function(){return[-1,-2].includes(Number(this.$store.getters.userData.userType))}}),watch:{permsData:{handler:function(){this.handlePermissionShow&&this.handlePermissionShow()},immediate:!0}},methods:{isPermissionShow:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!!this.isAdministrator||this.permsData.includes(this.permissionList[e])}}}},P4nX:function(e,t,a){"use strict";var i=a("kR3n");a.n(i).a},PxZR:function(e,t,a){"use strict";a.r(t);var i=a("unDg"),n=a.n(i),s=a("AlM9"),o=a("BHIJ"),r=a("Cy+k"),u={name:"InIssueHistoryComponents",components:{TableView:s.a,drawer:o.a},mixins:[r.default],data:function(){return{drawerDisplay:!1,drawerData:{},alias:{pageSize:"pageSize",pageNum:"pageNum"},tableOptions:{data:[],total:0,columns:[{type:"slot",name:"number",title:this.$t("upgradePage.index")},{title:this.$t("upgradePage.version_num"),key:"versionNum",type:"text"},{title:this.$t("upgradePage.package_type"),key:"packageType",type:"tagText",tags:[{value:0,text:this.$t("upgradePage.package_type_1"),option:{type:"warning"}},{value:1,text:this.$t("upgradePage.package_type_2"),option:{type:"primary"}}]},{title:this.$t("upgradePage.success_num"),key:"successNum",type:"text"},{title:this.$t("upgradePage.failed_num"),key:"failedNum",type:"text"},{title:this.$t("upgradePage.not_num"),key:"notNum",type:"text"},{title:this.$t("upgradePage.execution_status"),key:"status",type:"tagText",tags:[{value:0,text:this.$t("upgradePage.execution_status_1"),option:{type:"warning"}},{value:1,text:this.$t("upgradePage.execution_status_2"),option:{type:"success"}},{value:2,text:this.$t("upgradePage.execution_status_3"),option:{type:"primary"}},{value:3,text:this.$t("upgradePage.execution_status_4"),option:{type:"danger"}}]},{title:this.$t("upgradePage.upgrade_time"),key:"upgradeTime",type:"text"},{title:this.$t("upgradePage.username"),key:"username",type:"text"},{title:this.$t("operation.operation"),type:"operate",key:"operate",fixed:"right",buttons:[]}],buttonControls:[],searchControls:[{type:"input",key:"versionNum",placeholder:this.$t("upgradePage.version_num"),width:"160px"},{type:"select",key:"packageType",placeholder:this.$t("upgradePage.package_type"),width:"160px",clearable:!0,options:[{name:this.$t("upgradePage.package_type_1"),value:0},{name:this.$t("upgradePage.package_type_2"),value:1}]},{type:"select",key:"status",placeholder:this.$t("upgradePage.execution_status"),width:"160px",clearable:!0,options:[{name:this.$t("upgradePage.execution_status_1"),value:0},{name:this.$t("upgradePage.execution_status_2"),value:1},{name:this.$t("upgradePage.execution_status_3"),value:2},{name:this.$t("upgradePage.execution_status_4"),value:3}]},{type:"datetimerange",key:"time",startPlaceholder:this.$t("view.start_time"),endPlaceholder:this.$t("view.end_time"),width:"360px"}],footerButtons:[],paginationLayout:"total, sizes, prev, pager, next, jumper",loading:!1},infoDrawer:!1,activeData:null,infoTableOptions:{data:[],total:0,columns:[{type:"slot",name:"number",title:"序号"},{title:this.$t("view.license_num"),key:"licenseNum",type:"text"},{title:this.$t("upgradePage.issued_status"),key:"issuedStatus",type:"tagText",tags:[{value:0,text:this.$t("upgradePage.issued_status_1"),option:{type:"warning"}},{value:1,text:this.$t("upgradePage.issued_status_2"),option:{type:"success"}},{value:2,text:this.$t("upgradePage.issued_status_3"),option:{type:"primary"}}]},{title:this.$t("upgradePage.original_version"),key:"originalVersion",type:"text"},{title:this.$t("upgradePage.version_num"),key:"versionNum",type:"text"},{title:this.$t("upgradePage.execution_status"),key:"upgradeStatus",type:"tagText",tags:[{value:0,text:this.$t("upgradePage.execution_status_1"),option:{type:"warning"}},{value:1,text:this.$t("upgradePage.execution_status_2"),option:{type:"success"}},{value:2,text:this.$t("upgradePage.execution_status_3"),option:{type:"primary"}},{value:3,text:this.$t("upgradePage.execution_status_4"),option:{type:"danger"}}]},{title:this.$t("view.start_time"),key:"startTime",type:"text",width:"160"},{title:this.$t("view.end_time"),key:"endTime",type:"text",width:"160"},{title:this.$t("upgradePage.create_time"),key:"createTime",type:"text"},{title:this.$t("operation.operation"),type:"operate",key:"operate",fixed:"right",width:"120",buttons:[]}],buttonControls:[],searchControls:[{type:"treeSelect",key:"licenseNum",valueKey:"licenseNum",placeholder:this.$t("upgradePage.tree_placeholder"),width:"200px",clearable:!0,treeOption:{defaultProps:{children:"children",label:"treeName"},nodeKey:"treeId",defaultExpandAll:!1,expandClickNode:!1,checkbox:!0,screenFn:{bindFn:function(e,t){return!e||-1!==t.treeName.indexOf(e)}}},treeDefinedData:[]},{type:"input",key:"versionNum",placeholder:this.$t("upgradePage.version_num"),width:"160px"},{type:"select",key:"upgradeStatus",placeholder:this.$t("upgradePage.execution_status"),width:"160px",clearable:!0,options:[{name:this.$t("upgradePage.execution_status_1"),value:0},{name:this.$t("upgradePage.execution_status_2"),value:1},{name:this.$t("upgradePage.execution_status_3"),value:2},{name:this.$t("upgradePage.execution_status_4"),value:3}]}],footerButtons:[],paginationLayout:"total, sizes, prev, pager, next, jumper",loading:!1}}},computed:{},created:function(){this.getDevAllTreeDataFn()},mounted:function(){},methods:{handlePermissionShow:function(){var e=this.tableOptions.columns.findIndex(function(e){return"operate"===e.key});this.tableOptions.columns[e].buttons=[],e>-1&&this.isPermissionShow("upgradeListRecord")&&this.tableOptions.columns[e].buttons.push({tipText:this.$t("operation.detail"),icon:"iconfont Jamin_vehicle_ico_xq",type:"text",funcName:"detailFn"});var t=this.infoTableOptions.columns.findIndex(function(e){return"operate"===e.key});t>-1&&this.isPermissionShow("resetUpgradePush")&&this.infoTableOptions.columns[t].buttons.push({tipText:this.$t("upgradePage.again"),icon:"iconfont Jamin_device_icon_cxts",type:"text",funcName:"againFn"}),this.tableOptions.footerButtons=[],this.isPermissionShow("upgradeTaskPush")&&this.tableOptions.footerButtons.push({text:this.$t("upgradePage.execute"),type:"",round:!1,funcName:"executeFn"}),this.isPermissionShow("upgradeTaskFailPush")&&this.tableOptions.footerButtons.push({text:this.$t("upgradePage.fail_again"),type:"danger",round:!1,funcName:"againsFn"})},getTableData:function(e){var t=this;e.startTime=e.time&&e.time[0]?e.time[0]:"",e.endTime=e.time&&e.time[1]?e.time[1]:"",delete e.time,this.tableOptions.loading=!0,this.$http.post("/upgrade/list/task",e).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.tableOptions.loading=!1,t.tableOptions.data=e.data.list,t.tableOptions.total=e.data.total)})},getInfoTableData:function(e){var t=this;this.infoTableOptions.loading=!0,e.taskId=this.activeData.taskId,this.$http.post("/upgrade/list/record",e).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.infoTableOptions.loading=!1,t.infoTableOptions.data=e.data.list,t.infoTableOptions.total=e.data.total)})},tableResponseFn:function(e,t,a){this[t.funcName].call(function(){},e,t,a)},getDevAllTreeDataFn:function(){var e=this;this.$http.get("/postion/otaUpgrade/vehicleAllTreeList").then(function(t){t.code===e.$config.API_STATUS.OK&&(e.forTreeResetDataFn(t.data.motorcades),e.infoTableOptions.searchControls[0].treeDefinedData=t.data.motorcades,e.isTable=!1,e.$nextTick(function(){e.isTable=!0}))})},forTreeResetDataFn:function(e){var t=this;e.forEach(function(e){e.vehicleId?(e.treeName=e.licenseNum,e.treeId="v_"+e.vehicleId,e.lezy=!0):(e.treeName=e.motorcadeName,e.treeId="m_"+e.motorcadeId,e.children=[].concat(n()(e.vehicles),n()(e.motorcades)),t.forTreeResetDataFn(e.children))})},detailFn:function(e){this.activeData=e,this.infoDrawer=!0},executeFn:function(e){var t=this,a=e.filter(function(e){return 0===e.status});a.length?this.$confirm(this.$t("confirm.content"),this.$t("confirm.title"),{confirmButtonText:this.$t("confirm.determine"),cancelButtonText:this.$t("confirm.cancel")}).then(function(){t.$http.deleteApi("/upgrade/task/push",{taskIds:a.map(function(e){return e.taskId}).join(",")}).then(function(e){e.code===t.$config.API_STATUS.OK&&t.$message.success(t.$t("confirm.message"))})}):this.$message.warning(this.$t("upgradePage.error_message_1"))},againFn:function(e){var t=this;this.$confirm(this.$t("confirm.content"),this.$t("confirm.title"),{confirmButtonText:this.$t("confirm.determine"),cancelButtonText:this.$t("confirm.cancel")}).then(function(){t.$http.deleteApi("/upgrade/push/"+e.recordId).then(function(e){e.code===t.$config.API_STATUS.OK&&t.$message.success(t.$t("confirm.message"))})})},againsFn:function(e){var t=this,a=e.filter(function(e){return 3===e.status});a.length?this.$confirm(this.$t("confirm.content"),this.$t("confirm.title"),{confirmButtonText:this.$t("confirm.determine"),cancelButtonText:this.$t("confirm.cancel")}).then(function(){t.$http.deleteApi("/upgrade/task/fail/push",{taskIds:a.map(function(e){return e.taskId}).join(",")}).then(function(e){e.code===t.$config.API_STATUS.OK&&t.$message.success(t.$t("confirm.message"))})}):this.$message.warning(this.$t("upgradePage.error_message_2"))},diaClose:function(e){e&&this.$refs.table.initRequestTableData(),this.drawerDisplay=!1},drawerCallback:function(e,t,a,i){this[e.handlerCallback.funcName].call(function(){},t,a,i)}}},l=(a("P4nX"),a("ZrdR")),d=Object(l.a)(u,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"inIssue-history-components"},[a("table-view",{ref:"table",attrs:{center:"","id-key":"taskId","is-search":!0,"check-memory":!0,data:e.tableOptions.data,total:e.tableOptions.total,columns:e.tableOptions.columns,"search-controls":e.tableOptions.searchControls,"footer-buttons":e.tableOptions.footerButtons,"button-controls":e.tableOptions.buttonControls,"pagination-layout":e.tableOptions.paginationLayout,loading:e.tableOptions.loading,"is-shadow":"",checked:"",alias:e.alias},on:{requestTableData:e.getTableData,handleCallback:e.tableResponseFn}},[a("el-table-column",{attrs:{slot:"number",label:e.$t("view.index"),type:"index",align:"center",width:"60"},slot:"number"})],1),e._v(" "),e.drawerDisplay?a("drawer",{ref:"drawer",attrs:{"drawer-data":e.drawerData},on:{diaClose:e.diaClose,handlerCallback:e.drawerCallback}}):e._e(),e._v(" "),a("el-drawer",{attrs:{title:e.$t("operation.detail"),visible:e.infoDrawer,"wrapper-closable":!1,size:"80%",direction:"rtl"},on:{"update:visible":function(t){e.infoDrawer=t}}},[e.infoDrawer?a("div",{staticClass:"drawer-body"},[a("table-view",{ref:"info_table",attrs:{center:"","id-key":"taskId","is-search":!0,data:e.infoTableOptions.data,total:e.infoTableOptions.total,columns:e.infoTableOptions.columns,"search-controls":e.infoTableOptions.searchControls,"footer-buttons":e.infoTableOptions.footerButtons,"button-controls":e.infoTableOptions.buttonControls,"pagination-layout":e.infoTableOptions.paginationLayout,loading:e.infoTableOptions.loading,"is-border":"",alias:e.alias},on:{requestTableData:e.getInfoTableData,handleCallback:e.tableResponseFn}},[a("el-table-column",{attrs:{slot:"number",label:e.$t("view.index"),type:"index",align:"center",width:"60"},slot:"number"})],1)],1):e._e()])],1)},[],!1,null,"4e6282d0",null);d.options.__file="upgradeTask.vue";t.default=d.exports},kR3n:function(e,t,a){}}]);