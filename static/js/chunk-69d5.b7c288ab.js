(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-69d5"],{"0rXq":function(t,e,i){"use strict";i.r(e);var s=i("9abo"),a=i("ZLLL"),r=i("XVnh"),n=i("YelX"),o={name:"CertificatesAdminister",components:{drivingLicense:s.default,transportCertificate:a.default,notPerm:r.a},mixins:[n.default],data:function(){return{isShow:!0,activeName:"drivingLicense",licenseColor:[],companyTreeData:[],isPermission:!1}},created:function(){this.getCodeDataFn()},mounted:function(){},methods:{handlePermissionShow:function(){var t=this.isPermissionShow("drivingLicenseList"),e=this.isPermissionShow("transportList");t?(this.activeName="drivingLicense",this.isPermission=!0):e&&(this.activeName="transportCertificate",this.isPermission=!0)},getCodeDataFn:function(){var t=this;this.$http.get("/dict/list/codes",{dicCodes:"licenseColor"}).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.licenseColor=e.data.licenseColor.map(function(t){return{value:t.itemName,text:t.itemValue,name:t.itemValue,lable:t.itemValue}}),t.isShow=!1,t.$nextTick(function(){t.isShow=!0}))})}}},c=(i("ulTW"),i("ZrdR")),l=Object(c.a)(o,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"page-wrap"},[t.isPermission?i("div",{staticClass:"main"},[t.isShow?i("el-tabs",{staticClass:"init-tabs",model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[t.isPermissionShow("drivingLicenseList")?i("el-tab-pane",{attrs:{name:"drivingLicense"}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("i",{staticClass:"iconfont Jamin_vehicle_icon_jszgl"}),t._v(" "+t._s(t.$t("certificatesAdminister.license_management")))]),t._v(" "),"drivingLicense"===t.activeName?i("drivingLicense"):t._e()],1):t._e(),t._v(" "),t.isPermissionShow("transportList")?i("el-tab-pane",{attrs:{name:"transportCertificate"}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("i",{staticClass:"iconfont Jamin_vehicle_icon_yszgl"}),t._v(" "+t._s(t.$t("certificatesAdminister.transportation_license_management")))]),t._v(" "),"transportCertificate"===t.activeName?i("transportCertificate"):t._e()],1):t._e()],1):t._e()],1):t._e(),t._v(" "),t.isPermission||t.$store.state.app.permsDataLoading?t._e():i("notPerm")],1)},[],!1,null,"5a4b08c4",null);l.options.__file="certificatesAdminister.vue";e.default=l.exports},"45H3":function(t,e,i){},HldY:function(t,e,i){"use strict";var s=i("45H3");i.n(s).a},Xve4:function(t,e,i){},ZLLL:function(t,e,i){"use strict";i.r(e);var s=i("unDg"),a=i.n(s),r=i("AlM9"),n=i("BHIJ"),o=i("YelX"),c={components:{TableView:r.a,drawer:n.a},mixins:[o.default],data:function(){return{title:"",fieldMap:{},vehicleTree:[],drawerDisplay:!1,drawerData:{},alias:{pageSize:"pageSize",pageNum:"pageNum"},tableOptions:{data:[],total:0,columns:[{type:"slot",name:"number",title:this.$t("certificatesAdminister.serial_number")},{title:this.$t("certificatesAdminister.license_plate_number"),key:"licenseNum",type:"text"},{title:this.$t("certificatesAdminister.license_plate_color"),key:"licenseColor",type:"tag",tags:[{value:1,text:this.$t("certificatesAdminister.blue")},{value:2,text:this.$t("certificatesAdminister.yellow")},{value:3,text:this.$t("certificatesAdminister.black")},{value:4,text:this.$t("certificatesAdminister.white")},{value:9,text:this.$t("certificatesAdminister.other")}]},{title:this.$t("certificatesAdminister.transport_certificate_no"),key:"transportNum",type:"text"},{title:this.$t("certificatesAdminister.business_scope"),key:"busScope",type:"text"},{title:this.$t("certificatesAdminister.effective_date"),key:"effectAt",type:"text"},{title:this.$t("certificatesAdminister.expiration_date"),key:"timeoutAt",type:"text"},{title:this.$t("certificatesAdminister.days_advance_reminder"),key:"advanceNum",type:"text"},{title:this.$t("operateCommon.operation"),type:"operate",key:"operate",fixed:"right",width:"140",buttons:[]}],buttonControls:[],searchControls:[{type:"input",key:"licenseNum",placeholder:this.$t("certificatesAdminister.license_plate_number"),width:"200px"},{type:"input",key:"transportNum",placeholder:this.$t("certificatesAdminister.transport_certificate_no"),width:"200px"}],footerButtons:[],paginationLayout:"total, sizes, prev, pager, next, jumper",loading:!1},params:null}},computed:{},created:function(){},mounted:function(){},methods:{handlePermissionShow:function(){this.tableOptions.buttonControls=[],this.isPermissionShow("transportCreate")&&this.tableOptions.buttonControls.push({text:this.$t("certificatesAdminister.add_transport_certificate"),type:"primary",icon:"el-icon-plus",funcName:"increase"}),this.isPermissionShow("transportExport")&&this.tableOptions.buttonControls.push({text:this.$t("certificatesAdminister.export_record"),type:"null",icon:"el-icon-download",funcName:"export",dataStatus:!0}),this.tableOptions.footerButtons=[],this.isPermissionShow("transportDelete")&&this.tableOptions.footerButtons.push({text:this.$t("operateCommon.delete"),type:"danger",icon:"el-icon-delete",funcName:"delete"});var t=this.tableOptions.columns.findIndex(function(t){return"operate"===t.key});this.tableOptions.columns[t].buttons=[],t>-1&&this.isPermissionShow("transportList")&&this.tableOptions.columns[t].buttons.push({tipText:this.$t("operateCommon.detailed"),icon:"iconfont Jamin_vehicle_ico_xq",type:"text",funcName:"detail"}),t>-1&&this.isPermissionShow("transportUpdate")&&this.tableOptions.columns[t].buttons.push({tipText:this.$t("operateCommon.edit"),icon:"iconfont Jamin_vehicle_icon_bj",type:"text",funcName:"edit"})},getTableData:function(t){var e=this;this.tableOptions.loading=!0;var i={licenseNum:t.licenseNum,transportNum:t.transportNum};this.$http.post("/transport/list?pageNum="+t.pageNum+"&pageSize="+t.pageSize,i).then(function(t){t.code===e.$config.API_STATUS.OK?(e.tableOptions.data=t.data.list,e.tableOptions.total=t.data.total):(e.tableOptions.data=[],e.tableOptions.total=0),e.tableOptions.loading=!1}).catch(function(){e.tableOptions.data=[],e.tableOptions.total=0,e.tableOptions.loading=!1}),this.params=t},getVehicleTreeData:function(t){var e=this,i=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.$http.get("/postion/transport/vehicleAllTreeList").then(function(s){i.close(),s.code===e.$config.API_STATUS.OK&&(e.vehicleTree=s.data.motorcades,e.forResetDevTreeFn(e.vehicleTree),t(!0))})},forResetDevTreeFn:function(t){var e=this;t.forEach(function(t){t.children=[].concat(a()(t.vehicles?t.vehicles:[]),a()(t.motorcades?t.motorcades:[])),t.children.length&&e.forResetDevTreeFn(t.children),t.vehicleId?(t.treeId="v_"+t.vehicleId,t.treeName=t.licenseNum):(t.treeId="m_"+t.motorcadeId,t.treeName=t.motorcadeName)})},newVehicle:function(){var t=this;this.getVehicleTreeData(function(e){t.drawerDisplay=!0,t.increaseData()})},oldVehicle:function(t){var e=this;this.title===this.$t("operateCommon.edit")?this.getVehicleTreeData(function(i){e.drawerDisplay=!0,e.editData(t)}):(this.drawerDisplay=!0,this.detailData(t))},tableResponseFn:function(t,e,i){this[e.funcName].call(function(){},t,e,i)},increase:function(){this.newVehicle()},increaseData:function(){var t=this,e=function(e,i,s){t.$refs.drawer.formData.effectAt&&t.$refs.drawer.formData.timeoutAt?new Date(t.$refs.drawer.formData.effectAt).getTime()>new Date(t.$refs.drawer.formData.timeoutAt).getTime()?s(new Error(t.$t("certificatesAdminister.expiration_time_text_tip"))):s():s()};this.drawerData={isShow:!0,title:this.$t("certificatesAdminister.add_transport_certificate"),titleWidth:"120",data:{},defaultData:"",submitAction:"/transport/create",btnAlign:"center",formList:[{title:this.$t("certificatesAdminister.bind_vehicle"),type:"treeSelect",key:"vehicleId",valueKey:"vehicleId",offsetWidth:"320",treeOption:{defaultProps:{children:"children",label:"treeName"},nodeKey:"treeId",nodeCode:"iconfont Jamin_vehicle_icon_clgl1",defaultExpandAll:!1,expandClickNode:!1,screenFn:{bindFn:function(t,e){return!t||-1!==e.treeName.indexOf(t)}}},treeDefinedData:this.vehicleTree,rules:[{required:!0,message:this.$t("certificatesAdminister.please_bind__vehicle"),trigger:"blur"}]},{title:this.$t("certificatesAdminister.transport_certificate_no"),type:"input",key:"transportNum",offsetWidth:"320",rules:[{required:!0,message:this.$t("certificatesAdminister.enter_transport_certificate_no"),trigger:"blur"}]},{title:this.$t("certificatesAdminister.business_scope"),type:"input",key:"busScope",offsetWidth:"320",rules:[{required:!0,message:this.$t("certificatesAdminister.enter_usage_nature"),trigger:"blur"}]},{title:this.$t("certificatesAdminister.effective_time"),type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"effectAt",rules:[{required:!0,message:this.$t("certificatesAdminister.select_effective_time"),trigger:"change"},{validator:e,trigger:"change"}]},{title:this.$t("certificatesAdminister.expiration_time"),type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"timeoutAt",rules:[{required:!0,message:this.$t("certificatesAdminister.select_expiration_time"),trigger:"change"},{validator:e,trigger:"change"}]},{title:this.$t("certificatesAdminister.days_advance_reminder"),type:"input",key:"advanceNum",offsetWidth:"320",rules:[{required:!0,message:this.$t("certificatesAdminister.enter_days_advance"),trigger:"blur"}]},{title:this.$t("certificatesAdminister.remarks_description"),type:"input",offsetWidth:"320",key:"remark"}],formButton:[{name:this.$t("confirm.determine"),type:"confirm",class:"primary"},{name:this.$t("confirm.cancel"),type:"cancel",class:""}],message:{type:"success",message:this.$t("certificatesAdminister.added_successfully")}}},export:function(t){var e=this;this.$confirm(this.$t("operateCommon.confirm_export_record"),this.$t("operateCommon.prompt"),{confirmButtonText:this.$t("operateCommon.ok"),cancelButtonText:this.$t("operateCommon.cancel"),type:"warning",closeOnClickModal:!1,beforeClose:function(t,i,s){e.fieldMap={},e.tableOptions.columns.forEach(function(t){e.$refs.table.columnCheckList.forEach(function(i){t.key===i&&"operate"!==t.key&&(e.fieldMap[i]=t.title)})});var a=e.$refs.table._data.searchParams,r=a.licenseNum,n=a.transportNum;if("confirm"===t){var o={fieldMap:e.fieldMap,licenseNum:r,transportNum:n};e.$http.download("/transport/export?isToken=true",o),s()}else s()}}).catch(function(){})},delete:function(t){var e=this;this.$confirm(this.$t("certificatesAdminister.is_delete"),this.$t("operateCommon.prompt"),{confirmButtonText:this.$t("operateCommon.ok"),cancelButtonText:this.$t("operateCommon.cancel"),type:"warning"}).then(function(){var i=[];t.forEach(function(t,e){i[e]=t.id}),e.$http.deleteApi("/transport/delete",{ids:i.join(",")}).then(function(t){t.code===e.$config.API_STATUS.OK&&(e.$refs.table.initRequestTableData(),e.$message({message:t.message,type:"success"}))})})},edit:function(t){this.title=this.$t("operateCommon.edit"),this.oldVehicle(t)},editData:function(t){var e=this,i=function(t,i,s){e.$refs.drawer.formData.effectAt&&e.$refs.drawer.formData.timeoutAt?new Date(e.$refs.drawer.formData.effectAt).getTime()>new Date(e.$refs.drawer.formData.timeoutAt).getTime()?s(new Error(e.$t("certificatesAdminister.expiration_time_text_tip"))):s():s()};this.drawerData={staticData:t,isShow:!0,title:this.$t("certificatesAdminister.edit_transportation_certificate"),titleWidth:"120",data:{},defaultData:"",submitAction:"/transport/update/"+t.id,btnAlign:"center",formList:[{title:this.$t("certificatesAdminister.bind_vehicle"),type:"treeSelect",key:"vehicleId",valueKey:"vehicleId",offsetWidth:"320",label:t.licenseNum,treeOption:{defaultProps:{children:"children",label:"treeName"},nodeKey:"treeId",nodeCode:"iconfont Jamin_vehicle_icon_clgl1",defaultExpandAll:!1,expandClickNode:!1,screenFn:{bindFn:function(t,e){return!t||-1!==e.treeName.indexOf(t)}}},treeDefinedData:this.vehicleTree,rules:[{required:!0,message:this.$t("certificatesAdminister.please_bind__vehicle"),trigger:"blur"}]},{title:this.$t("certificatesAdminister.transport_certificate_no"),type:"input",key:"transportNum",offsetWidth:"320",rules:[{required:!0,message:this.$t("certificatesAdminister.enter_transport_certificate_no"),trigger:"blur"}]},{title:this.$t("certificatesAdminister.business_scope"),type:"input",key:"busScope",offsetWidth:"320",rules:[{required:!0,message:this.$t("certificatesAdminister.enter_usage_nature"),trigger:"blur"}]},{title:this.$t("certificatesAdminister.effective_time"),type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"effectAt",rules:[{required:!0,message:this.$t("certificatesAdminister.select_effective_time"),trigger:"change"},{validator:i,trigger:"change"}]},{title:this.$t("certificatesAdminister.expiration_time"),type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"timeoutAt",rules:[{required:!0,message:this.$t("certificatesAdminister.select_expiration_time"),trigger:"change"},{validator:i,trigger:"change"}]},{title:this.$t("certificatesAdminister.days_advance_reminder"),type:"input",key:"advanceNum",offsetWidth:"320",rules:[{required:!0,message:this.$t("certificatesAdminister.enter_days_advance"),trigger:"blur"}]},{title:this.$t("certificatesAdminister.remarks_description"),type:"input",offsetWidth:"320",key:"remark"}],formButton:[{name:this.$t("confirm.determine"),type:"confirm",class:"primary"},{name:this.$t("confirm.cancel"),type:"cancel",class:""}],message:{type:"success",message:this.$t("confirm.editSuccess")}}},detail:function(t){this.title=this.$t("operateCommon.detailed"),this.oldVehicle(t)},detailData:function(t){this.drawerData={staticData:t,isShow:!0,title:this.$t("certificatesAdminister.transport_certificate_details"),titleWidth:"120",data:{},defaultData:"",submitAction:"/transport/update/"+t.id,btnAlign:"center",formList:[{title:this.$t("certificatesAdminister.bind_vehicle"),type:"textSelect",key:"vehicleId",offsetWidth:"320",list:this.vehicleIds},{title:this.$t("certificatesAdminister.transport_certificate_no"),type:"text",key:"transportNum",offsetWidth:"320"},{title:this.$t("certificatesAdminister.business_scope"),type:"text",key:"busScope",offsetWidth:"320"},{title:this.$t("certificatesAdminister.effective_time"),type:"text",offsetWidth:"320",key:"effectAt"},{title:this.$t("certificatesAdminister.expiration_time"),type:"text",offsetWidth:"320",key:"timeoutAt"},{title:this.$t("certificatesAdminister.days_advance_reminder"),type:"text",key:"advanceNum",offsetWidth:"320"},{title:this.$t("certificatesAdminister.remarks_description"),type:"text",offsetWidth:"320",key:"remark"}]}},diaClose:function(t){t&&this.$refs.table.initRequestTableData(),this.drawerDisplay=!1},endTime:function(t){this.$refs.drawer.formData.effectAt?new Date(t).getTime()<=new Date(this.$refs.drawer.formData.effectAt).getTime()&&(this.$message.error(this.$t("certificatesAdminister.end_time_text_tip")),this.$refs.drawer.formData.timeoutAt=null):(this.$message.error(this.$t("certificatesAdminister.select_start_time")),this.$refs.drawer.formData.timeoutAt=null)},drawerCallback:function(t,e,i,s){this[t.handlerCallback.funcName].call(function(){},e,i,s)}}},l=(i("HldY"),i("ZrdR")),d=Object(l.a)(c,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"transportCertificate"},[i("table-view",{ref:"table",attrs:{center:"","id-key":"id","is-search":!0,"check-memory":!0,data:t.tableOptions.data,total:t.tableOptions.total,columns:t.tableOptions.columns,"search-controls":t.tableOptions.searchControls,"footer-buttons":t.tableOptions.footerButtons,"button-controls":t.tableOptions.buttonControls,"pagination-layout":t.tableOptions.paginationLayout,loading:t.tableOptions.loading,"view-table-key":"transportCertificate",checked:"","column-view":"","is-shadow":"",alias:t.alias},on:{requestTableData:t.getTableData,handleCallback:t.tableResponseFn}},[i("el-table-column",{attrs:{slot:"number",label:t.$t("view.index"),type:"index",align:"center"},slot:"number"})],1),t._v(" "),t.drawerDisplay?i("drawer",{ref:"drawer",attrs:{"drawer-data":t.drawerData},on:{diaClose:t.diaClose,handlerCallback:t.drawerCallback}}):t._e()],1)},[],!1,null,"43d837a2",null);d.options.__file="transportCertificate.vue";e.default=d.exports},jcYt:function(t,e,i){t.exports=i.p+"static/img/not-perm.d97c442.png"},ulTW:function(t,e,i){"use strict";var s=i("Xve4");i.n(s).a}}]);