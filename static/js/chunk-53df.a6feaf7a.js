(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-53df","Cili"],{Cili:function(t,e,a){"use strict";a.r(e);var i=a("bS4n"),s=a.n(i),l=a("8t5x");e.default={data:function(){return{permissionList:{alarmPreviewTodayRisk:"/alarm/preview/today/risk",alarmPreviewYesterdayScore:"/alarm/preview/yesterday/score",alarmPreviewTodayType:"/alarm/preview/today/type",alarmPreviewTodayLocation:"/alarm/preview/today/location",alarmPreviewTodayAnalyze:"/alarm/preview/today/analyze",alarmPreviewTodayHandle:"/alarm/preview/today/handle",alarmPreviewTodayVehicle:"/alarm/preview/today/vehicle",alarmRealtimeList:"/alarm/realtime/list",alarmRealtimeExport:"/alarm/realtime/export",alarmRealtimeAgg:"alarm/realtime/agg",alarmSummaryTypeList:"/alarm/summary/type/list/**",alarmRealtimeListCommonDetail:"alarm/realtime/list/common/detail",alarmPopUpSettingCreateOrUpdate:"/alarmPopUp/setting/createOrUpdate",alarmRealtimeSolveAlarm:"/alarm/realtime/solveAlarm",alarmSettingList:"/alarm/setting/list",alarmSettingUpdate:"/alarm/setting/update/**",alarmSettingDelete:"/alarm/setting/delete",alarmSettingCreate:"/alarm/setting/create",alarmStatisticsListVehicle:"/alarm/statistics/list/vehicle",alarmStatisticsExportVehicle:"/alarm/statistics/export/vehicle",alarmStatisticsListCompany:"/alarm/statistics/list/company",alarmStatisticsExportCompany:"/alarm/statistics/export/company"}}},computed:s()({},Object(l.b)(["permsData"]),{isAdministrator:function(){return[-1,-2].includes(Number(this.$store.getters.userData.userType))}}),watch:{permsData:{handler:function(){this.handlePermissionShow&&this.handlePermissionShow()},immediate:!0}},methods:{isPermissionShow:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!!this.isAdministrator||this.permsData.includes(this.permissionList[t])}}}},VFUA:function(t,e,a){t.exports=a.p+"static/img/Safety_pi_ycl@2x.3d50918.png"},WepR:function(t,e,a){"use strict";var i=a("uFof");a.n(i).a},jcYt:function(t,e,a){t.exports=a.p+"static/img/not-perm.d97c442.png"},uFof:function(t,e,a){},ujRJ:function(t,e,a){"use strict";a.r(e);var i=a("unDg"),s=a.n(i),l=a("AlM9"),o=a("Kx3r"),r=a("MfIo"),n=a("Cili"),c=a("XVnh"),m={name:"SecurityAlarm",components:{TableView:l.a,notPerm:c.a},mixins:[n.default],data:function(){return{fieldMap:{},drawerObj:{isShow:!1,width:"700px"},viewType:"list",isTable:!0,tableOptions:{data:[],total:0,columns:[{type:"slot",name:"number",title:this.$t("securityCommon.serial_number")},{title:this.$t("securityCommon.license_plate"),key:"licenseNum",type:"text",width:"160"},{title:this.$t("securityCommon.fleet_company"),key:"motorcadeName",type:"text",minWidth:"160"},{title:this.$t("securityCommon.alarm_type"),key:"alarmType",type:"tagText",minWidth:"160",tags:[]},{title:this.$t("securityAlarm.processing_status"),key:"solveStatus",type:"tagText",minWidth:"140",tags:[{text:this.$t("securityCommon.untreated"),value:null,option:{type:"danger"}},{text:this.$t("securityCommon.untreated"),value:0,option:{type:"danger"}},{text:this.$t("securityCommon.processed"),value:1}]},{title:this.$t("securityCommon.start_time"),key:"startTime",type:"text",minWidth:"180"},{title:this.$t("securityCommon.end_time"),key:"endTime",type:"text",minWidth:"180"},{title:this.$t("securityCommon.geographic_location"),key:"location",type:"text",minWidth:"280"},{title:this.$t("securityCommon.number_attachments"),key:"fileNum",type:"text"},{title:this.$t("securityCommon.operation"),type:"operate",key:"operate",fixed:"right",width:"120",buttons:[]}],buttonControls:[],searchControls:[{type:"treeSelect",key:"vehicleId",valueKey:"vehicleId",placeholder:this.$t("securityCommon.select_vehicle"),width:"200px",clearable:!0,treeOption:{defaultProps:{children:"children",label:"treeName"},nodeKey:"treeId",nodeCode:"iconfont Jamin_vehicle_icon_clgl1",defaultExpandAll:!1,expandClickNode:!1,checkbox:!0,screenFn:{bindFn:function(t,e){return!t||-1!==e.treeName.indexOf(t)}}},treeDefinedData:[]},{type:"datetimerange",key:"time",startPlaceholder:this.$t("securityCommon.select_start_date"),endPlaceholder:this.$t("securityCommon.select_end_date"),width:"360px"},{type:"treeSelect",key:"alarmType",valueKey:"typeCode",placeholder:this.$t("securityCommon.alarm_type"),width:"200px",clearable:!0,treeOption:{defaultProps:{children:"children",label:"typeName"},nodeKey:"typeCode",defaultExpandAll:!1,expandClickNode:!1,checkbox:!0,screenFn:{bindFn:function(t,e){return!t||-1!==e.typeName.indexOf(t)}}},treeDefinedData:[]},{type:"select",key:"solveStatus",placeholder:this.$t("securityAlarm.processing_status"),width:"200px",clearable:!0,downShow:!0,options:[{name:this.$t("securityCommon.untreated"),value:0},{name:this.$t("securityCommon.processed"),value:1}]}],searchMode:"immediate",footerButtons:[],paginationLayout:"total, sizes, prev, pager, next, jumper",loading:!1},elNorms:this.$store.getters.elNorms,formData:null,activeCarousel:null,carouselList:[],getCarouselInfo:{getOWidth:null,getIWidth:null,maginL:0},alarmSelect:[],params:null,tableAllData:[]}},computed:{},created:function(){this.getSelectDataFn()},mounted:function(){},methods:{handlePermissionShow:function(){var t=this.tableOptions.columns.findIndex(function(t){return"operate"===t.key});this.tableOptions.columns[t].buttons=[],t>-1&&this.isPermissionShow("alarmRealtimeList")&&this.tableOptions.columns[t].buttons.push({tipText:this.$t("securityAlarm.detail"),icon:"iconfont Jamin_vehicle_ico_xq",type:"text",funcName:"detailFn"}),t>-1&&this.isPermissionShow("alarmRealtimeExport")&&this.tableOptions.columns[t].buttons.push({tipText:this.$t("securityAlarm.export"),icon:"iconfont Jamin_location_icon_xiazai",type:"text",funcName:"downloadFn"}),this.tableOptions.buttonControls=[],this.isPermissionShow("alarmRealtimeExport")&&this.tableOptions.buttonControls.push({text:this.$t("securityCommon.export_record"),type:"null",size:"small",round:!1,icon:"el-icon-download",funcName:"exportRecord"})},getTableData:function(t){var e=this;if(!this.tableOptions.searchControls[0].treeDefinedData.length||!t.vehicleId)return!1;this.tableOptions.loading=!0,!this.params||this.params.page===t.page&&this.params.limit===t.limit?(t.time&&(t.startTime=t.time[0],t.endTime=t.time[1]),delete t.time,t.vehicleId=JSON.parse(t.vehicleId),t.alarmType?t.alarmType=JSON.parse(t.alarmType):t.alarmType=null,this.$http.post("/alarm/realtime/list",t).then(function(a){if(e.tableOptions.loading=!1,a.code===e.$config.API_STATUS.OK&&a.data){var i=Object(o.a)(a.data);i.forEach(function(t){t.startTime&&(t.startTime=Object(r.d)(new Date(t.startTime),"yyyy-MM-dd hh:mm:ss"))}),e.tableAllData=i,e.initTableDataFn(t),e.tableOptions.total=i.length}}).catch(function(){e.tableOptions.loading=!1})):(this.initTableDataFn(t),this.tableOptions.loading=!1),this.params=t},initTableDataFn:function(t){var e=(t.page-1)*t.limit,a=t.page*t.limit>this.tableAllData.length?this.tableAllData.length:t.page*t.limit;this.tableOptions.data=this.tableAllData.slice(e,a)},getSelectDataFn:function(){var t=this;this.$http.axios.all([this.$http.get("/alarm/realtime/vehicleAllTreeList"),this.$http.get("/alarm/setting/type/list",{alarmType:1})]).then(this.$http.axios.spread(function(e,a){e.code===t.$config.API_STATUS.OK&&(t.forTreeResetDataFn(e.data.motorcades),t.tableOptions.searchControls[0].treeDefinedData=e.data.motorcades),a.code===t.$config.API_STATUS.OK&&(t.tableOptions.searchControls[2].treeDefinedData=a.data,t.alarmSelect=[],a.data.forEach(function(e){t.alarmSelect.push({text:e.typeName,value:e.typeCode}),e.children.forEach(function(e){t.alarmSelect.push({text:e.typeName,value:e.typeCode})})}),t.tableOptions.columns[3].tags=t.alarmSelect),t.isTable=!1,t.$nextTick(function(){t.isTable=!0})}))},valueOfNameFn:function(t){var e="";return t&&this.alarmSelect.forEach(function(a){t===a.value&&(e=a.text)}),e},forTreeResetDataFn:function(t){var e=this;t.forEach(function(t){t.vehicleId?(t.treeName=t.licenseNum,t.treeId="v_"+t.vehicleId,t.lezy=!0):(t.treeName=t.motorcadeName,t.treeId="m_"+t.motorcadeId,t.children=[].concat(s()(t.vehicles),s()(t.motorcades)),e.forTreeResetDataFn(t.children))})},tableResponseFn:function(t,e,a){this[e.funcName].call(function(){},t,e,a)},getViewImgFn:function(t){var e="";if(t.asAlarmFiles&&t.asAlarmFiles.length)for(var a=0;a<t.asAlarmFiles.length;a++){var i=t.asAlarmFiles[a];if(i.filePath&&(-1!==i.filePath.indexOf(".png")||-1!==i.filePath.indexOf(".jpg"))){e=this.$config.API_CONFIG.DOWNLOAD_ADDRESS+i.filePath;break}}return""===e&&(e="/static/images/err-img.png"),e},detailFn:function(t){this.formData=t,this.drawerObj.isShow=!0,t.asAlarmFiles&&t.asAlarmFiles.length?(this.carouselList=t.asAlarmFiles,this.activeCarousel=this.carouselList[0]):this.carouselList=[],this.getCarouselFn()},downloadFn:function(t){var e=this,a=this.$loading({lock:!0,text:this.$t("securityAlarm.attachment_generation"),spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});this.$http.get("/alarm/realtime/download/attachment/"+t.alarmNo).then(function(t){if(a.close(),t.code===e.$config.API_STATUS.OK&&t.data){var i=e.$config.API_CONFIG.DOWNLOAD_ADDRESS+t.data,s=i.split("/");e.downloadUrlFn(i,s[s.length-1]),e.drawerObj.isShow=!1}}).catch(function(){a.close()})},downloadUrlFn:function(t,e){var a=document.createElement("a");a.href=t,a.setAttribute("download",e),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(a.href)},exportRecord:function(){var t=this,e=this.$refs.table._data.searchParams,a=e.vehicleId,i=e.alarmType,s=e.solveStatus,l=e.time;a?this.$confirm(this.$t("securityAlarm.confirm_export_record"),this.$t("securityCommon.prompt"),{confirmButtonText:this.$t("securityCommon.ok"),cancelButtonText:this.$t("securityCommon.cancel"),type:"warning",closeOnClickModal:!1,beforeClose:function(e,o,r){if(t.fieldMap={},t.tableOptions.columns.forEach(function(e){t.$refs.table.columnCheckList.forEach(function(a){e.key===a&&"operate"!==e.key&&(t.fieldMap[a]=e.title)})}),"confirm"===e){var n={fieldMap:t.fieldMap,vehicleId:JSON.parse(a),alarmType:i?JSON.parse(i):null,solveStatus:s};l&&(n.startTime=l[0],n.endTime=l[1]),t.$http.download("/alarm/realtime/export?isToken=true",n),r()}else r()}}).catch(function(){}):this.$message.warning(this.$t("securityAlarm.select_export_vehicle"))},getCarouselFn:function(){var t=this;this.$nextTick(function(){t.$refs._oDiv&&(t.getCarouselInfo.getOWidth=Number(t.$refs._oDiv.clientWidth)),t.$refs._iDiv&&(t.getCarouselInfo.getIWidth=Number(t.$refs._iDiv.clientWidth))})},toScrollFn:function(t){this.getCarouselInfo.getOWidth<this.getCarouselInfo.getIWidth&&(0!==this.getCarouselInfo.maginL&&"left"===t&&this.getCarouselInfo.getOWidth<this.getCarouselInfo.getIWidth&&(this.getCarouselInfo.maginL+=150),"right"===t&&this.getCarouselInfo.getOWidth<this.getCarouselInfo.getIWidth&&this.getCarouselInfo.getIWidth+this.getCarouselInfo.maginL>this.getCarouselInfo.getOWidth&&(this.getCarouselInfo.maginL-=150))}}},d=(a("WepR"),a("ZrdR")),u=Object(d.a)(m,function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"page-wrap security-alarm__page"},[t.isPermissionShow("alarmRealtimeList")?[i("div",{staticClass:"radio-view"},[i("el-radio-group",{attrs:{size:t.elNorms.size},model:{value:t.viewType,callback:function(e){t.viewType=e},expression:"viewType"}},[i("el-radio-button",{attrs:{label:"list"}},[t._v(t._s(t.$t("securityAlarm.list")))]),t._v(" "),i("el-radio-button",{attrs:{label:"card"}},[t._v(t._s(t.$t("securityAlarm.card")))])],1)],1),t._v(" "),t.isTable?i("table-view",{ref:"table",attrs:{center:"","id-key":"id","is-search":!0,data:t.tableOptions.data,total:t.tableOptions.total,columns:t.tableOptions.columns,"search-controls":t.tableOptions.searchControls,"footer-buttons":t.tableOptions.footerButtons,"button-controls":t.tableOptions.buttonControls,"pagination-layout":t.tableOptions.paginationLayout,loading:t.tableOptions.loading,"has-show-more-control":"","column-view":"","is-shadow":"list"===t.viewType},on:{requestTableData:t.getTableData,handleCallback:t.tableResponseFn}},[i("el-table-column",{attrs:{slot:"number",label:t.$t("view.index"),type:"index",align:"center",width:"60"},slot:"number"})],1):t._e(),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:"card"===t.viewType,expression:"viewType === 'card'"}],staticClass:"card-view"},t._l(t.tableOptions.data,function(e,a){return i("div",{key:a,staticClass:"card-item"},[i("div",{staticClass:"card-item__title"},[i("div",{staticClass:"card-title__text text-ellipsis"},[t._v("\n            "+t._s(t.valueOfNameFn(e.alarmType))+"\n          ")]),t._v(" "),i("div",{staticClass:"card-title-icon"},[t.isPermissionShow("alarmRealtimeList")?i("i",{staticClass:"el-icon-video-camera-solid",on:{click:function(a){t.detailFn(e)}}}):t._e(),t._v(" "),t.isPermissionShow("alarmRealtimeExport")?i("i",{staticClass:"el-icon-download",on:{click:function(a){t.downloadFn(e)}}}):t._e()])]),t._v(" "),i("div",{staticClass:"card-item__img"},[i("img",{attrs:{src:t.getViewImgFn(e),alt:""}})]),t._v(" "),i("div",{staticClass:"card-item-content"},[i("div",{staticClass:"card-content__row"},[i("div",{staticClass:"card-row__title"},[t._v(t._s(t.$t("securityCommon.alarm_level"))+"：")]),t._v(" "),1===e.alarmLevel?i("div",{staticClass:"card-row__text text-ellipsis"},[t._v(t._s(t.$t("securityCommon.level_1_alarm")))]):t._e(),t._v(" "),2===e.alarmLevel?i("div",{staticClass:"card-row__text text-ellipsis"},[t._v(t._s(t.$t("securityCommon.level_2_alarm")))]):t._e()]),t._v(" "),i("div",{staticClass:"card-content__row"},[i("div",{staticClass:"card-row__title"},[t._v(t._s(t.$t("securityCommon.license_plate"))+"：")]),t._v(" "),i("div",{staticClass:"card-row__text text-ellipsis"},[t._v(t._s(e.licenseNum))])]),t._v(" "),i("div",{staticClass:"card-content__row"},[i("div",{staticClass:"card-row__title"},[t._v(t._s(t.$t("securityAlarm.company"))+"：")]),t._v(" "),i("div",{staticClass:"card-row__text text-ellipsis"},[t._v(t._s(e.motorcadeName))])]),t._v(" "),i("div",{staticClass:"card-content__row"},[i("div",{staticClass:"card-row__title"},[t._v(t._s(t.$t("securityCommon.alarm_time"))+"：")]),t._v(" "),i("div",{staticClass:"card-row__text text-ellipsis"},[t._v(t._s(e.startTime))])]),t._v(" "),i("div",{staticClass:"card-content__row"},[i("div",{staticClass:"card-row__title"},[t._v(t._s(t.$t("securityCommon.reporting_location"))+"：")]),t._v(" "),i("div",{staticClass:"card-row__text text-ellipsis"},[t._v(t._s(e.location))])])])])})),t._v(" "),i("el-drawer",{attrs:{title:t.$t("securityCommon.view_alarm_attachments"),visible:t.drawerObj.isShow,"wrapper-closable":!1,size:"500px",direction:"rtl"},on:{"update:visible":function(e){t.$set(t.drawerObj,"isShow",e)}}},[t.formData?i("div",{staticClass:"drawer-body"},[i("div",{staticClass:"alarm-status"},[i("img",{attrs:{src:a("VFUA"),alt:""}}),t._v(" "),i("span",[t._v(t._s(t.formData.status?t.$t("securityCommon.processed"):t.$t("securityCommon.untreated")))])]),t._v(" "),i("el-form",{ref:"_form",attrs:{model:t.formData,"label-width":"140px"}},[i("el-form-item",{attrs:{label:t.$t("securityCommon.license_plate")+"："}},[t._v("\n            "+t._s(t.formData.licenseNum)+"\n          ")]),t._v(" "),i("el-form-item",{attrs:{label:t.$t("securityCommon.fleet_company")+"："}},[t._v("\n            "+t._s(t.formData.licenseNum)+"\n          ")]),t._v(" "),i("el-form-item",{attrs:{label:t.$t("securityCommon.alarm_level")+"："}},[1===t.formData.alarmLevel?i("span",{staticClass:"d-c"},[t._v(t._s(t.$t("securityCommon.level_1_alarm")))]):t._e(),t._v(" "),2===t.formData.alarmLevel?i("span",{staticClass:"d-c"},[t._v(t._s(t.$t("securityCommon.level_2_alarm")))]):t._e()]),t._v(" "),i("el-form-item",{attrs:{label:t.$t("securityCommon.alarm_type")+"："}},[t._v("\n            "+t._s(t.valueOfNameFn(t.formData.alarmType))+"\n          ")]),t._v(" "),i("el-form-item",{attrs:{label:t.$t("securityCommon.alarm_time")+"："}},[t._v("\n            "+t._s(t.formData.startTime)+" - "+t._s(t.formData.endTime)+"\n          ")]),t._v(" "),i("el-form-item",{attrs:{label:t.$t("securityCommon.reporting_location")+"："}},[t._v("\n            "+t._s(t.formData.location)+"\n          ")])],1),t._v(" "),t.carouselList&&t.carouselList.length?i("div",{staticClass:"my-carousel"},[t.activeCarousel?i("div",{staticClass:"active-img"},[t.activeCarousel.filePath&&-1!==t.activeCarousel.filePath.indexOf(".mp4")?i("video",{attrs:{src:t.$config.API_CONFIG.DOWNLOAD_ADDRESS+t.activeCarousel.filePath,controls:""}}):t.activeCarousel.filePath?i("img",{attrs:{src:t.$config.API_CONFIG.DOWNLOAD_ADDRESS+t.activeCarousel.filePath}}):t._e()]):i("div",{staticClass:"active-img null-active"}),t._v(" "),i("div",{staticClass:"left-icon control-view",on:{click:function(e){t.toScrollFn("left")}}},[i("i",{staticClass:"el-icon-arrow-left"})]),t._v(" "),i("div",{staticClass:"right-icon control-view",on:{click:function(e){t.toScrollFn("right")}}},[i("i",{staticClass:"el-icon-arrow-right"})]),t._v(" "),i("div",{ref:"_oDiv",staticClass:"list-view"},[i("div",{ref:"_iDiv",staticClass:"content",style:"margin-left:"+t.getCarouselInfo.maginL+"px;"},[t._l(t.carouselList,function(e,a){return[e.filePath?i("div",{key:a,staticClass:"content-view",on:{click:function(a){t.activeCarousel=e}}},[-1!==e.filePath.indexOf(".mp4")?i("i",{staticClass:"iconfont Jamin_replay_icon_bofang"}):t._e(),t._v(" "),-1!==e.filePath.indexOf(".mp4")?i("video",{attrs:{src:t.$config.API_CONFIG.DOWNLOAD_ADDRESS+e.filePath}}):i("img",{attrs:{src:t.$config.API_CONFIG.DOWNLOAD_ADDRESS+e.filePath}})]):t._e()]})],2)])]):t._e()],1):t._e(),t._v(" "),t.isPermissionShow("alarmRealtimeExport")?i("div",{staticClass:"footBtn"},[i("el-button",{attrs:{type:"primary",size:t.elNorms.size,round:t.elNorms.round,circle:t.elNorms.circle},on:{click:function(e){t.downloadFn(t.formData)}}},[t._v(t._s(t.$t("securityCommon.download_alarm_attachments")))])],1):t._e()])]:t._e(),t._v(" "),t.isPermissionShow("alarmRealtimeList")||t.$store.state.app.permsDataLoading?t._e():i("notPerm")],2)},[],!1,null,"4e450b9d",null);u.options.__file="security-alarm.vue";e.default=u.exports}}]);