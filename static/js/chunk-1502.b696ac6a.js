(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1502"],{"+FhJ":function(e,t,i){"use strict";var a=i("Rp3S");i.n(a).a},"/ce4":function(e,t,i){"use strict";var a=i("qJgp");i.n(a).a},Rp3S:function(e,t,i){},bKGD:function(e,t,i){"use strict";i.r(t);var a=i("omC7"),s=i.n(a),r=i("ABCu"),n=i("l5p/"),o=i("XpzI"),c=i("XVnh"),l=i("iCa3"),d=i("aprb"),u={components:{recordsMap:n.default,recordItem:o.default,treeView:r.a,notPerm:c.a},mixins:[l.default],data:function(){return{isPermission:!1,loading:!1,elNorms:this.$store.getters.elNorms,date:null,multiList:[],multiNum:0,activeData:{},treeObj:[],checkedKeys:[],isTree:!1,treeViewObj:{isTree:!1,isShow:!1},carTreeViewType:"1",filterText:"",activeTreeData:null,treeData:{extendData:{},checkbox:!0,defaultProps:{motorcade:"motorcade",parentId:"parentId",status:"status",children:"children",label:"label",id:"id",count:"count"},nodeKey:"treeId",currentNodeKey:1,defaultExpandAll:!0,expandClickNode:!1,indent:16,screenFn:{bindFn:function(e,t){return!e||-1!==t.label.indexOf(e)}}},treeDefinedData:[],drawerObj:{isShow:!1},selectValue:!1}},watch:{filterText:function(e){this.$refs.tree.$refs.sonTree.filter(e)}},created:function(){this.initVehicleAllTreeList()},mounted:function(){},methods:{handlePermissionShow:function(){this.isPermission=this.isPermissionShow("postionRecordsReplaysVehicleAllTreeList")},query:function(){var e=this,t=this.$refs.tree.getCheckedNodes();if(0!==t.length)if(this.date&&0!==this.date.length){var i={endTime:this.date[1],startTime:this.date[0],vehicleId:[]};t.forEach(function(e){!1===e.motorcade&&i.vehicleId.push(e.id)}),this.loading=!0,this.$http.post("/locus/multiVehicleGps/list",i).then(function(t){e.loading=!1,t.data&&t.data.length>0&&(e.multiNum=t.data.length,e.multiList=[],t.data.forEach(function(t,i){e.multiList[i]=e.lnglatList(t)}))}).catch(function(){e.loading=!1})}else this.$message.error(this.$t("tracksPage.search_message_2"));else this.$message.error(this.$t("tracksPage.search_message_1"))},lnglatList:function(e){var t=e.driveMileage,i=e.vehicleId,a=e.licenseNum,s=e.locationList,r={vehicleId:i,driveMileage:t.toFixed(2),licenseNum:a,initData:[],startTime:this.date[0],endTime:this.date[1]};if(0===s.length)return r;for(var n=0;n<s.length;n++)if(s[n].latitude||s[n].longitude){var o=Object(d.b)(s[n].longitude,s[n].latitude);r.initData.push(o)}return r},selectTrue:function(){this.treeViewObj.isTree=!0},selectFalse:function(){this.treeViewObj.isTree=!1},initVehicleAllTreeList:function(){var e=this;this.checkedKeys=[],this.$http.get("/postion/recordsReplays/vehicleAllTreeList").then(function(t){if(t.code===e.$config.API_STATUS.OK){var i=[{motorcades:t.data.motorcades,vehicles:t.data.vehicles}];e.treeArr(i),e.treeDefinedData=[{motorcade:!0,parentId:null,motorcadeId:"None",label:e.$t("view.tree_parent_name"),id:"None",children:i[0].children}],e.isTree=!1,e.$nextTick(function(){e.isTree=!0})}})},treeArr:function(e){for(var t=this,i=function(i){if(e[i].motorcades){var a=[];e[i].vehicles&&e[i].vehicles.forEach(function(s){t.checkedKeys.push("v"+s.vehicleId),a.push({motorcade:!1,parentId:e[i].vehiclePid,status:s.status,label:s.licenseNum,id:s.vehicleId,treeId:"v"+s.vehicleId,onlineStatus:s.onlineStatus,isCompany:s.isCompany,vehicleId:s.vehicleId})}),e[i].motorcades.forEach(function(e){!e.motorcades.length&&t.checkedKeys.push("m"+e.motorcadeId),a.push({motorcade:!0,parentId:e.parentId,status:e.status,motorcades:e.motorcades,vehicles:e.vehicles,label:e.motorcadeName,id:e.motorcadeId,count:e.count,vehiclePid:e.motorcadeId,treeId:"m"+e.motorcadeId,isCompany:e.isCompany})}),e[i].children=JSON.parse(s()(a)),t.treeArr(e[i].children),delete e[i].motorcades,delete e[i].vehicles}},a=0;a<e.length;a++)i(a)},openDrawerFn:function(e){var t=this;this.drawerObj.isShow=!0,this.activeData=e,setTimeout(function(){t.$refs._record_item.activeVehicle()},200)},treeChange:function(e){this.$refs.tree.getCheckedNodes().length?this.selectValue=!0:this.selectValue=!1},setTreeData:function(){this.initVehicleAllTreeList()}}},h=(i("/ce4"),i("ZrdR")),m=Object(h.a)(u,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"page-view records-replays",on:{click:e.selectFalse}},[e.isPermission?[a("div",{staticClass:"records-search"},[a("el-select",{staticStyle:{"margin-right":"20px"},attrs:{size:e.elNorms.size},on:{focus:e.selectTrue},model:{value:e.selectValue,callback:function(t){e.selectValue=t},expression:"selectValue"}},[a("el-option",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:e.$t("tracksPage.checked"),value:!0}}),e._v(" "),a("el-option",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:e.$t("tracksPage.unchecked"),value:!1}})],1),e._v(" "),a("el-date-picker",{staticStyle:{"margin-right":"20px"},attrs:{size:e.elNorms.size,type:"datetimerange","range-separator":"-","start-placeholder":e.$t("tracksPage.start_time"),"end-placeholder":e.$t("tracksPage.end_time"),"value-format":"yyyy-MM-dd HH:mm:ss","default-time":["00:00:00","23:59:59"]},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}}),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:e.elNorms.size,round:e.elNorms.round,circle:e.elNorms.circle},on:{click:e.query}},[e._v(e._s(e.$t("operation.query")))])],1),e._v(" "),e.multiList.length>0?a("div",{staticClass:"records-body"},e._l(e.multiList,function(t,s){return a("div",{key:s,staticClass:"records-item",on:{click:function(i){e.openDrawerFn(t)}}},[a("div",{staticClass:"item-map"},[a("records-map",{attrs:{index:s,"locus-data":t.initData}})],1),e._v(" "),a("div",{staticClass:"item-content"},[a("div",{staticClass:"item-license"},[a("div",{staticClass:"item-img-text"},[e._v(" "+e._s(t.licenseNum)+" ")]),e._v(" "),a("img",{attrs:{src:i("2QmI"),alt:""}})]),e._v(" "),a("div",{staticClass:"item-text"},[e._v(e._s(t.driveMileage)+"km")])])])})):e._e(),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.treeViewObj.isTree,expression:"treeViewObj.isTree"}],staticClass:"search-tree",on:{click:function(t){return t.stopPropagation(),e.selectTrue(t)}}},[a("div",{staticClass:"input-query"},[a("el-input",{attrs:{size:e.elNorms.size,placeholder:e.$t("tracksPage.tree_search"),"prefix-icon":"el-icon-search"},model:{value:e.filterText,callback:function(t){e.filterText="string"==typeof t?t.trim():t},expression:"filterText"}},[a("template",{slot:"append"},[a("i",{staticClass:"el-icon-refresh-right",on:{click:e.setTreeData}})])],2)],1),e._v(" "),a("div",{staticClass:"body-tree init-tree"},[e.isTree?a("tree-view",{ref:"tree",attrs:{"tree-data":e.treeData,"defined-data":e.treeDefinedData},on:{check:e.treeChange},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"left-title text-ellipsis",style:e.activeTreeData&&t.data.data.id===e.activeTreeData.id?"color: var(--main-primary);":""},[t.data.data.vehicleId?a("i",{staticClass:"iconfont Jamin_location_icon_che-lv",style:t.data.data.onlineStatus?"color: var(--main-success);":"color: #999999;"}):null===t.data.data.parentId?a("i",{staticClass:"iconfont Jamin_location_icon_dn"}):1===t.data.data.isCompany?a("i",{staticClass:"iconfont Jamin_location_icon_gs"}):a("i",{staticClass:"iconfont Jamin_location_icon_cd"}),e._v("\n              "+e._s(t.data.data.label)+"\n            ")])]}}])}):e._e()],1)]),e._v(" "),a("el-drawer",{attrs:{title:e.$t("tracksPage.vehicle_trajectory"),size:"100%",direction:"btt",visible:e.drawerObj.isShow,"wrapper-closable":!1},on:{"update:visible":function(t){e.$set(e.drawerObj,"isShow",t)}}},[a("div",{staticClass:"records-drawer-body"},[a("recordItem",{ref:"_record_item",attrs:{"is-child":!0,"active-data":e.activeData}})],1)])]:e._e(),e._v(" "),e.isPermission||e.$store.state.app.permsDataLoading?e._e():a("notPerm")],2)},[],!1,null,"0647ae8b",null);m.options.__file="records-replays.vue";t.default=m.exports},"l5p/":function(e,t,i){"use strict";i.r(t);var a=i("omC7"),s=i.n(a),r=i("AkzS"),n=i.n(r),o={props:{index:{type:Number,default:0},locusData:{type:Array,default:function(){return[]}}},data:function(){return{mapLoadingStyle:"background-color: #ebebeb;",mapId:"amap-container_"+this.index,AMapGL:null,gapdeMap:null,carMarker:null,polyline:null,passedPolyline:null}},created:function(){this.initLocusData=JSON.parse(s()(this.locusData))},mounted:function(){var e=this;this.$nextTick(function(){e.createAMap(),e.createLocusFn(),e.setFitView()})},methods:{createAMap:function(){this.gapdeMap=new n.a.Map(this.mapId,{resizeEnable:!0,center:[105.389814,38.311781],zoom:4})},createCarMarkerFn:function(){this.carMarker=new n.a.Marker({map:this.gapdeMap,position:this.initLocusData[0],icon:"https://a.amap.com/jsapi_demos/static/demo-center-v2/car.png",offset:new n.a.Pixel(-13,-26),autoRotation:!0,angle:-90}),this.startMarker=new n.a.Marker({map:this.gapdeMap,position:this.initLocusData[0],icon:i("dDFt"),offset:new n.a.Pixel(-14,-34)}),this.endMarker=new n.a.Marker({map:this.gapdeMap,position:this.initLocusData[this.initLocusData.length-1],icon:i("foDw"),offset:new n.a.Pixel(-14,-34)})},createLocusFn:function(){this.polyline=new n.a.Polyline({map:this.gapdeMap,path:this.initLocusData,showDir:!0,strokeColor:"#409EFF",strokeOpacity:1,strokeWeight:8,strokeStyle:"solid"})},setFitView:function(){this.gapdeMap.setFitView()}}},c=(i("+FhJ"),i("ZrdR")),l=Object(c.a)(o,function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"records-item-map"},[t("div",{staticClass:"amap-page",attrs:{id:this.mapId}}),this._v(" "),t("div",{staticClass:"map-mask"})])},[],!1,null,null,null);l.options.__file="records-item-map.vue";t.default=l.exports},qJgp:function(e,t,i){}}]);