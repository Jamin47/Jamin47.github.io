(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-928d"],{"2uWx":function(e,t,i){"use strict";var a=i("MFej");i.n(a).a},MFej:function(e,t,i){},Xks0:function(e,t,i){"use strict";i.r(t);var a=i("BHIJ"),n=i("AlM9"),r=i("YelX"),s={components:{TableView:n.a,drawer:a.a},mixins:[r.default],data:function(){return{isTable:!0,drawerDisplay:!1,drawerData:{},alias:{pageSize:"pageSize",pageNum:"pageNum"},tableOptions:{data:[],total:0,columns:[{type:"slot",name:"number",title:"序号"},{title:this.$t("InsurancePage.licenseNum"),key:"licenseNum",minWidth:"130",type:"text"},{title:this.$t("InsurancePage.licenseColor"),key:"licenseColor",type:"tagText",minWidth:"130",tags:[]},{title:this.$t("InsurancePage.companyName"),key:"companyName",type:"text",minWidth:"150"},{title:this.$t("InsurancePage.insurCompany"),key:"insurCompany",minWidth:"150",type:"text"},{title:this.$t("InsurancePage.insurType"),key:"type",type:"text",minWidth:"140"},{title:this.$t("InsurancePage.insurNum"),key:"insurNum",minWidth:"150",type:"text"},{title:this.$t("InsurancePage.effectAt"),key:"effectAt",minWidth:"160",type:"text"},{title:this.$t("InsurancePage.timeoutAt"),key:"timeoutAt",minWidth:"160",type:"text"},{title:this.$t("InsurancePage.form_advanceNum"),key:"advanceNum",minWidth:"130",type:"text"},{title:this.$t("operation.operation"),type:"operate",key:"operate",fixed:"right",width:"160",buttons:[]}],buttonControls:[],searchControls:[{type:"input",key:"licenseNum",placeholder:this.$t("view.license_num"),width:"200px"},{type:"treeSelect",key:"companyIds",valueKey:"companyId",placeholder:this.$t("view.searchControl_company"),width:"200px",clearable:!0,treeOption:{defaultProps:{children:"sysCompanyNodes",label:"name"},nodeKey:"companyId",defaultExpandAll:!1,expandClickNode:!1,checkbox:!0,screenFn:{bindFn:function(e,t){return!e||-1!==t.name.indexOf(e)}}},treeDefinedData:this.$parent.$parent.$parent.$parent.companyTreeData},{type:"input",key:"type",placeholder:this.$t("InsurancePage.searchControls_insurType"),width:"200px"}],footerButtons:[],paginationLayout:"total, sizes, prev, pager, next, jumper",loading:!1},params:null}},computed:{},created:function(){var e=this;this.$http.get("/dict/list/codes",{dicCodes:"licenseColor"}).then(function(t){t.code===e.$config.API_STATUS.OK&&(t.data.licenseColor.forEach(function(t,i){e.tableOptions.columns[2].tags[i]={value:t.itemName,text:t.itemValue}}),e.isTable=!1,e.$nextTick(function(){e.isTable=!0}))})},mounted:function(){},methods:{handlePermissionShow:function(){this.tableOptions.buttonControls=[],this.isPermissionShow("insuranceCreate")&&this.tableOptions.buttonControls.push({text:this.$t("InsurancePage.buttonControls_insur"),type:"primary",icon:"el-icon-plus",funcName:"increase"}),this.isPermissionShow("insuranceExport")&&this.tableOptions.buttonControls.push({text:this.$t("InsurancePage.buttonControls_export"),type:"null",icon:"el-icon-download",funcName:"export",dataStatus:!0}),this.isPermissionShow("insuranceDelete")&&this.tableOptions.footerButtons.push({text:this.$t("operateCommon.delete"),type:"danger",icon:"el-icon-delete",funcName:"delete"});var e=this.tableOptions.columns.findIndex(function(e){return"operate"===e.key});e>-1&&this.isPermissionShow("insuranceList")&&this.tableOptions.columns[e].buttons.push({tipText:this.$t("operation.detail"),icon:"iconfont Jamin_vehicle_ico_xq",type:"text",funcName:"detail"}),e>-1&&this.isPermissionShow("insuranceUpdate")&&this.tableOptions.columns[e].buttons.push({tipText:this.$t("operation.edit"),icon:"iconfont Jamin_vehicle_icon_bj",type:"text",funcName:"edit"})},getTableData:function(e){var t=this;this.tableOptions.loading=!0;var i={licenseNum:e.licenseNum,companyIds:e.companyIds?JSON.parse(e.companyIds):[],type:e.type};this.$http.post("/insurance/list?pageNum="+e.pageNum+"&pageSize="+e.pageSize,i).then(function(e){t.tableOptions.loading=!1,e.code===t.$config.API_STATUS.OK?(t.tableOptions.data=e.data.list,t.tableOptions.total=e.data.total):(t.tableOptions.data=[],t.tableOptions.total=0)}).catch(function(){t.tableOptions.data=[],t.tableOptions.total=0,t.tableOptions.loading=!1}),this.params=e},tableResponseFn:function(e,t,i){this[t.funcName].call(function(){},e,t,i)},edit:function(e){var t=this;this.$http.get("/insurance/"+e.insurId).then(function(i){if(i.code===t.$config.API_STATUS.OK){e=i.data;var a=function(e,i,a){t.$refs.drawer.formData.effectAt&&t.$refs.drawer.formData.timeoutAt?new Date(t.$refs.drawer.formData.effectAt).getTime()>new Date(t.$refs.drawer.formData.timeoutAt).getTime()?a(new Error(t.$t("confirm.confirm_time_1"))):a():a()};t.drawerDisplay=!0,t.drawerData={staticData:e,isShow:!0,title:t.$t("InsurancePage.form_edit_insur_title"),titleWidth:"120",data:{},defaultData:"",submitAction:"/insurance/update/"+e.insurId,btnAlign:"center",formList:[{title:t.$t("InsurancePage.form_edit_insur_vehicleId"),type:"treeSelect",key:"vehicleId",valueKey:"vehicleId",offsetWidth:"320",label:e.licenseNum,treeOption:{defaultProps:{children:"children",label:"treeName"},nodeKey:"treeId",nodeCode:"iconfont Jamin_vehicle_icon_clgl1",defaultExpandAll:!1,expandClickNode:!1,screenFn:{bindFn:function(e,t){return!e||-1!==t.treeName.indexOf(e)}}},treeDefinedData:t.$parent.$parent.$parent.$parent.carTreeData,rules:[{required:!0,message:t.$t("InsurancePage.form_vehicleId_placeholder"),trigger:"blur"}]},{title:t.$t("InsurancePage.form_edit_insur_insurCompany"),type:"input",key:"insurCompany",offsetWidth:"320",rules:[{required:!0,message:t.$t("InsurancePage.form_edit_insur_insurCompany_placeholder"),trigger:"blur"}]},{title:t.$t("InsurancePage.form_edit_insur_type"),type:"input",key:"type",offsetWidth:"320",rules:[{required:!0,message:t.$t("InsurancePage.form_edit_insur_type_placeholder"),trigger:"blur"}]},{title:t.$t("InsurancePage.form_edit_insur_insurNum"),type:"input",key:"insurNum",offsetWidth:"320",rules:[{required:!0,message:t.$t("InsurancePage.form_edit_insur_insurNum_placeholder"),trigger:"blur"}]},{title:t.$t("InsurancePage.form_edit_insur_price"),type:"input",key:"price",offsetWidth:"320",rules:[{required:!0,message:t.$t("InsurancePage.form_edit_insur_price_placeholder"),trigger:"blur"}]},{title:t.$t("InsurancePage.form_edit_insur_effectAt"),type:"dateSelect",offsetWidth:"320",valueFormat:"yyyy-MM-dd",key:"effectAt",rules:[{required:!0,message:t.$t("InsurancePage.form_edit_insur_effectAt_placeholder"),trigger:"change"},{validator:a,trigger:"change"}]},{title:t.$t("InsurancePage.form_edit_insur_timeoutAt"),type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"timeoutAt",rules:[{required:!0,message:t.$t("InsurancePage.form_edit_insur_timeoutAt_placeholder"),trigger:"change"},{validator:a,trigger:"change"}]},{title:t.$t("InsurancePage.form_edit_insur_advanceNum"),type:"input",key:"advanceNum",offsetWidth:"320",rules:[{required:!0,message:t.$t("InsurancePage.form_edit_insur_advanceNum_placeholder"),trigger:"blur"}]},{title:t.$t("InsurancePage.form_payer"),type:"input",offsetWidth:"320",key:"payer"},{title:t.$t("InsurancePage.form_handler"),type:"input",offsetWidth:"320",key:"handler"},{title:t.$t("InsurancePage.form_phone"),type:"input",offsetWidth:"320",key:"phone"},{title:t.$t("InsurancePage.form_description"),type:"input",offsetWidth:"320",key:"remark"},{title:t.$t("InsurancePage.form_attachedPhoto"),type:"imgUpload",offsetWidth:"320",action:t.$config.API_CONFIG.API_ROOT+"/file/upload/attachedPhoto",key:"attachedPhoto",accept:"image/jpeg,image/png",headers:{Authorization:t.$store.getters.userData.tokenHead+t.$store.getters.userData.token},showFileList:!1,beforeUpload:function(e){},onProgress:function(e){},onSuccess:function(e){e.code===t.$config.API_STATUS.OK&&t.$set(t.$refs.drawer.formData,"attachedPhoto",e.data.url)}}],formButton:[{name:t.$t("confirm.determine"),type:"confirm",class:"primary"},{name:t.$t("confirm.cancel"),type:"cancel",class:""}],message:{type:"success",message:t.$t("confirm.editSuccess")}}}})},detail:function(e){var t=this;this.$http.get("/insurance/"+e.insurId).then(function(i){i.code===t.$config.API_STATUS.OK&&(e=i.data,t.drawerDisplay=!0,t.drawerData={staticData:e,isShow:!0,title:t.$t("InsurancePage.detail_insur_title"),titleWidth:"120",btnAlign:"center",formList:[{title:t.$t("InsurancePage.detail_insur_licenseNum"),type:"text",key:"licenseNum",offsetWidth:"320"},{title:t.$t("InsurancePage.insurCompany"),type:"text",key:"insurCompany",offsetWidth:"320"},{title:t.$t("InsurancePage.insurType"),type:"text",key:"type",offsetWidth:"320"},{title:t.$t("InsurancePage.insurNum"),type:"text",key:"insurNum",offsetWidth:"320"},{title:t.$t("InsurancePage.form_edit_insur_price"),type:"text",key:"price",offsetWidth:"320"},{title:t.$t("InsurancePage.form_edit_insur_effectAt"),type:"text",offsetWidth:"320",key:"effectAt"},{title:t.$t("InsurancePage.form_edit_insur_timeoutAt"),type:"text",offsetWidth:"320",key:"timeoutAt"},{title:t.$t("InsurancePage.detail_insur_advanceNum"),type:"text",key:"advanceNum",offsetWidth:"320"},{title:t.$t("InsurancePage.detail_payer"),type:"text",offsetWidth:"320",key:"payer"},{title:t.$t("InsurancePage.detail_handler"),type:"text",offsetWidth:"320",key:"handler"},{title:t.$t("InsurancePage.detail_phone"),type:"text",offsetWidth:"320",key:"phone"},{title:t.$t("InsurancePage.detail_description"),type:"text",offsetWidth:"320",key:"remark"},{title:t.$t("InsurancePage.detail_attachedPhoto"),type:"imageView",offsetWidth:"320",key:"attachedPhoto"}]})})},increase:function(){var e=this;this.drawerDisplay=!0;var t=function(t,i,a){e.$refs.drawer.formData.effectAt&&e.$refs.drawer.formData.timeoutAt?new Date(e.$refs.drawer.formData.effectAt).getTime()>new Date(e.$refs.drawer.formData.timeoutAt).getTime()?a(new Error(e.$t("confirm.confirm_time_1"))):a():a()};this.drawerData={isShow:!0,title:this.$t("InsurancePage.form_edit_insur_add_title"),titleWidth:"120",data:{},defaultData:"",submitAction:"/insurance/create",btnAlign:"center",formList:[{title:this.$t("InsurancePage.form_edit_insur_vehicleId"),type:"treeSelect",key:"vehicleId",valueKey:"vehicleId",offsetWidth:"320",treeOption:{defaultProps:{children:"children",label:"treeName"},nodeKey:"treeId",nodeCode:"iconfont Jamin_vehicle_icon_clgl1",defaultExpandAll:!1,expandClickNode:!1,screenFn:{bindFn:function(e,t){return!e||-1!==t.treeName.indexOf(e)}}},treeDefinedData:this.$parent.$parent.$parent.$parent.carTreeData,rules:[{required:!0,message:this.$t("InsurancePage.form_vehicleId_placeholder"),trigger:"blur"}]},{title:this.$t("InsurancePage.form_edit_insur_insurCompany"),type:"input",key:"insurCompany",offsetWidth:"320",rules:[{required:!0,message:this.$t("InsurancePage.form_edit_insur_insurCompany_placeholder"),trigger:"blur"}]},{title:this.$t("InsurancePage.form_edit_insur_type"),type:"input",key:"type",offsetWidth:"320",rules:[{required:!0,message:this.$t("InsurancePage.form_edit_insur_type_placeholder"),trigger:"blur"}]},{title:this.$t("InsurancePage.form_edit_insur_insurNum"),type:"input",key:"insurNum",offsetWidth:"320",rules:[{required:!0,message:this.$t("InsurancePage.form_edit_insur_insurNum_placeholder"),trigger:"blur"}]},{title:this.$t("InsurancePage.form_edit_insur_price"),type:"input",key:"price",offsetWidth:"320",rules:[{required:!0,message:this.$t("InsurancePage.form_edit_insur_price_placeholder"),trigger:"blur"}]},{title:this.$t("InsurancePage.form_edit_insur_effectAt"),type:"dateSelect",offsetWidth:"320",valueFormat:"yyyy-MM-dd",key:"effectAt",rules:[{required:!0,message:this.$t("InsurancePage.form_edit_insur_effectAt_placeholder"),trigger:"change"},{validator:t,trigger:"change"}]},{title:this.$t("InsurancePage.form_edit_insur_timeoutAt"),type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"timeoutAt",rules:[{required:!0,message:this.$t("InsurancePage.form_edit_insur_timeoutAt_placeholder"),trigger:"change"},{validator:t,trigger:"change"}]},{title:this.$t("InsurancePage.form_edit_insur_advanceNum"),type:"input",key:"advanceNum",offsetWidth:"320",rules:[{required:!0,message:this.$t("InsurancePage.form_edit_insur_advanceNum_placeholder"),trigger:"blur"}]},{title:this.$t("InsurancePage.detail_payer"),type:"input",offsetWidth:"320",key:"payer"},{title:this.$t("InsurancePage.detail_handler"),type:"input",offsetWidth:"320",key:"handler"},{title:this.$t("InsurancePage.detail_phone"),type:"input",offsetWidth:"320",key:"phone"},{title:this.$t("InsurancePage.detail_description"),type:"input",offsetWidth:"320",key:"remark"},{title:this.$t("InsurancePage.detail_attachedPhoto"),type:"imgUpload",offsetWidth:"320",action:this.$config.API_CONFIG.API_ROOT+"/file/upload/attachedPhoto",key:"attachedPhoto",disabled:!0,accept:"image/jpeg,image/png",headers:{Authorization:this.$store.getters.userData.tokenHead+this.$store.getters.userData.token},showFileList:!1,beforeUpload:function(e){},onProgress:function(e){},onSuccess:function(t){t.code===e.$config.API_STATUS.OK&&e.$set(e.$refs.drawer.formData,"attachedPhoto",t.data.url)}}],formButton:[{name:this.$t("confirm.determine"),type:"confirm",class:"primary"},{name:this.$t("confirm.cancel"),type:"cancel",class:""}],message:{type:"success",message:this.$t("confirm.addSuccess")},confirmSubmitFn:function(e,t){e.price=parseFloat(e.price)}}},export:function(){var e=this;this.$confirm(this.$t("confirm.export"),this.$t("confirm.title"),{confirmButtonText:this.$t("confirm.determine"),cancelButtonText:this.$t("confirm.cancel"),type:"warning",closeOnClickModal:!1,beforeClose:function(t,i,a){e.fieldMap={},e.tableOptions.columns.forEach(function(t){e.$refs.table.columnCheckList.forEach(function(i){t.key===i&&"operate"!==t.key&&(e.fieldMap[i]=t.title)})});var n=e.params,r=n.licenseNum,s=n.companyIds,o=n.type;if("confirm"===t){var c={fieldMap:e.fieldMap,licenseNum:r,companyIds:s?JSON.parse(s):[],type:o};e.tableOptions.total<e.$store.getters.userData.realtimeVideoUrl?e.$http.download("/insurance/export?isToken=true",c):e.$http.post("/insurance/export/async",c),a()}else a()}}).catch(function(){})},delete:function(e){var t=this;this.$confirm(this.$t("confirm.del"),this.$t("confirm.title"),{confirmButtonText:this.$t("confirm.determine"),cancelButtonText:this.$t("confirm.cancel"),type:"warning"}).then(function(){var i=[];e.forEach(function(e,t){i[t]=e.insurId}),t.$http.deleteApi("/insurance/delete",{ids:i.join(",")}).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.$refs.table.initRequestTableData(),t.$message({message:e.message,type:"success"}))})})},diaClose:function(e){e&&this.$refs.table.initRequestTableData(),this.drawerDisplay=!1},drawerCallback:function(e,t,i,a){this[e.handlerCallback.funcName].call(function(){},t,i,a)}}},o=(i("2uWx"),i("ZrdR")),c=Object(o.a)(s,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"main"},[e.isTable?i("table-view",{ref:"table",attrs:{center:"","id-key":"insurId","is-search":!0,"check-memory":!0,data:e.tableOptions.data,total:e.tableOptions.total,columns:e.tableOptions.columns,"search-controls":e.tableOptions.searchControls,"footer-buttons":e.tableOptions.footerButtons,"button-controls":e.tableOptions.buttonControls,"pagination-layout":e.tableOptions.paginationLayout,loading:e.tableOptions.loading,"view-table-key":"purchase",checked:"","column-view":"",alias:e.alias},on:{requestTableData:e.getTableData,handleCallback:e.tableResponseFn}},[i("el-table-column",{attrs:{slot:"number",label:e.$t("view.index"),type:"index",align:"center"},slot:"number"})],1):e._e(),e._v(" "),e.drawerDisplay?i("drawer",{ref:"drawer",attrs:{size:"small","drawer-data":e.drawerData},on:{diaClose:e.diaClose,handlerCallback:e.drawerCallback}}):e._e()],1)},[],!1,null,"97b9a9f2",null);c.options.__file="purchase.vue";t.default=c.exports}}]);