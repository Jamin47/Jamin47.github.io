(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-5344"],{"2itw":function(t,a,e){t.exports=e.p+"static/img/car.4c92cbc.png"},MIbw:function(t,a,e){"use strict";var n=e("zr80");e.n(n).a},foDw:function(t,a,e){t.exports=e.p+"static/img/replay_pic_zhong.88c4b65.png"},lrbD:function(t,a,e){t.exports=e.p+"static/img/icon_zd.fbde0e6.png"},vRT2:function(t,a,e){"use strict";e.r(a);var n=e("omC7"),i=e.n(n),s=e("AkzS"),o=e.n(s),r={data:function(){return{elNorms:this.$store.getters.elNorms,AMapGL:null,gapdeMap:null,carMarker:null,polyline:null,passedPolyline:null,searchValue:"",placeSearch:null,locusData:[],graspRoad:null,infoWindow:null,moveIndex:0,moveActiveData:null,windowShow:!0,timeOut:null}},watch:{searchValue:function(t){this.placeSearch.search(t)},moveIndex:function(t){this.passedPolyline.setPath(this.locusData.slice(0,t)),this.$parent.carInfoObj.slider=t,t>this.locusData.length-1&&(this.$parent.carInfoObj.playStatus="stop")}},mounted:function(){var t=this;this.$nextTick(function(){t.createAMap()})},methods:{createAMap:function(){var t=this;t.gapdeMap=new o.a.Map("amap-container",{resizeEnable:!0,center:[105.389814,38.311781],zoom:4}),o.a.plugin(["AMap.ToolBar","AMap.Scale","AMap.PlaceSearch","AMap.GraspRoad"],function(){t.gapdeMap.addControl(new o.a.ToolBar({liteStyle:!0,position:"RT"})),t.gapdeMap.addControl(new o.a.Scale({liteStyle:!0,position:"RB"})),t.placeSearch=new o.a.PlaceSearch({city:"全国",map:t.gapdeMap}),t.graspRoad=new o.a.GraspRoad})},createCarMarkerFn:function(){this.locusData=JSON.parse(i()(this.$parent.locusData)),this.carMarker=new o.a.Marker({map:this.gapdeMap,position:this.locusData[0],icon:e("2itw"),offset:new o.a.Pixel(-26,-13),autoRotation:!0});var t=e("LBOA"),a=e("lrbD");"zh-CN"===this.$store.getters.language&&(t=e("dDFt"),a=e("foDw")),this.startMarker=new o.a.Marker({map:this.gapdeMap,position:this.locusData[0],icon:t,offset:new o.a.Pixel(-14,-34)}),this.endMarker=new o.a.Marker({map:this.gapdeMap,position:this.locusData[this.locusData.length-1],icon:a,offset:new o.a.Pixel(-14,-34)})},createLocusFn:function(){this.polyline=new o.a.Polyline({map:this.gapdeMap,path:this.locusData,lineJoin:"round",showDir:this.$parent.carInfoObj.iconStatus,strokeColor:"#409EFF",strokeOpacity:this.$parent.carInfoObj.lineStatus?this.$parent.carInfoObj.lineOpacity:0,strokeWeight:this.$parent.carInfoObj.lineWidth}),this.passedPolyline=new o.a.Polyline({map:this.gapdeMap,lineJoin:"round",strokeColor:"#67C23A",strokeOpacity:.5,strokeWeight:this.$parent.carInfoObj.lineWidth})},setPolylineOptions:function(){this.polyline.setOptions({showDir:this.$parent.carInfoObj.iconStatus,strokeColor:"#409EFF",strokeOpacity:this.$parent.carInfoObj.lineStatus?this.$parent.carInfoObj.lineOpacity:0,strokeWeight:this.$parent.carInfoObj.lineWidth}),this.passedPolyline.setOptions({strokeOpacity:this.$parent.carInfoObj.lineStatus?.5:0,strokeWeight:this.$parent.carInfoObj.lineWidth})},movingCarFn:function(){var t=this;t.carMarker.on("moveend",function(a){t.nextPointFn(),t.timeOut&&clearTimeout(t.timeOut),t.timeOut=setTimeout(function(){t.moveIndex<t.locusData.length-1&&t.nextPointFn()},3e3)}),t.carMarker.on("click",function(a){var e=t.moveIndex>t.$parent.trackTableData.length-1?t.$parent.trackTableData.length-1:t.moveIndex;t.windowShow=!0,t.openLineWindowFn(t.$parent.trackTableData[e])})},nextPointFn:function(){var t=this.$parent.carInfoObj;this.moveIndex++,this.contrastFn(),this.getContainsPointFn(this.locusData[this.moveIndex]),this.$parent.currentTableActiveRowFn(this.moveIndex);var a=this.locusData[this.moveIndex];this.openLineWindowFn(this.$parent.trackTableData[this.moveIndex]),a&&(this.moveActiveData=a,"play"===t.playStatus&&this.carMarker.moveTo(a,t.speed))},contrastFn:function(){var t=this.locusData[this.moveIndex],a=Math.abs(t.lng-this.moveActiveData.lng)<4e-4,e=Math.abs(t.lat-this.moveActiveData.lat)<4e-4;t&&this.moveActiveData&&a&&e&&(this.moveIndex++,this.$parent.currentTableActiveRowFn(this.moveIndex),this.contrastFn())},startAnimation:function(){var t=this.$parent.carInfoObj;this.moveIndex>this.locusData.length-1&&(this.moveIndex=0,this.moveActiveData=null,this.carMarker.setPosition(this.locusData[this.moveIndex])),"stop"!==t.playStatus&&"pause"!==t.playStatus||(this.moveActiveData=this.locusData[this.moveIndex],this.moveIndex++,this.contrastFn(),this.carMarker.moveTo(this.locusData[this.moveIndex],this.$parent.carInfoObj.speed)),t.playStatus="play"},pauesAnimation:function(){this.carMarker.stopMove(),this.$parent.carInfoObj.playStatus="pause"},stopAnimation:function(){this.$parent.carInfoObj.playStatus="stop",this.moveIndex=0,this.moveActiveData=null},clearMap:function(){this.gapdeMap.clearMap()},setFitView:function(){this.gapdeMap.setFitView(),this.gapdeMap.zoomOut()},resetPolyline:function(){this.stopAnimation(),this.clearMap(),this.createCarMarkerFn(),this.createLocusFn(),this.movingCarFn()},addLineClickFn:function(t){var a=this;a[t].on("click",function(t){for(var e=t.lnglat.lng,n=t.lnglat.lat,i=1e4,s=1e4,o=null,r=a.$parent.trackTableData.length-1;r>=0;r--){var l=a.$parent.trackTableData[r],c=Math.abs(e-l.longitude),p=Math.abs(n-l.latitude);c<i&&p<s&&(i=c,s=p,o=r)}null!==o&&a.openLineWindowFn(a.$parent.trackTableData[o])})},openLineWindowFn:function(t){var a=this;if(a.windowShow){var e=a.valueOfLicenseImg(t.licenseColor),n='<div class="map-box-window" style="min-height: 150px;"><div class="window-title"><div class="title-text"><div class="item-img-text" style="color: '+(4===t.licenseColor?"#000000":"#FFFFFF")+';">'+(t.licenseNum||"")+'</div><img src="'+e+'" alt=""></div></div><div class="window-box"><div class="window-row"><div class="row-item"><span class="item-title">'+a.$t("positionPage.time")+'：</span><span class="item-text">'+(t.positioningTime||"")+'</span></div><div class="row-item"><span class="item-title">'+a.$t("positionPage.speed")+'：</span><span class="item-text">'+(t.speed||0)+'km/h</span></div></div></div><div class="window-row"><div class="row-item"><span class="item-title">'+a.$t("positionPage.device_num")+'：</span><span class="item-text">'+(t.deviceNum||"")+'</span></div><div class="row-item"><span class="item-title">'+a.$t("positionPage.sim_no")+'：</span><span class="item-text">'+(t.phone||"")+'</span></div></div><div class="window-row"><div class="row-item"><span class="item-title">'+a.$t("positionPage.today_mileage")+'：</span><span class="item-text">'+(t.todayMileage||0)+'km</span></div><div class="row-item"><span class="item-title">'+a.$t("positionPage.mileage")+'：</span><span class="item-text">'+(t.mileage||0)+'km</span></div></div><div class="window-row"><div class="row-item"><span class="item-title">'+a.$t("positionPage.driving_direction")+'：</span><span class="item-text">'+(t.directionStr||"")+'</span></div><div class="row-item"><span class="item-title">'+a.$t("positionPage.platform_mileage")+'：</span><span class="item-text">'+(t.platformCurrentMileage||0)+'km</span></div></div><div class="window-row"><span class="item-title">'+a.$t("positionPage.location")+'：</span><span class="item-text">'+(t.location||'<span class="d-c">'+a.$t("positionPage.no_located")+"</span>")+"</span></div></div>";a.infoWindow?(a.infoWindow.setContent(n),a.infoWindow.setPosition(new o.a.LngLat(t.longitude,t.latitude))):(a.infoWindow=new o.a.InfoWindow({isCustom:!1,content:n,showShadow:!0,autoMove:!1,offset:new o.a.Pixel(0,-25)}),a.infoWindow.open(a.gapdeMap,new o.a.LngLat(t.longitude,t.latitude))),a.infoWindow.on("close",function(t){a.windowShow=!1,a.infoWindow=null})}},valueOfLicenseImg:function(t){var a="";switch(t){case 1:a=e("2QmI");break;case 2:a=e("rSXH");break;case 3:a=e("APGH");break;case 4:a=e("G+XG");break;case 9:a=e("xAz7");break;default:a=e("2QmI")}return a},setCarPath:function(t,a){var e=new o.a.LngLat(t.longitude,t.latitude);this.moveActiveData=e,this.carMarker.setPosition(e),this.moveIndex=a,"play"===this.$parent.carInfoObj.playStatus&&(this.carMarker.stopMove(),this.startAnimation(),this.$parent.carInfoObj.playStatus="pause")},getContainsPointFn:function(t){var a=this.gapdeMap.getBounds(),e=a.getNorthEast(),n=a.getSouthWest(),i=[e.lng,n.lat],s=[n.lng,e.lat];s=this.container2lnglat(this.lnglat2container(s)),n=this.container2lnglat(this.lnglat2container(n));var r=[[e.lng,e.lat],i,[n.lng,n.lat],s];!0!==o.a.GeometryUtil.isPointInRing(t,r)&&this.gapdeMap.panTo(t)},lnglat2container:function(t){var a=this.gapdeMap.lngLatToContainer(t);return(a=a.round()).x=a.x+380,a},container2lnglat:function(t){return this.gapdeMap.containerToLngLat(t)},graspRoadFn:function(t){var a=this,e=JSON.parse(i()(a.$parent.locusData)),n=a.graspRoadResetData(e);if(a.graspRoad&&n){var s=!0,o=0,r={};n.forEach(function(i){a.graspRoad.driving(i.data,function(a,l){o++,a&&(s=!1),l&&(r[i.index]=l.data.points),n.length===o&&(s||t(e))})})}else t(e)},graspRoadResetData:function(t){var a=[];if(t&&t.length)for(var e=Math.ceil(t.length/500),n=0;n<e;n++){var i=500*n,s=n===e-1?t.length:500*(n+1);a.push({index:n,startNum:i,endNum:s,data:t.slice(i,s)})}return a}}},l=(e("MIbw"),e("ZrdR")),c=Object(l.a)(r,function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"record-amap"},[e("div",{staticClass:"amap-page",attrs:{id:"amap-container"}}),t._v(" "),e("el-input",{staticClass:"map-search",attrs:{size:"small",clearable:"",placeholder:t.$t("trackPage.map_search"),"prefix-icon":"el-icon-search"},model:{value:t.searchValue,callback:function(a){t.searchValue=a},expression:"searchValue"}})],1)},[],!1,null,"ef6b3972",null);c.options.__file="record-amap.vue";a.default=c.exports},zr80:function(t,a,e){}}]);