(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-753a","YelX","YelX","YelX"],{"0yy0":function(e,t,i){"use strict";i.r(t);var a=i("unDg"),n=i.n(a),s=i("AlM9"),o=i("BHIJ"),r=i("XVnh"),l=i("YelX"),c={name:"SIMAdminister",components:{TableView:s.a,drawer:o.a,notPerm:r.a},mixins:[l.default],data:function(){return{isTable:!0,title:"",deviceList:[],drawerDisplay:!1,drawerData:{},alias:{pageSize:"pageSize",pageNum:"pageNum"},tableOptions:{data:[],total:0,checkDisabledOption:[{key:"status",value:1}],columns:[{type:"slot",name:"number",title:this.$t("view.index")},{title:this.$t("simPage.sim_num"),key:"simNum",type:"text"},{title:this.$t("simPage.operator"),key:"operator",type:"text"},{title:this.$t("simPage.k_type"),key:"status",type:"tagText",tags:[{value:1,text:this.$t("simPage.k_type_1")},{value:0,text:this.$t("simPage.k_type_2"),option:{type:"warning"}}]},{title:this.$t("simPage.licenseNum"),key:"licenseNum",type:"text"},{title:this.$t("simPage.deviceNum"),key:"deviceNum",type:"text"},{title:this.$t("simPage.companyName"),key:"companyName",type:"text"},{title:this.$t("simPage.timeoutAt"),key:"timeoutAt",type:"text"},{title:this.$t("simPage.packageFlow"),key:"packageFlow",type:"text"},{title:this.$t("simPage.useFlow"),key:"useFlow",type:"text"},{title:this.$t("simPage.city"),key:"city",type:"text"},{title:this.$t("operation.operation"),type:"operate",key:"operate",fixed:"right",width:"120px",buttons:[]}],buttonControls:[],searchControls:[{type:"input",key:"deviceNum",placeholder:this.$t("simPage.deviceNum"),width:"200px"},{type:"input",key:"simNum",placeholder:this.$t("simPage.sim_num"),width:"200px"},{type:"select",key:"status",placeholder:this.$t("simPage.k_type"),width:"160px",clearable:!0,options:[{name:this.$t("simPage.k_type_1"),value:1},{name:this.$t("simPage.k_type_2"),value:0}]},{type:"treeSelect",key:"companyIds",valueKey:"companyId",placeholder:this.$t("view.searchControl_company"),width:"200px",clearable:!0,treeOption:{defaultProps:{children:"sysCompanyNodes",label:"name"},nodeKey:"companyId",defaultExpandAll:!1,expandClickNode:!1,checkbox:!0,screenFn:{bindFn:function(e,t){return!e||-1!==t.name.indexOf(e)}}},treeDefinedData:[]}],footerButtons:[],paginationLayout:"total, sizes, prev, pager, next, jumper",loading:!1},companyTreeData:[],params:null}},computed:{},created:function(){this.getCompanyTreeDataFn()},mounted:function(){},methods:{handlePermissionShow:function(){this.tableOptions.buttonControls=[],this.isPermissionShow("simCreate")&&this.tableOptions.buttonControls.push({text:this.$t("simPage.sim_add"),type:"primary",icon:"el-icon-plus",funcName:"increase"}),this.isPermissionShow("simCreate")&&this.tableOptions.buttonControls.push({text:this.$t("operation.export_import"),type:"null",size:"mini",icon:"el-icon-folder-opened",funcName:"batchExportFn"}),this.isPermissionShow("simExport")&&this.tableOptions.buttonControls.push({text:this.$t("operation.export_record"),type:"null",icon:"el-icon-download",funcName:"export",dataStatus:!0}),this.tableOptions.footerButtons=[],this.isPermissionShow("simDelete")&&this.tableOptions.footerButtons.push({text:this.$t("operation.delete"),type:"danger",size:"small",icon:"el-icon-delete",round:!1,funcName:"delete"});var e=this.tableOptions.columns.findIndex(function(e){return"operate"===e.key});this.tableOptions.columns[e].buttons=[],e>-1&&this.isPermissionShow("simList")&&this.tableOptions.columns[e].buttons.push({tipText:this.$t("operation.detail"),icon:"iconfont Jamin_vehicle_ico_xq",type:"text",funcName:"detail"}),e>-1&&this.isPermissionShow("simUpdate")&&this.tableOptions.columns[e].buttons.push({tipText:this.$t("operation.edit"),icon:"iconfont Jamin_vehicle_icon_bj",type:"text",funcName:"edit"})},getCompanyTreeDataFn:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$http.get("/company/treeList/SIMAdminister").then(function(i){i.code===e.$config.API_STATUS.OK&&(e.companyTreeData=i.data,e.tableOptions.searchControls[3].treeDefinedData=e.companyTreeData,t&&(e.isTable=!1,e.$nextTick(function(){e.isTable=!0})))})},resetTreeDataFn:function(){this.getCompanyTreeDataFn(!1)},getTableData:function(e){var t=this;this.tableOptions.loading=!0;var i={deviceNum:e.deviceNum,simNum:e.simNum,status:e.status,companyIds:e.companyIds?JSON.parse(e.companyIds):[]};this.$http.post("/sim/list?pageNum="+e.pageNum+"&pageSize="+e.pageSize,i).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.tableOptions.loading=!1,t.tableOptions.data=e.data.list,t.tableOptions.total=e.data.total)}),this.params=e},newDevice:function(){var e=this;this.deviceList=[],this.$http.get("/device/list/sim/all").then(function(t){t.code===e.$config.API_STATUS.OK&&(e.deviceList=t.data,e.forResetDevTreeFn(e.deviceList),e.drawerDisplay=!0,e.increaseData())})},oldDevice:function(e){var t=this;this.deviceList=[],this.$http.get("/device/list/sim/all").then(function(i){i.code===t.$config.API_STATUS.OK&&(t.deviceList=i.data,t.forResetDevTreeFn(t.deviceList),t.drawerDisplay=!0,"编辑"===t.title?t.editData(e):t.detailData(e))})},forResetDevTreeFn:function(e){var t=this;e.forEach(function(e){e.children=[].concat(n()(e.deviceInfos?e.deviceInfos:[]),n()(e.sysCompanyNodes?e.sysCompanyNodes:[])),e.children.length&&t.forResetDevTreeFn(e.children),e.deviceId?(e.treeId="d_"+e.deviceId,e.treeName=e.deviceNum):(e.treeId="c_"+e.companyId,e.treeName=e.name)})},tableResponseFn:function(e,t,i){this[t.funcName].call(function(){},e,t,i)},increase:function(e){this.newDevice()},increaseData:function(){this.drawerData={isShow:!0,title:this.$t("simPage.sim_add"),titleWidth:"150",data:{},defaultData:"",submitAction:"/sim/create",btnAlign:"center",formList:[{title:this.$t("simPage.owned_company"),type:"treeSelect",key:"companyId",valueKey:"companyId",offsetWidth:"320",treeOption:{defaultProps:{children:"sysCompanyNodes",label:"name"},nodeKey:"companyId",defaultExpandAll:!1,expandClickNode:!1,screenFn:{bindFn:function(e,t){return!e||-1!==t.name.indexOf(e)}}},treeDefinedData:this.companyTreeData,rules:[{required:!0,message:this.$t("simPage.owned_company_rule"),trigger:"change"}]},{title:this.$t("simPage.sim_num"),type:"input",key:"simNum",offsetWidth:"320",rules:[{required:!0,message:this.$t("simPage.sim_num_rule"),trigger:"blur"}]},{title:this.$t("simPage.iccid"),type:"input",offsetWidth:"320",key:"iccid"},{title:this.$t("simPage.operator"),type:"input",offsetWidth:"320",key:"operator"},{title:this.$t("simPage.city"),type:"input",offsetWidth:"320",key:"city"},{title:this.$t("simPage.package_flow"),type:"input",offsetWidth:"320",key:"packageFlow"},{title:this.$t("simPage.bind_device"),type:"treeSelect",key:"deviceId",valueKey:"deviceId",offsetWidth:"320",treeOption:{defaultProps:{children:"children",label:"treeName"},nodeKey:"treeId",nodeCode:"iconfont Jamin_icon_shebei",defaultExpandAll:!1,expandClickNode:!1,screenFn:{bindFn:function(e,t){return!e||-1!==t.treeName.indexOf(e)}}},treeDefinedData:this.deviceList},{title:this.$t("simPage.remark"),type:"input",offsetWidth:"320",key:"remark"}],formButton:[{name:this.$t("confirm.determine"),type:"confirm",class:"primary"},{name:this.$t("confirm.cancel"),type:"cancel",class:""}],message:{type:"success",message:this.$t("confirm.message")}}},batchExportFn:function(){var e=this;this.drawerData={isShow:!0,title:this.$t("operation.export_import"),titleWidth:"120",data:{},defaultData:"",submitAction:"/sim/import/{companyId}",btnAlign:"center",formList:[{title:this.$t("simPage.owned_company"),type:"treeSelect",key:"companyId",valueKey:"companyId",placeholder:this.$t("simPage.check_company"),offsetWidth:"320",treeOption:{defaultProps:{children:"sysCompanyNodes",label:"name"},nodeKey:"companyId",defaultExpandAll:!1,expandClickNode:!1,screenFn:{bindFn:function(e,t){return!e||-1!==t.name.indexOf(e)}}},treeDefinedData:this.companyTreeData,rules:[{required:!0,message:this.$t("simPage.owned_company_rule"),trigger:"change"}],handlerCallback:{target:"clickFunction",funcName:"companyIdChange"}},{title:this.$t("operation.uploadFile"),type:"upload",ref:"_template_file",key:"file",action:"/sim/import/{companyId}",headers:{Authorization:this.$store.getters.userData.tokenHead+this.$store.getters.userData.token},offsetWidth:"320",autoUpload:!1,iconRight:"true",multiple:!1,limit:1,accept:"application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",text:this.$t("operation.uploadFile_placeholder"),buttonType:"primary",tip:this.$t("operation.uploadFile_tip"),templateUrl:"/static/excel/sim-template-CN.xlsx",rules:[{required:!0,message:"请上传Excel表",trigger:"blur"}],beforeUpload:function(t){if(t.size>5242880)return e.$message.error(e.$t("operation.uploadFile_tip_err")),!1},onChange:function(t,i){e.$set(e.$refs._drawer.formData,"file",t.raw)},onSuccess:function(t,i,a){t.code===e.$config.API_STATUS.OK?(e.$message.success(e.$t("operation.export_import_confirm")),e.diaClose(!0)):(e.$message.error(t.message),e.$refs._drawer.$refs._template_file[0].clearFiles())}}],formButton:[{name:this.$t("confirm.determine"),type:"customize",class:"primary"},{name:this.$t("confirm.cancel"),type:"cancel",class:""}],message:{type:"success",message:this.$t("operation.export_import_confirm")}},this.drawerDisplay=!0},companyIdChange:function(e){this.$refs._drawer.drawerData.formList[1].action=this.$config.API_CONFIG.API_ROOT+"/sim/import/"+e},drawerCustomizeFn:function(e,t){var i=this;this.$refs._drawer.$refs.formData.validate(function(e){if(!e)return!1;i.$refs._drawer.$refs._template_file[0].submit()})},delete:function(e){var t=this;this.$confirm(this.$t("confirm.del"),this.$t("confirm.title"),{confirmButtonText:this.$t("confirm.determine"),cancelButtonText:this.$t("confirm.cancel"),type:"warning"}).then(function(){var i=[];e.forEach(function(e,t){i[t]=e.simId}),t.$http.deleteApi("/sim/delete",{ids:i.join(","),isLoading:!0}).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.$refs.table.initRequestTableData(),t.$message({message:e.message,type:"success"}))})})},edit:function(e){this.title="编辑",this.oldDevice(e)},editData:function(e){this.drawerData={staticData:e,isShow:!0,title:this.$t("simPage.form_edit_title"),titleWidth:"120",data:{},defaultData:"",submitAction:"/sim/update/"+e.simId,btnAlign:"center",formList:[{title:this.$t("simPage.owned_company"),type:"treeSelect",key:"companyId",valueKey:"companyId",label:e.companyName,offsetWidth:"320",treeOption:{defaultProps:{children:"sysCompanyNodes",label:"name"},nodeKey:"companyId",defaultExpandAll:!1,expandClickNode:!1,screenFn:{bindFn:function(e,t){return!e||-1!==t.name.indexOf(e)}}},treeDefinedData:this.companyTreeData,rules:[{required:!0,message:this.$t("simPage.owned_company_rule"),trigger:"change"}],disabled:!0,disabledCondition:{state:!0,condition:function(e){return!!(0!==e.status||e.deviceNum&&e.licenseNum)}}},{title:this.$t("simPage.sim_num"),type:"input",offsetWidth:"320",key:"simNum",disabled:!0},{title:this.$t("simPage.iccid"),type:"input",offsetWidth:"320",key:"iccid"},{title:this.$t("simPage.operator"),type:"input",offsetWidth:"320",key:"operator"},{title:this.$t("simPage.city"),type:"input",offsetWidth:"320",key:"city"},{title:this.$t("simPage.package_flow"),type:"input",offsetWidth:"320",key:"packageFlow"},{title:this.$t("simPage.bind_device"),type:"treeSelect",key:"deviceId",valueKey:"deviceId",placeholder:this.$t("simPage.bind_device_placeholder"),offsetWidth:"320",label:e.deviceNum,treeOption:{defaultProps:{children:"children",label:"treeName"},nodeKey:"treeId",nodeCode:"iconfont Jamin_icon_shebei",defaultExpandAll:!1,expandClickNode:!1,screenFn:{bindFn:function(e,t){return!e||-1!==t.treeName.indexOf(e)}}},treeDefinedData:this.deviceList},{title:this.$t("simPage.remark"),type:"input",offsetWidth:"320",key:"remark"}],formButton:[{name:this.$t("confirm.determine"),type:"confirm",class:"primary"},{name:this.$t("confirm.cancel"),type:"cancel",class:""}],message:{type:"success",message:this.$t("confirm.editSuccess")}}},detail:function(e){this.title="详情",this.oldDevice(e)},detailData:function(e){this.drawerData={staticData:e,isShow:!0,title:this.$t("simPage.detail_title"),titleWidth:"120",data:{},defaultData:"",btnAlign:"center",formList:[{title:this.$t("simPage.sim_num"),type:"text",key:"simNum"},{title:this.$t("simPage.iccid"),type:"text",key:"iccid"},{title:this.$t("simPage.operator"),type:"text",key:"operator",offsetWidth:"320"},{title:this.$t("simPage.k_type"),type:"textSelect",key:"status",offsetWidth:"320",list:[{name:this.$t("simPage.k_type_1"),value:1},{name:this.$t("simPage.k_type_2"),value:0}]},{title:this.$t("simPage.city"),type:"text",key:"city"},{title:this.$t("simPage.package_flow"),type:"text",key:"packageFlow"},{title:this.$t("simPage.bind_device"),type:"text",key:"deviceNum"},{title:this.$t("simPage.remark"),type:"text",key:"remark"}]}},export:function(){var e=this;this.$confirm(this.$t("confirm.export"),this.$t("confirm.title"),{confirmButtonText:this.$t("confirm.determine"),cancelButtonText:this.$t("confirm.cancel"),type:"warning",closeOnClickModal:!1,beforeClose:function(t,i,a){e.fieldMap={},e.tableOptions.columns.forEach(function(t){e.$refs.table.columnCheckList.forEach(function(i){t.key===i&&"operate"!==t.key&&(e.fieldMap[i]=t.title)})});var n=e.params,s=n.deviceNum,o=n.simNum,r=n.status,l=n.companyIds;if("confirm"===t){var c={fieldMap:e.fieldMap,deviceNum:s,simNum:o,status:r,companyIds:l?JSON.parse(l):null};e.tableOptions.total<e.$store.getters.userData.realtimeVideoUrl?e.$http.download("/sim/export?isToken=true",c):e.$http.post("/sim/export/async",c),a()}else a()}}).catch(function(){})},diaClose:function(e){e&&this.$refs.table.initRequestTableData(),this.drawerDisplay=!1},drawerCallback:function(e,t,i,a){this[e.handlerCallback.funcName].call(function(){},t,i,a)}}},d=(i("qeU3"),i("ZrdR")),p=Object(d.a)(c,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"page-wrap"},[e.isTable&&e.isPermissionShow("simList")?i("table-view",{ref:"table",attrs:{center:"","id-key":"simId","is-search":!0,"check-memory":!0,data:e.tableOptions.data,total:e.tableOptions.total,columns:e.tableOptions.columns,"search-controls":e.tableOptions.searchControls,"footer-buttons":e.tableOptions.footerButtons,"button-controls":e.tableOptions.buttonControls,"pagination-layout":e.tableOptions.paginationLayout,loading:e.tableOptions.loading,"check-disabled-option":e.tableOptions.checkDisabledOption,checked:"","is-shadow":"","column-view":"",alias:e.alias},on:{requestTableData:e.getTableData,handleCallback:e.tableResponseFn}},[i("el-table-column",{attrs:{slot:"number",label:e.$t("view.index"),type:"index",align:"center"},slot:"number"})],1):e._e(),e._v(" "),e.isPermissionShow("simList")||e.$store.state.app.permsDataLoading?e._e():i("notPerm"),e._v(" "),e.drawerDisplay?i("drawer",{ref:"_drawer",attrs:{size:"small","drawer-data":e.drawerData},on:{diaClose:e.diaClose,handlerCallback:e.drawerCallback,handleCallback:e.drawerCustomizeFn}}):e._e()],1)},[],!1,null,"4f9b33e4",null);p.options.__file="SIMAdminister.vue";t.default=p.exports},YelX:function(e,t,i){"use strict";i.r(t);var a=i("bS4n"),n=i.n(a),s=i("8t5x");t.default={data:function(){return{permissionList:{vehicleUpdate:"/vehicle/update/**",vehicleExport:"/vehicle/export",vehicleDelete:"/vehicle/delete",vehicleList:"/vehicle/list",vehicleCreate:"/vehicle/create",vehicleFastCreate:"/vehicle/fastCreate",vehicleMotorcadeCreate:"/vehicle/motorcade/create",vehicleMotorcadeUpdate:"/vehicle/motorcade/update",vehicleMotorcadeDelete:"/vehicle/motorcade/delete/**",companyList:"/company/list",companyCreate:"/company/create",companyExport:"/company/export",companyDetail:"/company/**",companyUpdate:"/company/update/**",companyPersonalization:"/company/personalization/**",companyDelete:"/company/delete",driverList:"/driver/list",driverCreate:"/driver/create",driverDetail:"/driver/get/**",driverUpdate:"/driver/update/**",driverDelete:"/driver/delete",driverExport:"/driver/export",labelList:"/label/list",labelCreate:"/label/create",labelUpdate:"/label/update/**",labelDelete:"/label/delete",labelExport:"/label/export",regionList:"/region/list",regionCreate:"/region/create",regionUpdate:"/region/update/**",regionDelete:"/region/delete",regionExport:"/region/export",routeList:"/route/list",routeCreate:"/route/create",routeUpdate:"/route/update/**",routeDelete:"/route/delete",routeExport:"/route/export",adminList:"/admin/list",adminCreate:"/admin/create",adminUpdate:"/admin/update/**",adminDelete:"/admin/delete",adminExport:"/admin/export",typeCreate:"/ef/type/create",typeUpdate:"/ef/type/update/**",typeDelete:"/ef/type/delete/**",drivingLicenseList:"/driving/license/list",drivingLicenseCreate:"/driving/license/create",drivingLicenseUpdate:"/driving/license/update/**",drivingLicenseDelete:"/driving/license/delete",drivingLicense:"/driving/license/export",transportList:"/transport/list",transportCreate:"/transport/create",transportUpdate:"/transport/update/**",transportDelete:"/transport/delete",transportExport:"/transport/export",maintainList:"/maintain/list",maintainCreate:"/maintain/create",maintainUpdate:"/maintain/update/**",maintainDelete:"/maintain/delete",maintainExport:"/maintain/export",insuranceList:"/insurance/list",insuranceCreate:"/insurance/create",insuranceUpdate:"/insurance/update/**",insuranceDelete:"/insurance/delete",insuranceExport:"/insurance/export",insuranceListAdvance:"/insurance/list/advance",annualList:"/annual/list",annualCreate:"/annual/create",annualUpdate:"/annual/update/**",annualDelete:"/annual/delete",annualExport:"/annual/export",annualListAdvance:"/annual/list/advance",repairList:"/repair/list",repairCreate:"/repair/create",repairUpdate:"/repair/update/**",repairDelete:"/repair/delete",repairExport:"/repair/export",accidentList:"/accident/list",accidentCreate:"/accident/create",accidentUpdate:"/accident/update/**",accidentDelete:"/accident/delete",accidentExport:"/accident/export",simList:"/sim/list",simCreate:"/sim/create",simUpdate:"/sim/update/**",simDelete:"/sim/delete",simExport:"/sim/export"}}},computed:n()({},Object(s.b)(["permsData"]),{isAdministrator:function(){return[-1,-2].includes(Number(this.$store.getters.userData.userType))}}),watch:{permsData:{handler:function(){this.handlePermissionShow&&this.handlePermissionShow()},immediate:!0}},methods:{isPermissionShow:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!!this.isAdministrator||this.permsData.includes(this.permissionList[e])}}}},glS0:function(e,t,i){},jcYt:function(e,t,i){e.exports=i.p+"static/img/not-perm.d97c442.png"},qeU3:function(e,t,i){"use strict";var a=i("glS0");i.n(a).a}}]);