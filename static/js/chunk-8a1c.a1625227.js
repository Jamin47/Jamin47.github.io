(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-8a1c","iCa3"],{UFzP:function(e,t,i){},iCa3:function(e,t,i){"use strict";i.r(t);var a=i("bS4n"),o=i.n(a),l=i("8t5x");t.default={data:function(){return{permissionList:{postionLocusVehicleAllTreeList:"/postion/locus/vehicleAllTreeList",postionRecordsReplaysVehicleAllTreeList:"/postion/recordsReplays/vehicleAllTreeList",videotapeReplaysVehicleAllTreeLis:"/postion/videotapeReplays/vehicleAllTreeList",videotapeReplaysVehicleStatistics:"/postion/videotapeReplays/vehicleStatistics",playbackFileList:"/playback/file/list",postionVideotapeFile:"/postion/videotapeFile/vehicleAllTreeList",playbackFileUpload:"/playback/file/upload",playbackFileDownload:"1"}}},computed:o()({},Object(l.b)(["permsData"]),{isAdministrator:function(){return[-1,-2].includes(Number(this.$store.getters.userData.userType))}}),watch:{permsData:{handler:function(){this.handlePermissionShow&&this.handlePermissionShow()},immediate:!0}},methods:{isPermissionShow:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!!this.isAdministrator||this.permsData.includes(this.permissionList[e])}}}},jcYt:function(e,t,i){e.exports=i.p+"static/img/not-perm.d97c442.png"},u1bN:function(e,t,i){"use strict";var a=i("UFzP");i.n(a).a},zZJc:function(e,t,i){"use strict";i.r(t);var a=i("unDg"),o=i.n(a),l=i("AlM9"),n=i("yH6C"),s=i("XVnh"),r=i("iCa3"),d=i("MfIo"),c=i("pRWq"),p=i.n(c),u={name:"DriverAdminister",components:{TableView:l.a,uTableView:n.a,notPerm:s.a},mixins:[r.default],data:function(){return{drawerDisplay:!1,alias:{pageSize:"pageSize",pageNum:"pageNum"},isTable:!0,tableOptions:{data:[],total:0,columns:[{title:this.$t("view.license_num"),key:"licenseNum",type:"text",width:"150"},{title:this.$t("videoFilePage.motorcade_name"),key:"motorcadeName",type:"text",minWidth:"150"},{title:this.$t("videoFilePage.total"),key:"totalNum",type:"text"},{title:this.$t("videoFilePage.file_size"),key:"totalSizeView",type:"text"},{title:this.$t("videoFilePage.file_time"),key:"totalTimeView",type:"text"},{title:this.$t("videoFilePage.location"),key:"location",minWidth:"120",type:"tagText",tags:[{value:0,text:this.$t("videoFilePage.location_1")},{value:1,text:this.$t("videoFilePage.location_2")}]},{title:this.$t("videoFilePage.query_results"),key:"onlineStatus",minWidth:"120",type:"tagText",tags:[{value:1,text:this.$t("videoFilePage.query_results_1")},{value:0,text:this.$t("videoFilePage.query_results_2"),option:{type:"danger"}}]},{title:this.$t("operation.operation"),type:"operate",key:"operate",fixed:"right",width:"150",buttons:[{text:this.$t("videoFilePage.info"),type:"text",size:"mini",funcName:"openInfoFn"}]}],buttonControls:[],searchControls:[{type:"treeSelect",key:"vehicleIds",valueKey:"vehicleId",placeholder:this.$t("videoFilePage.search_vehicle"),width:"180px",clearable:!0,treeOption:{defaultProps:{children:"children",label:"treeName"},nodeKey:"treeId",nodeCode:"iconfont Jamin_vehicle_icon_clgl1",defaultExpandAll:!1,expandClickNode:!1,checkbox:!0,screenFn:{bindFn:function(e,t){return!e||-1!==t.treeName.indexOf(e)}}},treeDefinedData:[]},{type:"treeSelect",key:"alarmType",valueKey:"typeCode",placeholder:this.$t("videoFilePage.alarm_type"),width:"180px",clearable:!0,treeOption:{defaultProps:{children:"children",label:"typeName"},nodeKey:"typeCode",defaultExpandAll:!1,expandClickNode:!1,checkbox:!0,screenFn:{bindFn:function(e,t){return!e||-1!==t.typeName.indexOf(e)}}},treeDefinedData:[]},{type:"select",key:"location",placeholder:this.$t("videoFilePage.location"),width:"180px",size:"small",clearable:!0,value:1,options:[{name:this.$t("videoFilePage.location_1"),value:0},{name:this.$t("videoFilePage.location_2"),value:1}]},{type:"select",key:"fileType",placeholder:this.$t("videoFilePage.file_type"),width:"180px",size:"small",clearable:!0,value:1,options:[{name:this.$t("videoFilePage.file_type_1"),value:1},{name:this.$t("videoFilePage.file_type_2"),value:2},{name:this.$t("videoFilePage.file_type_3"),value:3}]},{type:"datetimerange",key:"time",startPlaceholder:this.$t("view.start_time"),endPlaceholder:this.$t("view.end_time"),width:"360px",size:"small"}],searchMode:"immediate",footerButtons:[],paginationLayout:"total, sizes, prev, pager, next, jumper",loading:!1},infoTableOptions:{data:[],total:0,columns:[{title:this.$t("view.license_num"),key:"licenseNum",type:"text"},{title:this.$t("videoFilePage.channel_number"),key:"channelNum",type:"text"},{title:this.$t("videoFilePage.channel_name"),key:"channelName",type:"text"},{title:this.$t("view.start_time"),key:"startTime",type:"text"},{title:this.$t("view.end_time"),key:"endTime",type:"text"},{title:this.$t("videoFilePage.file_size"),key:"videoSizeView",type:"text"},{title:this.$t("videoFilePage.file_time"),key:"videoDurationView",type:"text"},{title:this.$t("videoFilePage.resource_type"),key:"resourceType",type:"tag",tags:[{value:0,text:this.$t("videoFilePage.resource_type_1")},{value:1,text:this.$t("videoFilePage.resource_type_2")},{value:2,text:this.$t("videoFilePage.resource_type_3")},{value:3,text:this.$t("videoFilePage.resource_type_4")}]},{title:this.$t("videoFilePage.stream_type"),key:"streamType",type:"tag",tags:[{value:0,text:this.$t("videoFilePage.stream_type_1")},{value:1,text:this.$t("videoFilePage.stream_type_2")},{value:2,text:this.$t("videoFilePage.stream_type_3")}]},{title:this.$t("videoFilePage.storage_type"),key:"storageType",type:"tag",tags:[{value:0,text:this.$t("videoFilePage.storage_type_1")},{value:1,text:this.$t("videoFilePage.storage_type_2")},{value:2,text:this.$t("videoFilePage.storage_type_3")}]},{title:this.$t("videoFilePage.location"),key:"location",type:"tag",tags:[{value:0,text:this.$t("videoFilePage.location_1")},{value:1,text:this.$t("videoFilePage.location_2")}]},{title:this.$t("operation.operation"),type:"operate",key:"operate",fixed:"right",width:"150",buttons:[]}],buttonControls:[],searchControls:[],searchMode:"immediate",footerButtons:[],paginationLayout:"total, sizes, prev, pager, next, jumper",loading:!1},dialogOption:{isShow:!1,data:null,title:""},playData:{flvPlayer:null,url:"",isPlay:!0,isMuted:!0}}},computed:{},created:function(){this.getSelectDataFn()},mounted:function(){},methods:{handlePermissionShow:function(){var e=this.infoTableOptions.columns.findIndex(function(e){return"operate"===e.key});e>-1&&(this.infoTableOptions.columns[e].buttons=[],this.infoTableOptions.columns[e].buttons.push({text:this.$t("operation.play"),type:"text",funcName:"playFn",condition:{key:"location",value:0}})),e>-1&&this.isPermissionShow("playbackFileUpload")&&this.infoTableOptions.columns[e].buttons.push({text:this.$t("operation.upload"),type:"text",funcName:"uploadFn",condition:{key:"location",value:0}}),e>-1&&this.isPermissionShow("playbackFileDownload")&&this.infoTableOptions.columns[e].buttons.push({text:this.$t("operation.download"),type:"text",funcName:"downloadFn",condition:{key:"location",value:1}})},getTableData:function(e){var t=this,i=Object(d.d)(new Date,"yyyy-MM-dd");e.time?(e.startTime=e.time[0],e.endTime=e.time[1]):(e.startTime=i+" 00:00:00",e.endTime=i+" 23:59:59",this.$nextTick(function(){t.$set(t.$refs._table.searchParams,"time",[e.startTime,e.endTime])})),delete e.time,e.vehicleIds&&(this.tableOptions.loading=!0,e.vehicleIds=JSON.parse(e.vehicleIds),e.alarmType=e.alarmType?JSON.parse(e.alarmType):[],this.$http.post("/playback/file/list?pageNum="+e.pageNum+"&pageSize="+e.pageSize,e).then(function(e){e.code===t.$config.API_STATUS.OK&&(e.data.list.forEach(function(e){e.totalSizeView=t.formatSize(e.totalSize),e.totalTimeView=t.formatTime(e.totalTime),e.deviceFileDetails&&e.deviceFileDetails.length&&e.deviceFileDetails.forEach(function(e){e.videoSizeView=t.formatSize(e.videoSize),e.videoDurationView=t.formatTime(e.videoDuration)})}),t.tableOptions.data=e.data.list,t.tableOptions.total=e.data.total),t.tableOptions.loading=!1}))},formatTime:function(e){var t=Math.floor(e/1e3),i=Math.floor(t/3600),a=Math.floor((t-3600*i)/60),o=t-3600*i-60*a;return this.padLeftZero(i)+":"+this.padLeftZero(a)+":"+this.padLeftZero(o)},padLeftZero:function(e){return e.toString().length>1?e:"0"+e},formatSize:function(e){var t="";return e&&e>1024&&(t=(e/1024).toFixed(2)+"KB"),e&&e>1048576&&(t=(e/1024/1024).toFixed(2)+"MB"),t||"0KB"},tableResponseFn:function(e,t,i){this[t.funcName].call(function(){},e,t,i)},getSelectDataFn:function(){var e=this;this.$http.axios.all([this.$http.get("/postion/videotapeFile/vehicleAllTreeList"),this.$http.get("/alarm/setting/type/list",{alarmType:2})]).then(this.$http.axios.spread(function(t,i){t.code===e.$config.API_STATUS.OK&&(e.forTreeResetDataFn(t.data.motorcades),e.tableOptions.searchControls[0].treeDefinedData=t.data.motorcades),i.code===e.$config.API_STATUS.OK&&(e.tableOptions.searchControls[1].treeDefinedData=i.data),e.isTable=!1,e.$nextTick(function(){e.isTable=!0})}))},forTreeResetDataFn:function(e){var t=this;e.forEach(function(e){e.vehicleId?(e.treeName=e.licenseNum,e.treeId="v_"+e.vehicleId,e.lezy=!0):(e.treeName=e.motorcadeName,e.treeId="m_"+e.motorcadeId,e.children=[].concat(o()(e.vehicles),o()(e.motorcades)),t.forTreeResetDataFn(e.children))})},openInfoFn:function(e){this.drawerDisplay=!0,e.deviceFileDetails&&e.deviceFileDetails.length>0?this.infoTableOptions.data=e.deviceFileDetails:this.infoTableOptions.data=[]},playFn:function(e){var t=this;1===e.location&&e.filePath?(this.dialogOption.isShow=!0,this.dialogOption.data=e,this.dialogOption.title=e.licenseNum+"_"+e.channelName+" [ "+e.startTime+"<--\x3e"+e.endTime+" ]",this.playData.url=e.filePath):(this.destroyVideo(this.playData),this.$http.post("/playback/video/play",{channelNum:e.channelNum,simNum:e.simNum,startTime:e.startTime,endTime:e.endTime,resourceType:e.resourceType,streamType:e.streamType,storageType:e.storageType}).then(function(i){i.code===t.$config.API_STATUS.OK&&(i.data?(t.dialogOption.isShow=!0,t.dialogOption.data=e,t.dialogOption.title=e.licenseNum+"_"+e.channelName+" [ "+e.startTime+"<--\x3e"+e.endTime+" ]",t.playData.url=i.data,t.createVideo(t.playData)):t.$message.warning(t.$t("videoFilePage.message_1")))}))},createVideo:function(e){var t=this;if(p.a.isSupported()){this.$nextTick(function(){var i=document.getElementById("_video_id");e.flvPlayer=p.a.createPlayer({type:"flv",url:e.url+"?username="+t.$store.getters.userData.username+"&videoType=2&userLevel="+(t.$config.API_CONFIG.userLevel||1),isLive:!0,enableStashBuffer:!0,stashInitialSize:128,autoCleanupSourceBuffer:!0,autoCleanupMaxBackwardDuration:5,autoCleanupMinBackwardDuration:1,lazyLoadMaxDuration:5}),e.flvPlayer.attachMediaElement(i),e.flvPlayer.load(),e.flvPlayer.play(),e.flvPlayer.on(p.a.Events.ERROR,function(i,a,o){t.destroyVideo(e)})})}else this.$message.error(this.$t("videoFilePage.message_2"))},destroyVideo:function(e){e&&e.flvPlayer&&(e.flvPlayer.pause(),e.flvPlayer.unload(),e.flvPlayer.detachMediaElement(),e.flvPlayer.destroy(),e.flvPlayer=null)},videoPlayFn:function(){this.playData.flvPlayer.play(),this.playData.isPlay=!0},videoStopFn:function(){this.playData.flvPlayer.pause(),this.playData.isPlay=!1},captureVideoFn:function(){Object(d.a)("_video_id")},fullscreenVideoFn:function(){var e=Object(d.f)();e.fullscreenEnabled&&document.querySelector("#_video_id")[""===e.prefixName?"requestFullscreen":e.prefixName+"RequestFullScreen"]()},uploadFn:function(e){var t=this;this.$confirm(this.$t("confirm.content"),this.$t("confirm.title"),{confirmButtonText:this.$t("confirm.determine"),cancelButtonText:this.$t("confirm.cancel")}).then(function(){t.$http.post("/playback/file/upload",{simNum:e.simNum,resourceType:e.resourceType,streamType:e.streamType,storageType:e.storageType,alarmType:e.alarmType,channelId:e.channelId,startTime:e.startTime,endTime:e.endTime,channelNum:e.channelNum,licenseNum:e.licenseNum,channelName:e.channelName,videoDuration:e.videoDuration,videoSize:e.videoSize,vehicleId:e.vehicleId}).then(function(e){e.code===t.$config.API_STATUS.OK&&t.$message.success(t.$t("message.success"))})})},downloadFn:function(e){var t=this.$config.API_CONFIG.DOWNLOAD_ADDRESS+e.filePath,i=t.split("/");this.downloadUrlFn(t,i[i.length-1])},downloadUrlFn:function(e,t){var i=document.createElement("a");i.href=e,i.setAttribute("download",t),document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(i.href)}}},h=(i("u1bN"),i("ZrdR")),m=Object(h.a)(u,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"page-wrap"},[e.isPermissionShow("playbackFileList")?[e.isTable?i("table-view",{ref:"_table",attrs:{center:"","id-key":"id","is-search":!0,data:e.tableOptions.data,total:e.tableOptions.total,columns:e.tableOptions.columns,"search-controls":e.tableOptions.searchControls,"footer-buttons":e.tableOptions.footerButtons,"button-controls":e.tableOptions.buttonControls,"pagination-layout":e.tableOptions.paginationLayout,loading:e.tableOptions.loading,"column-view":"","is-shadow":"",alias:e.alias},on:{requestTableData:e.getTableData,handleCallback:e.tableResponseFn}}):e._e(),e._v(" "),i("el-drawer",{attrs:{title:e.$t("videoFilePage.file_drawer_title"),visible:e.drawerDisplay,direction:"btt",size:"400px","wrapper-closable":!1},on:{"update:visible":function(t){e.drawerDisplay=t}}},[i("div",{staticClass:"drawer-table"},[i("uTableView",{ref:"_table_2",attrs:{center:"","id-key":"id","is-search":!1,data:e.infoTableOptions.data,total:e.infoTableOptions.total,columns:e.infoTableOptions.columns,"table-height":320,"search-controls":e.infoTableOptions.searchControls,"footer-buttons":e.infoTableOptions.footerButtons,"button-controls":e.infoTableOptions.buttonControls,"pagination-layout":e.infoTableOptions.paginationLayout,loading:e.infoTableOptions.loading,"view-table-key":"videotapeFileInfo","is-border":"",alias:e.alias},on:{handleCallback:e.tableResponseFn}})],1)]),e._v(" "),i("el-dialog",{attrs:{title:e.dialogOption.title,visible:e.dialogOption.isShow,width:"800px"},on:{"update:visible":function(t){e.$set(e.dialogOption,"isShow",t)},close:function(t){e.destroyVideo(e.playData)}}},[i("div",{staticClass:"dialog-video"},[e.dialogOption.data&&1===e.dialogOption.data.location&&e.dialogOption.data.filePath?i("video",{attrs:{src:e.playData.url,autoplay:"",type:"video/mp4"},domProps:{muted:e.playData.isMuted}}):i("video",{attrs:{id:"_video_id",autoplay:""},domProps:{muted:e.playData.isMuted}}),e._v(" "),e.playData.url?e._e():i("div",{staticClass:"video-tip"},[i("p",[e._v(e._s(e.$t("videoFilePage.null_video")))])]),e._v(" "),e.playData.url?i("div",{staticClass:"video-operate"},[i("div",{staticClass:"video-operate__left"},[e.playData.isPlay?i("i",{staticClass:"el-icon-video-pause",on:{click:e.videoStopFn}}):i("i",{staticClass:"el-icon-video-play",on:{click:e.videoPlayFn}})]),e._v(" "),i("div",{staticClass:"video-operate__right"},[i("i",{staticClass:"iconfont Jamin_monitor_icon_jietu",on:{click:e.captureVideoFn}}),e._v(" "),i("i",{staticClass:"iconfont Jamin_monitor_icon_quanping-1",on:{click:e.fullscreenVideoFn}})])]):e._e()])])]:e._e(),e._v(" "),e.isPermissionShow("playbackFileList")||e.$store.state.app.permsDataLoading?e._e():i("notPerm")],2)},[],!1,null,"a0b60e28",null);m.options.__file="videotape-file.vue";t.default=m.exports}}]);