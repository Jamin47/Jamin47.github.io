(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-63ac"],{"53CJ":function(e,t,i){"use strict";i.r(t);var a=i("BHIJ"),n={components:{TableView:i("AlM9").a,drawer:a.a},data:function(){return{vehicleIds:[],drawerDisplay:!1,drawerData:{},alias:{pageSize:"pageSize",pageNum:"pageNum"},tableOptions:{data:[],total:0,columns:[{type:"slot",name:"number",title:"序号"},{title:"车牌号码",key:"licenseNum",sort:"custom",minWidth:"130",type:"text"},{title:"所属公司",key:"companyName",type:"text",minWidth:"130"},{title:"保养类型",key:"maintainType",type:"tag",minWidth:"130",tags:[{value:1,text:"一保"},{value:2,text:"二保"},{value:3,text:"三保"}]},{title:"送保养日期",key:"deliveryDate",minWidth:"130",type:"text"},{title:"保养结束日期",key:"endDate",minWidth:"130",type:"text"},{title:"保养里程(KM)",key:"maintainMileage",minWidth:"130",type:"text"},{title:"保养间隔",key:"interval",type:"text"},{title:"下次保养日期",key:"nextDeliveryDate",minWidth:"180",type:"text"},{title:"保养费(￥)",key:"cost",minWidth:"130",type:"text"},{title:"办理人",key:"handler",minWidth:"130",type:"text"},{title:"操作",type:"operate",key:"operate",fixed:"right",width:"160",buttons:[{icon:"iconfont Jamin_vehicle_ico_xq",type:"text",size:"mini",funcName:"detail"},{icon:"iconfont Jamin_vehicle_icon_bj",type:"text",size:"mini",funcName:"edit"}]}],buttonControls:[{text:"添加保养信息",type:"primary",size:"small",round:!1,icon:"el-icon-plus",funcName:"increase"},{text:"导出记录",type:"null",size:"small",round:!1,icon:"el-icon-download",funcName:"export"}],searchControls:[{type:"input",key:"licenseNum",placeholder:"车牌号码",width:"200px",size:"small"},{type:"input",key:"companyName",placeholder:"所属公司",width:"200px",size:"small"},{type:"select",key:"maintainType",placeholder:"保养类型",width:"200px",size:"small",filterable:!0,clearable:!0,options:[{name:"一保",value:1},{name:"二保",value:2},{name:"三保",value:3}]}],footerButtons:[{text:"删除",type:"danger",size:"small",icon:"el-icon-delete",round:!1,funcName:"delete"}],paginationLayout:"total, sizes, prev, pager, next, jumper",loading:!1}}},computed:{},created:function(){},mounted:function(){},methods:{endTime:function(e){this.$refs.drawer.formData.deliveryDate?new Date(e).getTime()<=new Date(this.$refs.drawer.formData.deliveryDate).getTime()&&(this.$message.error("结束时间不得小于开始时间"),this.$refs.drawer.formData.endDate=null):(this.$message.error("请先选择开始时间"),this.$refs.drawer.formData.endDate=null)},getTableData:function(e){var t=this;this.tableOptions.loading=!0;var i={licenseNum:e.licenseNum,companyName:e.companyName,maintainType:e.maintainType,type:0};this.$http.post("/maintain/list?pageNum="+e.pageNum+"&pageSize="+e.pageSize,i).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.tableOptions.loading=!1,t.tableOptions.data=e.data.list,t.tableOptions.total=e.data.total)}),this.$http.post("/vehicle/list").then(function(e){e.code===t.$config.API_STATUS.OK&&e.data.list.forEach(function(e,i){t.vehicleIds[i]={value:e.vehicleId,name:e.licenseNum}})})},tableResponseFn:function(e,t,i){this[t.funcName].call(function(){},e,t,i)},edit:function(e){var t=this;this.$http.get("/maintain/"+e.maintainId).then(function(i){i.code===t.$config.API_STATUS.OK&&(e=i.data)}),this.drawerDisplay=!0,this.drawerData={staticData:e,isShow:!0,title:"编辑保养信息",titleWidth:"120",data:{},defaultData:"",submitAction:"/maintain/update/"+e.maintainId,btnAlign:"center",formList:[{title:"保养车辆",type:"select",key:"vehicleId",offsetWidth:"320",filterable:!0,options:{type:"default",list:this.vehicleIds},rules:[{required:!0,message:"请绑定车辆",trigger:"change"}]},{title:"保养类型",type:"select",key:"maintainType",offsetWidth:"320",filterable:!0,options:{type:"default",list:[{name:"一保",value:1},{name:"二保",value:2},{name:"三保",value:3}]},rules:[{required:!0,message:"请选择保养类型",trigger:"change"}]},{title:"保养里程",type:"input",key:"maintainMileage",offsetWidth:"320",rules:[{required:!0,message:"请输入保养里程",trigger:"blur"}]},{title:"送保养日期",type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"deliveryDate",rules:[{required:!0,message:"请选择送保养日期",trigger:"change"}]},{title:"结束保养日期",type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"endDate",handlerCallback:{target:"changeFunction",funcName:"endTime"},rules:[{required:!0,message:"请选择结束保养日期",trigger:"change"}]},{title:"保养费用",type:"input",offsetWidth:"320",key:"cost"},{title:"缴纳人",type:"input",offsetWidth:"320",key:"payer"},{title:"办理人",type:"input",offsetWidth:"320",key:"handler"},{title:"办理电话",type:"input",offsetWidth:"320",key:"phone"},{title:"保养间隔",type:"input",offsetWidth:"320",valueFormat:"yyyy-MM-dd",key:"interval",rules:[{required:!0,message:"请输入保险间隔",trigger:"blur"}]},{title:"提前提醒天数",type:"input",offsetWidth:"320",key:"advanceNum",rules:[{required:!0,message:"请输入提前提醒天数",trigger:"blur"}]},{title:"保养内容",type:"input",offsetWidth:"320",key:"content"},{title:"备注说明",type:"input",offsetWidth:"320",key:"description"},{title:"附件图片",type:"imgUpload",offsetWidth:"320",action:this.$config.API_CONFIG.API_ROOT+"/file/upload/attachedPhoto",key:"attachedPhoto",accept:"image/jpeg,image/png",headers:{Authorization:this.$store.getters.userData.tokenHead+this.$store.getters.userData.token},showFileList:!1,beforeUpload:function(e){},onProgress:function(e){},onSuccess:function(e){e.code===t.$config.API_STATUS.OK&&t.$set(t.$refs.drawer.formData,"attachedPhoto",e.data.url)}}],formButton:[{name:"确定",type:"confirm",class:"primary"},{name:"取消",type:"cancel",class:""}],message:{type:"success",message:"编辑成功！"}}},detail:function(e){var t=this;this.$http.get("/maintain/"+e.maintainId).then(function(i){i.code===t.$config.API_STATUS.OK&&(e=i.data)}),this.drawerDisplay=!0,this.drawerData={staticData:e,isShow:!0,title:"保险详情",titleWidth:"120",btnAlign:"center",formList:[{title:"保养车辆",type:"textSelect",key:"vehicleId",offsetWidth:"320",list:this.vehicleIds},{title:"保养类型",type:"textSelect",key:"maintainType",offsetWidth:"320",list:[{name:"一保",value:1},{name:"二保",value:2},{name:"三保",value:3}]},{title:"保养里程",type:"text",key:"maintainMileage",offsetWidth:"320"},{title:"送保养日期",type:"text",offsetWidth:"320",key:"deliveryDate"},{title:"结束保养日期",type:"text",offsetWidth:"320",key:"endDate"},{title:"保养费用",type:"text",offsetWidth:"320",key:"cost"},{title:"缴纳人",type:"text",offsetWidth:"320",key:"payer"},{title:"办理人",type:"text",offsetWidth:"320",key:"handler"},{title:"办理电话",type:"text",offsetWidth:"320",key:"phone"},{title:"保养间隔",type:"text",offsetWidth:"320",key:"interval"},{title:"提前提醒天数",type:"text",offsetWidth:"320",key:"advanceNum"},{title:"保养内容",type:"text",offsetWidth:"320",key:"content"},{title:"备注说明",type:"text",offsetWidth:"320",key:"description"},{title:"附件图片",type:"imgUpload",offsetWidth:"320",action:this.$config.API_CONFIG.API_ROOT+"/file/upload/attachedPhoto",key:"attachedPhoto",disabled:!0,accept:"image/jpeg,image/png",headers:{Authorization:this.$store.getters.userData.tokenHead+this.$store.getters.userData.token},showFileList:!1,beforeUpload:function(e){},onProgress:function(e){},onSuccess:function(e){e.code===t.$config.API_STATUS.OK&&t.$set(t.$refs.drawer.formData,"attachedPhoto",e.data.url)}}]}},increase:function(){var e=this;this.drawerDisplay=!0,this.drawerData={isShow:!0,title:"添加保养",titleWidth:"120",data:{},defaultData:{type:0,intervalType:1},submitAction:"/maintain/create",btnAlign:"center",formList:[{title:"保养车辆",type:"select",key:"vehicleId",offsetWidth:"320",filterable:!0,options:{type:"default",list:this.vehicleIds},rules:[{required:!0,message:"请绑定车辆",trigger:"change"}]},{title:"保养类型",type:"select",key:"maintainType",offsetWidth:"320",filterable:!0,options:{type:"default",list:[{name:"一保",value:1},{name:"二保",value:2},{name:"三保",value:3}]},rules:[{required:!0,message:"请选择保养类型",trigger:"change"}]},{title:"保养里程",type:"input",key:"maintainMileage",offsetWidth:"320",rules:[{required:!0,message:"请输入保养里程",trigger:"blur"}]},{title:"送保养日期",type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"deliveryDate",rules:[{required:!0,message:"请选择送保养日期",trigger:"change"}]},{title:"结束保养日期",type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"endDate",handlerCallback:{target:"changeFunction",funcName:"endTime"},rules:[{required:!0,message:"请选择结束保养日期",trigger:"change"}]},{title:"保养费用",type:"input",offsetWidth:"320",key:"cost"},{title:"缴纳人",type:"input",offsetWidth:"320",key:"payer"},{title:"办理人",type:"input",offsetWidth:"320",key:"handler"},{title:"办理电话",type:"input",offsetWidth:"320",key:"phone"},{title:"保养间隔",type:"input",offsetWidth:"320",valueFormat:"yyyy-MM-dd",key:"interval",rules:[{required:!0,message:"请输入保险间隔",trigger:"blur"}]},{title:"提前提醒天数",type:"input",offsetWidth:"320",key:"advanceNum",rules:[{required:!0,message:"请输入提前提醒天数",trigger:"blur"}]},{title:"保养内容",type:"input",offsetWidth:"320",key:"content"},{title:"备注说明",type:"input",offsetWidth:"320",key:"description"},{title:"附件图片",type:"imgUpload",offsetWidth:"320",action:this.$config.API_CONFIG.API_ROOT+"/file/upload/photo",key:"attachedPhoto",accept:"image/jpeg,image/png",headers:{Authorization:this.$store.getters.userData.tokenHead+this.$store.getters.userData.token},showFileList:!1,beforeUpload:function(e){},onProgress:function(e){},onSuccess:function(t){t.code===e.$config.API_STATUS.OK&&e.$set(e.$refs.drawer.formData,"attachedPhoto",t.data.url)}}],formButton:[{name:"确定",type:"confirm",class:"primary"},{name:"取消",type:"cancel",class:""}],message:{type:"success",message:"添加成功！"}}},export:function(){var e=this;this.$confirm("确认导出记录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1,beforeClose:function(t,i,a){e.fieldMap={},e.tableOptions.columns.forEach(function(t){e.$refs.table.columnCheckList.forEach(function(i){t.key===i&&"operate"!==t.key&&(e.fieldMap[i]=t.title)})});var n=e.$refs.table._data.searchParams,s=n.licenseNum,l=n.companyName,o=n.maintainType;if("confirm"===t){var r={type:0,fieldMap:e.fieldMap,licenseNum:s,companyName:l,maintainType:o};e.$http.download("/maintain/export?isToken=true",r).then(function(e){}),a()}else a()}}).catch(function(){})},delete:function(e){var t=this;this.$confirm("是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var i=[];e.forEach(function(e,t){i[t]=e.maintainId}),t.$http.deleteApi("/maintain/delete",{ids:i.join(",")}).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.$refs.table.emitRequestTableData(),t.$message({message:e.message,type:"success"}))})}).catch(function(){t.$message({type:"info",message:"已取消"})})},diaClose:function(){this.$refs.table.emitRequestTableData(),this.drawerDisplay=!1},drawerCallback:function(e,t,i,a){this[e.handlerCallback.funcName].call(function(){},t,i,a)}}},s=(i("9fNG"),i("ZrdR")),l=Object(s.a)(n,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"table"},[i("table-view",{ref:"table",attrs:{stripe:"",center:"","id-key":"id","is-search":!0,data:e.tableOptions.data,total:e.tableOptions.total,columns:e.tableOptions.columns,"search-controls":e.tableOptions.searchControls,"footer-buttons":e.tableOptions.footerButtons,"button-controls":e.tableOptions.buttonControls,"pagination-layout":e.tableOptions.paginationLayout,loading:e.tableOptions.loading,"view-table-key":"time",checked:"","is-shadow":"","column-view":"",alias:e.alias},on:{requestTableData:e.getTableData,handleCallback:e.tableResponseFn}},[i("el-table-column",{attrs:{slot:"number",label:"序号",type:"index",align:"center"},slot:"number"})],1),e._v(" "),e.drawerDisplay?i("drawer",{ref:"drawer",attrs:{size:"small","drawer-data":e.drawerData},on:{diaClose:e.diaClose,handlerCallback:e.drawerCallback}}):e._e()],1)},[],!1,null,"155bfc36",null);l.options.__file="time.vue";t.default=l.exports},"7zbQ":function(e,t,i){},"9fNG":function(e,t,i){"use strict";var a=i("7zbQ");i.n(a).a}}]);