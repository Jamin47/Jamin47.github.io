(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-ac7a"],{LehH:function(e,t,a){"use strict";a.r(t);var s=a("unDg"),i=a.n(s),n=a("cLjf"),r=a.n(n),o=a("hDQ3"),l=a.n(o),c=a("omC7"),d=a.n(c),u=a("AlM9"),h=a("BHIJ"),p=a("kDn8"),f={components:{TableView:u.a,drawer:h.a,dialogDesign:p.a},data:function(){return{pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},props:{motorcade:"motorcade",parentId:"parentId",status:"status",children:"children",label:"label",id:"id",count:"count"},userId:"",resetMenus:[],userMenus:[],flag:null,checkedKeys:[],fieldMap:{},drawerplay:!1,direction:"rtl",drawerTitle:"",drawerWidth:"700px",user:{username:"",account:""},companyList:[],roleList:[],dialogDisplay:!1,drawerDisplay:!1,drawerData:{},alias:{pageSize:"pageSize",pageNum:"pageNum"},tableOptions:{data:[],total:0,columns:[{type:"slot",name:"number",title:"序号"},{title:"登录账号",key:"username",minWidth:"160",sort:"custom",type:"text"},{title:"姓名",key:"account",minWidth:"130",type:"text"},{title:"用户角色",key:"roleName",minWidth:"130",type:"text"},{title:"所属客户",key:"companyName",minWidth:"130",type:"text"},{title:"到期时间",key:"timeoutAt",minWidth:"190",type:"text"},{title:"状态",key:"status",minWidth:"130",type:"tag",tags:[{value:1,text:"正常"},{value:0,text:"禁用",option:{type:"warning"}},{value:2,text:"已过期",option:{type:"danger"}}]},{title:"车辆总数",key:"vehicleTotal",minWidth:"130",type:"text"},{title:"创建时间",key:"createTime",minWidth:"220",type:"text"},{title:"操作",type:"operate",key:"operate",fixed:"right",width:"250",buttons:[{text:"登录",type:"text",size:"mini",funcName:"signIn"},{text:"编辑",type:"text",size:"mini",funcName:"edit"},{text:"车辆授权",type:"text",size:"mini",funcName:"vehicleAuthorization"},{text:"权限设置",type:"text",size:"mini",funcName:"permissionSetting"},{text:"重置",type:"text",size:"mini",funcName:"reset"}]}],buttonControls:[{text:"添加用户",type:"primary",size:"small",round:!1,funcName:"increase"},{text:"导出记录",type:"null",size:"small",round:!1,funcName:"export"}],searchControls:[{type:"input",key:"username",placeholder:"请输入登录账号",width:"200px",size:"small"},{type:"select",key:"companyId",placeholder:"请选择所属客户",width:"200px",size:"small",clearable:!0,options:[{name:"无",value:0}]},{type:"select",key:"status",placeholder:"请选择状态",width:"200px",size:"small",clearable:!0,options:[{name:"正常",value:1},{name:"禁用",value:0},{name:"已过期",value:2}]}],footerButtons:[{text:"启用",type:"",size:"small",icon:"el-icon-circle-check",round:!1,funcName:"enable"},{text:"禁用",type:"danger",size:"small",icon:"el-icon-remove-outline",round:!1,funcName:"disable"},{text:"删除",type:"danger",size:"small",icon:"el-icon-delete",round:!1,funcName:"delete"}],paginationLayout:"total, sizes, prev, pager, next, jumper",loading:!1}}},computed:{},created:function(){},mounted:function(){},methods:{click:function(e,t){this.$refs.trees.setCurrentKey(e.treeId),this.$refs._user_tree.setCurrentKey(e.treeId)},switchs:function(e,t){this.$refs.trees.setChecked(t,!1,!1),this.CheckedKeyFn()},treeList:function(e){var t=this;this.flag=!1,this.checkedKeys=[],this.$http.get("/user/list/vehicle?userId="+e).then(function(e){if(e.code===t.$config.API_STATUS.OK){var a=[{motorcades:e.data.motorcades,vehicles:e.data.vehicles}];t.treeArr(a),t.resetMenus=a[0].children}t.userTreeList(t.userId)})},userTreeList:function(e){var t=this;this.flag=!0,this.checkedKeys=[],this.$http.get("/user/list/vehicle/authorized?userId="+e).then(function(e){if(e.code===t.$config.API_STATUS.OK){var a=[{motorcades:e.data.motorcades,vehicles:e.data.vehicles}];t.treeArr(a),t.userMenus=a[0].children,t.$refs.trees.setCheckedKeys(t.checkedKeys)}})},treeArr:function(e){for(var t=this,a=function(a){if(e[a].motorcades){var s=[];e[a].vehicles&&e[a].vehicles.forEach(function(i){t.flag&&t.checkedKeys.push("v"+i.vehicleId),s.push({motorcade:!1,parentId:e[a].vehiclePid,status:i.status,label:i.licenseNum,id:i.vehicleId,treeId:"v"+i.vehicleId})}),e[a].motorcades.forEach(function(e){t.flag&&!e.motorcades.length&&t.checkedKeys.push("m"+e.motorcadeId),s.push({motorcade:!0,parentId:e.parentId,status:e.status,motorcades:e.motorcades,vehicles:e.vehicles,label:e.motorcadeName,id:e.motorcadeId,count:e.count,vehiclePid:e.motorcadeId,treeId:"m"+e.motorcadeId})}),e[a].children=JSON.parse(d()(s)),t.treeArr(e[a].children),delete e[a].motorcades,delete e[a].vehicles}},s=0;s<e.length;s++)a(s)},CheckedKeyFn:function(e,t){this.userMenus=[],this.createCheckedTreeFn(this.$refs.trees._data.root.childNodes)},createCheckedTreeFn:function(e){for(var t=0;t<e.length;t++){var a=e[t];if(a.checked){if(!a.data.motorcade){var s=this.$refs.trees.getNode("m"+a.data.parentId),i=this.forNodeFilterFn(s);i&&this.userMenus.push(i);break}this.userMenus.push(a.data)}else a.childNodes&&a.childNodes.length&&this.createCheckedTreeFn(a.childNodes)}},forNodeFilterFn:function(e){var t=this,a=[],s=null;return e.childNodes.forEach(function(e){if(e.checked)a.push(e.data);else if(e.childNodes&&e.childNodes.length){var s=t.forNodeFilterFn(e);s&&a.push(s)}}),a.length&&((s=JSON.parse(d()(e.data))).children=a),s},addUserData:function(){},getTableData:function(e){var t=this;this.tableOptions.loading=!0,this.$http.post("/user/list?pageNum="+e.pageNum+"&pageSize="+e.pageSize,e).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.tableOptions.loading=!1,t.tableOptions.data=e.data.list,t.tableOptions.total=e.data.total)}),this.$http.post("/company/list").then(function(e){e.code===t.$config.API_STATUS.OK&&e.data.list.forEach(function(e,a){t.companyList[a]={name:e.name,value:e.companyId},t.tableOptions.searchControls[1].options[a]={name:e.name,value:e.companyId}})}),this.$http.get("/role/listAll").then(function(e){t.roleList=[],e.code===t.$config.API_STATUS.OK&&e.data.forEach(function(e){t.roleList.push({name:e.name,value:e.roleId})})})},tableResponseFn:function(e,t,a){this[t.funcName].call(function(){},e,t,a)},increase:function(){var e=this;this.drawerDisplay=!0,this.drawerData={isShow:!0,title:"添加用户",titleWidth:"120",data:{},defaultData:"",submitAction:"/user/create",btnAlign:"center",formList:[{title:"所属客户",type:"select",key:"companyId",offsetWidth:"320",filterable:!0,options:{type:"default",list:this.companyList},rules:[{required:!0,message:"请选择归属客户",trigger:"change"}]},{title:"登录账号",type:"input",offsetWidth:"320",key:"username",rules:[{required:!0,message:"请输入登录账号",trigger:"blur"}]},{title:"登录密码",type:"input",offsetWidth:"320",key:"password",placeholder:"字母或数字组成,6到20位",rules:[{required:!0,message:"请输入登录密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}]},{title:"用户姓名",type:"input",offsetWidth:"320",key:"account",rules:[{required:!0,message:"请输入用户姓名",trigger:"blur"}]},{title:"到期时间",type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"timeoutAt",pickerOptions:this.pickerOptions,placeholder:"不填写则默认账号永久有效"},{title:"角色权限",type:"select",key:"roleId",offsetWidth:"320",filterable:!0,options:{type:"default",list:this.roleList},rules:[{required:!0,message:"请选择角色权限",trigger:"change"}]},{title:"单点登录",type:"select",key:"isSingle",offsetWidth:"320",options:{type:"default",list:[{name:"是",value:1},{name:"不是",value:0}]},rules:[{required:!0,message:"请选择单点登录",trigger:"change"}]},{title:"修改密码",type:"select",key:"resetPassword",offsetWidth:"320",options:{type:"default",list:[{name:"允许",value:0},{name:"禁止",value:1}]},rules:[{required:!0,message:"请选择修改密码",trigger:"change"}]},{title:"手机号码",type:"input",offsetWidth:"320",key:"phone",rules:[{required:!0,message:"请输入手机号码",trigger:"blur"}]},{title:"电子邮箱",type:"input",offsetWidth:"320",key:"email"}],formButton:[{name:"确定",type:"confirm",class:"primary"},{name:"取消",type:"cancel",class:""}],message:{type:"success",message:"编辑成功！"}},setTimeout(function(){e.$set(e.$refs.drawer.formData,"isSingle",0),e.$set(e.$refs.drawer.formData,"resetPassword",0)},400)},export:function(e){var t=this;this.$confirm("确认导出记录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1,beforeClose:function(e,a,s){t.fieldMap={},t.tableOptions.columns.forEach(function(e){t.$refs.table.columnCheckList.forEach(function(a){e.key===a&&"operate"!==e.key&&(t.fieldMap[a]=e.title)})});var i=t.$refs.table._data.searchParams,n=i.username,r=i.customer,o=i.status;if("confirm"===e){var l={fieldMap:t.fieldMap,username:n,customer:r,status:o};t.$http.download("/user/export?isToken=true",l).then(function(e){}),s()}else s()}}).catch(function(){})},enable:function(e){var t=this,a=[];e.forEach(function(e,t){a[t]=e.userId}),this.$http.deleteApi("/user/status",{ids:a.join(","),status:1}).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.$refs.table.emitRequestTableData(),t.$message({message:e.message,type:"success"}))})},disable:function(e){var t=this,a=[];e.forEach(function(e,t){a[t]=e.userId}),this.$http.deleteApi("/user/status",{ids:a.join(","),status:0}).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.$refs.table.emitRequestTableData(),t.$message({message:e.message,type:"success"}))})},delete:function(e){var t=this;this.$confirm("是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a=[];e.forEach(function(e,t){a[t]=e.userId}),t.$http.deleteApi("/user/delete",{ids:a.join(",")}).then(function(e){e.code===t.$config.API_STATUS.OK&&(t.$refs.table.emitRequestTableData(),t.$message({message:e.message,type:"success"}))})}).catch(function(){t.$message({type:"info",message:"已取消"})})},signIn:function(e){},edit:function(e){var t=this;return l()(r.a.mark(function a(){return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t.drawerDisplay=!0,t.drawerData={staticData:e,isShow:!0,title:"编辑用户",titleWidth:"120",data:{},defaultData:"",submitAction:"/user/update/"+e.userId,btnAlign:"center",formList:[{title:"所属客户",type:"select",key:"companyId",offsetWidth:"320",filterable:!0,options:{type:"default",list:t.companyList},rules:[{required:!0,message:"请选择归属客户",trigger:"change"}]},{title:"登录账号",type:"input",offsetWidth:"320",key:"username",rules:[{required:!0,message:"请输入登录账号",trigger:"blur"}]},{title:"用户姓名",type:"input",key:"account",offsetWidth:"320",rules:[{required:!0,message:"请输入用户姓名",trigger:"blur"}]},{title:"到期时间",type:"dateSelect",valueFormat:"yyyy-MM-dd",offsetWidth:"320",key:"timeoutAt",placeholder:"不填写则默认账号永久有效"},{title:"角色权限",type:"select",key:"roleId",offsetWidth:"320",filterable:!0,options:{type:"default",list:t.roleList},rules:[{required:!0,message:"请选择角色权限",trigger:"change"}]},{title:"单点登录",type:"select",key:"isSingle",offsetWidth:"320",options:{type:"default",list:[{name:"是",value:1},{name:"不是",value:0}]},rules:[{required:!0,message:"请选择单点登录",trigger:"change"}]},{title:"修改密码",type:"select",key:"resetPassword",offsetWidth:"320",options:{type:"default",list:[{name:"允许",value:0},{name:"禁止",value:1}]},rules:[{required:!0,message:"请选择修改密码",trigger:"change"}]},{title:"手机号码",type:"input",offsetWidth:"320",key:"phone",rules:[{required:!0,message:"请输入手机号码",trigger:"blur"}]},{title:"电子邮箱",type:"input",offsetWidth:"320",key:"email"}],formButton:[{name:"确定",type:"confirm",class:"primary"},{name:"取消",type:"cancel",class:""}],message:{type:"success",message:"编辑成功！"}};case 2:case"end":return a.stop()}},a,t)}))()},vehicleAuthorization:function(e){e.username&&(this.user.username=e.username),e.account&&(this.user.account=e.account),this.userId=e.userId,this.treeList(this.userId),this.drawerWidth="700px",this.drawerTitle="授权车辆",this.drawerplay=!0},submitFn:function(){var e=this,t=this.treeCountFn(this.$refs._user_tree._data.root.childNodes,!0);this.$http.post("/user/vehicle/"+this.userId,t).then(function(t){t.code===e.$config.API_STATUS.OK&&(e.$message.success("授权成功！"),e.drawerplay=!1,e.$refs.table.emitRequestTableData())})},treeCountFn:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=[],n=[];return e.forEach(function(e){if(e.data.motorcade){if(s.push({parentId:a?0:e.data.parentId,motorcadeId:e.data.id}),e.childNodes&&e.childNodes.length){var r=t.treeCountFn(e.childNodes);s=[].concat(i()(s),i()(r.authorizedMotorcades)),n=[].concat(i()(n),i()(r.vehicles))}}else n.push({parentId:e.data.parentId,vehicleId:e.data.id})}),{authorizedMotorcades:s,vehicles:n}},permissionSetting:function(e){},reset:function(e){this.dialogData={isClickClose:!1,staticData:null,isDialogDisplay:!0,title:"重置密码",mainWidth:"500",titleWidth:"100",submitAction:"/user/reset/"+e.userId,btnAlign:"center",formList:[{title:"新密码",type:"input",labelWidth:"100",offsetWidth:"320",key:"password",placeholder:"字母或数字组成,6到20位",rules:[{required:!0,message:"请输入登录密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}]}],formButton:[{name:"确定",type:"confirm",class:"primary",round:!1},{name:"取消",type:"cancel",class:"",round:!1}]},this.dialogDisplay=!0},diaClose:function(){var e=this;this.$refs.table.emitRequestTableData(),this.drawerDisplay=!1,this.dialogDisplay=!1,this.isTable=!1,this.$nextTick(function(){e.isTable=!0})},drawerCallback:function(e,t,a,s){this[e.handlerCallback.funcName].call(function(){},t,a,s)}}},m=(a("cfJT"),a("ZrdR")),y=Object(m.a)(f,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"userAccount"},[a("table-view",{ref:"table",attrs:{center:"","is-search":!0,data:e.tableOptions.data,total:e.tableOptions.total,columns:e.tableOptions.columns,"search-controls":e.tableOptions.searchControls,"footer-buttons":e.tableOptions.footerButtons,"button-controls":e.tableOptions.buttonControls,"pagination-layout":e.tableOptions.paginationLayout,loading:e.tableOptions.loading,checked:"","is-shadow":"",alias:e.alias},on:{requestTableData:e.getTableData,handleCallback:e.tableResponseFn}},[a("el-table-column",{attrs:{slot:"number",label:"序号",type:"index",align:"center"},slot:"number"})],1),e._v(" "),e.drawerDisplay?a("drawer",{ref:"drawer",attrs:{size:"small","drawer-data":e.drawerData},on:{diaClose:e.diaClose,handlerCallback:e.drawerCallback}}):e._e(),e._v(" "),e.dialogDisplay?a("dialog-design",{ref:"_dialog_design",attrs:{size:"mini",color:"primary","dialog-data":e.dialogData},on:{diaClose:e.diaClose}}):e._e(),e._v(" "),a("el-drawer",{attrs:{title:e.drawerTitle,visible:e.drawerplay,direction:e.direction,size:e.drawerWidth,"wrapper-closable":!1},on:{"update:visible":function(t){e.drawerplay=t}}},[e.drawerplay?a("div",{staticClass:"uploadDialogClass"},[a("div",{staticClass:"user"},[a("span",[e._v("登录账号:  "+e._s(e.user.username))]),e._v(" "),a("span",[e._v("姓名:  "+e._s(e.user.account))])]),e._v(" "),a("div",{staticClass:"tree_box"},[a("div",{staticClass:"tree_item"},[a("el-tree",{ref:"trees",attrs:{data:e.resetMenus,"show-checkbox":"","node-key":"treeId","default-checked-keys":e.checkedKeys,"default-expand-all":!0,props:e.props,"highlight-current":""},on:{check:e.CheckedKeyFn,"node-click":e.click},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,i=t.data;return a("span",{staticClass:"custom-tree-node"},[!0===i.motorcade?a("span",[a("i",{staticClass:"iconfont Jamin_vehicle_icon_dawenjianjia p-c"}),e._v("\n                "+e._s(s.label)+"\n              ")]):e._e(),e._v(" "),!1===i.motorcade?a("span",[a("i",{staticClass:"iconfont Jamin_location_icon_che-lan iconTxt p-s"}),e._v("\n                "+e._s(s.label)+"\n              ")]):e._e()])}}])})],1),e._v(" "),a("div",{staticClass:"tree_item"},[a("el-tree",{ref:"_user_tree",attrs:{data:e.userMenus,"node-key":"treeId","default-expand-all":!0,props:e.props,"highlight-current":""},on:{check:e.CheckedKeyFn,"node-click":e.click},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.node,i=t.data;return a("span",{staticClass:"custom-tree-node"},[!0===i.motorcade?a("span",[a("span",[a("i",{staticClass:"iconfont Jamin_vehicle_icon_dawenjianjia p-c"}),e._v("\n                  "+e._s(s.label)+"\n                ")]),e._v(" "),a("span",{staticClass:"right-box"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.switchs(s,i)}}},[e._v("\n                    移除\n                  ")])],1)]):e._e(),e._v(" "),!1===i.motorcade?a("span",[a("span",[a("i",{staticClass:"iconfont Jamin_location_icon_che-lan iconTxt p-s"}),e._v("\n                  "+e._s(s.label)+"\n                ")]),e._v(" "),a("span",{staticClass:"right-box"},[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(){return e.switchs(s,i)}}},[e._v("\n                    移除\n                  ")])],1)]):e._e()])}}])})],1)])]):e._e(),e._v(" "),a("div",{staticClass:"footBtn"},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitFn}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:function(t){e.drawerplay=!1}}},[e._v("取消")])],1)])],1)},[],!1,null,"0daccbed",null);y.options.__file="userAccount.vue";t.default=y.exports},QANK:function(e,t,a){},cfJT:function(e,t,a){"use strict";var s=a("QANK");a.n(s).a}}]);